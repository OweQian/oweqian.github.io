---
title: "ğŸ’» ä» 0 åˆ° 1 å°è£…ä¸€ä¸ªå‰ç«¯è„šæ‰‹æ¶"
date: 2022-12-28T13:50:24+08:00
tags: ["è„šæ‰‹æ¶"]
categories: ["è„šæ‰‹æ¶"]
---

æœ¬ç¯‡æ–‡ç« æ—¨åœ¨å¸¦ä½ ä» 0 åˆ° 1 å›´ç»•é¡¹ç›® â€œåˆ›å»ºã€è¿è¡Œã€æµ‹è¯•ã€æäº¤ã€å‘å¸ƒâ€ çš„å¸¸è§„æµç¨‹è¿›è¡Œå‰ç«¯è„šæ‰‹æ¶å·¥å…·çš„å°è£…ï¼Œæ»¡è¶³å¤§ä¸­å°é¡¹ç›®å¼€å‘æ‰€éœ€ï¼Œæ¬¢è¿æ‚¨çš„æŒ‡æ­£å’Œç‚¹èµã€‚

<!--more-->

## ç†è§£è„šæ‰‹æ¶

ğŸ¤” å‰ç«¯ä¸æ˜¯å†™å†™é¡µé¢å°±å¯ä»¥äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¦åšè„šæ‰‹æ¶å¼€å‘ï¼Ÿ

å¤§éƒ¨åˆ†å‰ç«¯å·¥ç¨‹å¸ˆéƒ½è¦ä½¿ç”¨è„šæ‰‹æ¶ï¼Œæœ€å¸¸è§çš„è„šæ‰‹æ¶æœ‰ï¼šnpmã€vue-cliã€create-react-appã€webpack-cli ç­‰ç­‰ï¼Œå®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å€ŸåŠ©è„šæ‰‹æ¶æ¥åšå„ç§æµç¨‹çš„è‡ªåŠ¨åŒ–ï¼Œå¦‚ï¼šé¡¹ç›®åˆ›å»ºã€é¡¹ç›®æ„å»ºã€é¡¹ç›®å‘å¸ƒç­‰ã€‚

å…·æœ‰ä¸€å®šè§„æ¨¡çš„å‰ç«¯å›¢é˜Ÿï¼Œéœ€è¦å„ç§å„æ ·çš„ææ•ˆå·¥å…·ï¼Œè¿™ç±»å·¥å…·å¯ä»¥å¸®åŠ©ä¼ä¸šå¤§å¹…åº¦èŠ‚çº¦ç ”å‘æˆæœ¬ã€‚å¦å¤–ï¼Œéšç€å‰ç«¯æŠ€æœ¯çš„æ™®åŠï¼Œè„šæ‰‹æ¶ä¹Ÿæˆä¸ºå‰ç«¯å·¥ç¨‹å¸ˆçš„åŸºæœ¬æŠ€èƒ½ã€‚

### è„šæ‰‹æ¶ç®€ä»‹

ğŸ¤” ä»€ä¹ˆæ˜¯è„šæ‰‹æ¶ï¼Ÿ

è„šæ‰‹æ¶æœ¬è´¨æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å®¢æˆ·ç«¯ï¼Œå®ƒé€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œï¼Œå¦‚ï¼š

```bash
vue create vue-test-app
```

è¿™æ¡å‘½ä»¤ç”± 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼š

- ä¸»å‘½ä»¤ï¼švue
- commandï¼šcreate
- command çš„ paramï¼švue-test-app

å®ƒè¡¨ç¤ºåˆ›å»ºä¸€ä¸ª vue é¡¹ç›®ï¼Œé¡¹ç›®åç§°ä¸º vue-test-appï¼Œè¿™æ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„è„šæ‰‹æ¶å‘½ä»¤ï¼Œå®é™…åœºæ™¯å¾€å¾€æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚ï¼š

å½“å‰ç›®å½•å·²ç»æœ‰æ–‡ä»¶äº†ï¼Œéœ€è¦è¦†ç›–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¼ºåˆ¶è¿›è¡Œåˆ›å»º vue é¡¹ç›®ï¼Œæ­¤æ—¶å¯ä»¥è¾“å…¥ï¼š

```bash
vue create vue-test-app --force
```

è¿™é‡Œçš„ --force ç§°ä¸º optionï¼Œç”¨æ¥è¾…åŠ©è„šæ‰‹æ¶ç¡®è®¤åœ¨ç‰¹å®šåœºæ™¯ä¸‹ç”¨æˆ·çš„é€‰æ‹©ã€‚--force å¯ä»¥ç†è§£ä¸ºï¼š--force trueï¼Œç®€å†™ä¸ºï¼š--force æˆ– -fã€‚

è¿˜æœ‰ä¸€ç§åœºæ™¯ï¼š

é€šè¿‡ vue create åˆ›å»ºé¡¹ç›®æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ npm install å¸®ç”¨æˆ·å®‰è£…ä¾èµ–ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æ·˜å®æºæ¥å®‰è£…ï¼Œå¯ä»¥è¿™æ ·è¾“å…¥ï¼š

```bash
vue create vue-test-app --force -r https://registry.npm.taobao.org
```

è¿™é‡Œçš„ -r ä¹Ÿç§°ä¸º optionï¼Œå®ƒä¸ --force ä¸åŒçš„æ˜¯ï¼Œå®ƒä½¿ç”¨ç®€å†™ï¼Œè¿™é‡Œçš„ -r ä¹Ÿå¯ä»¥æ›¿æ¢æˆ --registryã€‚

-r https://registry.npm.taobao.org åé¢çš„ https://registry.npm.taobao.org ç§°ä¸º option çš„ paramã€‚

è¾“å…¥ä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥çœ‹åˆ° vue create æ”¯æŒçš„æ‰€æœ‰ optionsï¼š

```bash
vue create --help
```

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_01.png" alt="" width="100%" />

### è„šæ‰‹æ¶å®ç°åŸç†

æˆ‘ä»¬ä»¥ä½¿ç”¨ @vue/cli æ–°å»ºä¸€ä¸ª vue é¡¹ç›®ä¸ºä¾‹ï¼Œé¦–å…ˆè¦å…¨å±€å®‰è£… @vue/cliï¼š

```bash
npm install -g @vue/cli
# OR
yarn global add @vue/cli
```

ç„¶ååˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼š

```bash
vue create vue-test-app
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ€è€ƒä¸€äº›é—®é¢˜ (ä»¥ npm ä½œä¸ºåŒ…ç®¡ç†å™¨)ã€‚

ğŸ¤” å…¨å±€å®‰è£… @vue/cli æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

ğŸ¤” ä¸ºä»€ä¹ˆå…¨å±€å®‰è£… @vue/cli åä¼šæ·»åŠ  vue å‘½ä»¤ï¼Ÿ

ğŸ¤” è¾“å…¥å‘½ä»¤ vue create vue-test-app å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

ğŸ¤” ä¸ºä»€ä¹ˆ vue æŒ‡å‘ä¸€ä¸ª js æ–‡ä»¶ï¼Œæˆ‘ä»¬å´å¯ä»¥ç›´æ¥é€šè¿‡ vue å‘½ä»¤ç›´æ¥å»æ‰§è¡Œå®ƒï¼Ÿ

- @vue/cli æ˜¯ä¸€ä¸ª npm é¡¹ç›®ï¼ŒåŒ…å«ä¸€ä¸ª bin/vue.js æ–‡ä»¶å¹¶å·²ç»å‘å¸ƒåˆ° npm

* æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œnpm ä¼šä» npm æ³¨å†Œè¡¨ä¸­ä¸‹è½½ @vue/cli çš„æœ€æ–°ç‰ˆæœ¬åŠå…¶ä¾èµ–é¡¹
* å‘½ä»¤è¡Œå·¥å…·ä¼šæŠŠ @vue/cli å®‰è£…åˆ° node çš„ lib/node_modules
* åœ¨ç¯å¢ƒå˜é‡ä¸­æ³¨å†Œ vue å‘½ä»¤ï¼Œå¹¶é…ç½®è½¯é“¾æ¥æŒ‡å‘ï¼šlib/node_modules/@vue/cli/bin/vue.js
* åœ¨ç»ˆç«¯è¾“å…¥ vue create vue-test-appï¼Œç»ˆç«¯è§£æå‡º vue å‘½ä»¤
* ç»ˆç«¯åœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ° vue å‘½ä»¤ï¼Œæ ¹æ® vue å‘½ä»¤æŒ‡å‘çš„è½¯é“¾æ¥æ‰¾åˆ°å®é™…æ–‡ä»¶ vue.js
* ç»ˆç«¯åˆ©ç”¨ node æ‰§è¡Œ vue.jsï¼Œè§£æ command/optionsï¼Œæ‰§è¡Œ command
* æ‰§è¡Œå®Œæ¯•ï¼Œé€€å‡ºæ‰§è¡Œ

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_02.png" alt="" width="100%" />

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_03.png" alt="" width="100%" />

ğŸ¤” å¦‚ä½•å¼€å‘ä¸€ä¸ªè„šæ‰‹æ¶ï¼Ÿ

ä»¥ vue-cli ä¸ºä¾‹ï¼š

- å¼€å‘ä¸€ä¸ª npm é¡¹ç›®ï¼Œè¯¥é¡¹ç›®ä¸­åŒ…å«ä¸€ä¸ª bin/vue.js æ–‡ä»¶ï¼Œå°†è¿™ä¸ªé¡¹ç›®å‘å¸ƒåˆ° npm
- å°† npm é¡¹ç›®å®‰è£…åˆ° node çš„ lib/node_modules
- åœ¨ node çš„ bin ç›®å½•ä¸‹é…ç½® vue è½¯é“¾æ¥æŒ‡å‘ lib/node_modules/@vue/cli/bin/vue.js

è¿™æ ·æˆ‘ä»¬åœ¨æ‰§è¡Œ vue å‘½ä»¤çš„æ—¶å€™å°±å¯ä»¥æ‰¾åˆ° vue.js è¿›è¡Œæ‰§è¡Œã€‚

### è„šæ‰‹æ¶å‰ç½®çŸ¥è¯†

#### å¸¸ç”¨çš„è„šæ‰‹æ¶æ¡†æ¶

- [yargs](https://www.npmjs.com/package/yargs)
- [commander](https://www.npmjs.com/package/commander)
- [oclif](https://www.npmjs.com/package/oclif)

* è„šæ‰‹æ¶ç”Ÿæˆå™¨

#### è„šæ‰‹æ¶åˆ›å»ºæµç¨‹

- åˆ›å»º npm é¡¹ç›®ï¼Œæ‰§è¡Œ npm init
- åˆ›å»ºè„šæ‰‹æ¶å…¥å£æ–‡ä»¶ï¼Œæœ€ä¸Šæ–¹æ·»åŠ 

```javascript
#!/usr/bin/env node
```

- é…ç½® package.jsonï¼Œæ·»åŠ  bin å±æ€§ï¼ŒæŒ‡å‘å…¥å£æ–‡ä»¶

#### è„šæ‰‹æ¶å¼€å‘æµç¨‹

- åˆ†åŒ…ï¼šå°†å¤æ‚çš„ç³»ç»Ÿæ‹†åˆ†æˆè‹¥å¹²ä¸ªæ¨¡å—
- å‘½ä»¤æ³¨å†Œï¼š

```bash
vue create
vue add
vue invoke
```

- å‚æ•°è§£æ

1. options å…¨ç§°ï¼š--versionã€--help
2. options ç®€å†™ï¼š-Vã€-h
3. å¸¦ params çš„ optionsï¼š--path /Users/qianwang/Desktop/vue-test

- global help

1. Usage
2. Options
3. Commands

ğŸŒ° vue çš„å¸®åŠ©ä¿¡æ¯ï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_04.png" alt="" width="100%" />

- command help

1. Usage
2. Options

ğŸŒ° vue create çš„å¸®åŠ©ä¿¡æ¯ï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_05.png" alt="" width="100%" />

è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š

- å‘½ä»¤è¡Œäº¤äº’
- æ—¥å¿—æ‰“å°
- å‘½ä»¤è¡Œæ–‡å­—å˜è‰²
- ç½‘ç»œé€šä¿¡ï¼šHTTP
- æ–‡ä»¶å¤„ç†

ç­‰ç­‰...

#### è„šæ‰‹æ¶è°ƒè¯•æµç¨‹

- é“¾æ¥æœ¬åœ°è„šæ‰‹æ¶ï¼š

```
cd your-cli-dir
npm link
```

- é“¾æ¥æœ¬åœ°åº“æ–‡ä»¶

```
cd your-lib-dir
npm link
cd your-cli-dir
npm link your-lib
```

- å–æ¶ˆé“¾æ¥æœ¬åœ°åº“æ–‡ä»¶ï¼š

```
cd your-lib-dir
npm unlink
cd your-cli-dir
# linkå­˜åœ¨
npm unlink your-lib
# linkä¸å­˜åœ¨
rm -rf node_modules
npm install -S your-lib
```

ğŸ§  ç†è§£ npm linkï¼š

- npm link your-libï¼šå°†å½“å‰é¡¹ç›®é¡¹ç›®ä¸­ node_modules ä¸‹æŒ‡å®šçš„åº“æ–‡ä»¶é“¾æ¥åˆ° node å…¨å±€ node_modules ä¸‹çš„åº“æ–‡ä»¶

- npm linkï¼šå°†å½“å‰é¡¹ç›®é“¾æ¥åˆ° node å…¨å±€ node_modules ä¸­ä½œä¸ºä¸€ä¸ªåº“æ–‡ä»¶ï¼Œå¹¶è§£æ bin é…ç½®åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶

ğŸ§  ç†è§£ npm unlinkï¼š

- npm unlinkï¼šå°†å½“å‰é¡¹ç›®ä» node å…¨å±€ node_modules ä¸­ç§»é™¤

* npm unlink your-libï¼šå°†å½“å‰é¡¹ç›®ä¸­çš„åº“æ–‡ä»¶ä¾èµ–ç§»é™¤

#### è„šæ‰‹æ¶å‘å¸ƒæµç¨‹

- å°†è„šæ‰‹æ¶å‘å¸ƒåˆ° npm

#### è„šæ‰‹æ¶ä½¿ç”¨æµç¨‹

- å®‰è£…è„šæ‰‹æ¶

```
npm install -g your-own-cli
```

- ä½¿ç”¨è„šæ‰‹æ¶

```
your-own-cli
```

## æ‰€ç”¨æŠ€æœ¯æ ˆ

1. **Lerna**

   - **ç”¨é€”**ï¼šç”¨äºç®¡ç† JavaScript é¡¹ç›®çš„å¤šåŒ…å·¥å…·ï¼Œèƒ½å¤Ÿå¤„ç† monorepo é¡¹ç›®ï¼Œç®€åŒ–åŒ…çš„ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ã€‚
   - **å®˜ç½‘**ï¼š[Lerna](https://lerna.js.org/)

2. **Chalk**

   - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºåœ¨æ§åˆ¶å°è¾“å‡ºå¸¦é¢œè‰²å’Œæ ·å¼çš„æ–‡æœ¬çš„åº“ï¼Œæä¾›ç®€æ´çš„ APIã€‚
   - **å®˜ç½‘**ï¼š[Chalk](https://github.com/chalk/chalk)

3. **Commander**

   - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºåˆ›å»ºå¯æ‰§è¡Œå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºçš„åº“ï¼Œå¸®åŠ©æ„å»ºå‹å¥½çš„ CLI æ¥å£ã€‚
   - **å®˜ç½‘**ï¼š[Commander](https://github.com/tj/commander.js)

4. **dirname-filename-esm**

   - **ç”¨é€”**ï¼šåœ¨ ES æ¨¡å—ä¸­è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•åå’Œæ–‡ä»¶åï¼Œè§£å†³ ES æ¨¡å—ä¸­çš„è·¯å¾„é—®é¢˜ã€‚
   - **å®˜ç½‘**ï¼š[dirname-filename-esm](https://github.com/deno-libs/dirname-filename)

5. **fs-extra**

   - **ç”¨é€”**ï¼šä¸€ä¸ªæ‰©å±•çš„æ–‡ä»¶ç³»ç»Ÿåº“ï¼Œæä¾›äº† FS æ¨¡å—ä¸­æ²¡æœ‰çš„é¢å¤–åŠŸèƒ½ï¼Œå¦‚é€’å½’å¤åˆ¶ã€åˆ é™¤ç­‰ã€‚
   - **å®˜ç½‘**ï¼š[fs-extra](https://github.com/jprichardson/node-fs-extra)

6. **import-local**

   - **ç”¨é€”**ï¼šç”¨äºåœ¨æœ¬åœ°æŸ¥æ‰¾ä¾èµ–æ¨¡å—ï¼Œä¸ä¼šå¹²æ‰°å…¨å±€å®‰è£…çš„æ¨¡å—ï¼Œé€šå¸¸ç”¨äº CLI å·¥å…·ä¸­ã€‚
   - **å®˜ç½‘**ï¼š[import-local](https://github.com/tapio/import-local)

7. **semver**

   - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºè§£æã€æ¯”è¾ƒå’Œæ“ä½œè¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ˆsemverï¼‰çš„åº“ã€‚
   - **å®˜ç½‘**ï¼š[semver](https://github.com/npm/node-semver)

8. **execa**

   - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºæ‰§è¡Œå­è¿›ç¨‹å¹¶å¤„ç†å…¶è¾“å‡ºçš„åº“ï¼Œæä¾›æ›´å¥½çš„äººæœºç•Œé¢ï¼Œä»¥å¤„ç†å’Œç®€åŒ–å‘½ä»¤è¡Œçš„æ‰§è¡Œã€‚
   - **å®˜ç½‘**ï¼š[execa](https://github.com/sindresorhus/execa)

9. **Jest**

   - **ç”¨é€”**ï¼šç”± Facebook å¼€å‘çš„ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œé€‚ç”¨äº React åº”ç”¨å’Œå…¶ä»– JavaScript é¡¹ç›®ï¼Œå…·æœ‰é›¶é…ç½®çš„ç‰¹æ€§ã€‚
   - **å®˜ç½‘**ï¼š[Jest](https://jestjs.io/)

10. **Mocha**

    - **ç”¨é€”**ï¼šä¸€ä¸ªçµæ´»çš„ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥æµ‹è¯•å’Œå¤šç§æ–­è¨€åº“ã€‚
    - **å®˜ç½‘**ï¼š[Mocha](https://mochajs.org/)

11. **Axios**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºå‘é€ HTTP è¯·æ±‚çš„åº“ï¼Œæ”¯æŒ Promise API å’Œè¯·æ±‚/å“åº”æ‹¦æˆªå™¨ã€‚
    - **å®˜ç½‘**ï¼š[Axios](https://axios-http.com/)

12. **Inquirer**

    - **ç”¨é€”**ï¼šç”¨äºæ„å»ºå‘½ä»¤è¡Œäº¤äº’å¼é—®ç­”çš„åº“ï¼Œå¹¿æ³›ç”¨äº CLI åº”ç”¨ä¸­è·å–ç”¨æˆ·è¾“å…¥ã€‚
    - **å®˜ç½‘**ï¼š[Inquirer](https://github.com/SBoudrias/Inquirer.js)

13. **npmlog**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºè®°å½• NPM æ—¥å¿—çš„åº“ï¼Œæä¾›å¤šç§æ—¥å¿—çº§åˆ«ã€‚
    - **å®˜ç½‘**ï¼š[npmlog](https://github.com/npm/npmlog)

14. **url-join**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºè¿æ¥ URL ç‰‡æ®µçš„ç®€å•åº“ï¼Œç¡®ä¿æ­£ç¡®å¤„ç†æ–œæ ã€‚
    - **å®˜ç½‘**ï¼š[url-join](https://github.com/BlakeDonner/url-join)

15. **path-exists**

    - **ç”¨é€”**ï¼šæ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨çš„åº“ã€‚
    - **å®˜ç½‘**ï¼š[path-exists](https://github.com/sindresorhus/path-exists)

16. **simple-git**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç®€åŒ– Git æ“ä½œçš„ Node.js åº“ï¼Œç”¨äºåœ¨ Node åº”ç”¨ä¸­æ‰§è¡Œ Git å‘½ä»¤ã€‚
    - **å®˜ç½‘**ï¼š[simple-git](https://github.com/steveukx/git-js)

17. **Ora**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºåœ¨å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºåŠ è½½åŠ¨ç”»çš„åº“ï¼Œå¸¸ç”¨äºæŒ‡ç¤ºå¼‚æ­¥æ“ä½œçš„è¿›åº¦ã€‚
    - **å®˜ç½‘**ï¼š[Ora](https://github.com/sindresorhus/ora)

18. **EJS**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç®€å•çš„ JavaScript æ¨¡æ¿å¼•æ“ï¼Œç”¨äºç”Ÿæˆ HTML å†…å®¹ï¼Œæ”¯æŒåœ¨ JavaScript ä¸­åµŒå…¥ HTML ä»£ç ã€‚
    - **å®˜ç½‘**ï¼š[EJS](https://ejs.co/)

19. **Glob**

    - **ç”¨é€”**ï¼šç”¨äºæ–‡ä»¶åŒ¹é…ï¼ˆæ–‡ä»¶æœç´¢ï¼‰çš„åº“ï¼Œå…è®¸ä½¿ç”¨ Unix é£æ ¼çš„å›¾æ¡ˆåŒ¹é…æ–‡ä»¶åã€‚
    - **å®˜ç½‘**ï¼š[Glob](https://github.com/isaacs/node-glob)

20. **ESLint**

    - **ç”¨é€”**ï¼šä¸€ä¸ªç”¨äºè¯†åˆ«å’ŒæŠ¥å‘Š JavaScript ä»£ç ä¸­æ¨¡å¼é—®é¢˜çš„å·¥å…·ï¼Œå¸®åŠ©ä¿æŒä»£ç è´¨é‡ã€‚
    - **å®˜ç½‘**ï¼š[ESLint](https://eslint.org/)

21. **Egg.js**

    - **ç”¨é€”**ï¼šä¸€ä¸ªåŸºäº Koa çš„ä¼ä¸šçº§ Node.js web æ¡†æ¶ï¼Œæä¾›å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿå’Œæ¶æ„ã€‚
    - **å®˜ç½‘**ï¼š[Egg.js](https://eggjs.org/)

22. **egg-mongoose**

    - **ç”¨é€”**ï¼šEgg.js æ¡†æ¶çš„ Mongoose æ’ä»¶ï¼Œç”¨äºç®€å•åœ°è¿æ¥ MongoDB æ•°æ®åº“ã€‚
    - **å®˜ç½‘**ï¼š[egg-mongoose](https://github.com/eggjs/egg-mongoose)

23. **MongoDB**
    - **ç”¨é€”**ï¼šä¸€ä¸ªç°ä»£åŒ–çš„ NoSQL æ•°æ®åº“ï¼Œå¯ç”¨äºå­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®ï¼Œé€‚åˆå¤„ç†éç»“æ„åŒ–æ•°æ®ã€‚
    - **å®˜ç½‘**ï¼š[MongoDB](https://www.mongodb.com/)

## æ­å»ºè„šæ‰‹æ¶

é€šè¿‡ lerna åˆ›å»º packageï¼š

```
packages
â”œâ”€â”€ cli # è„šæ‰‹æ¶å…¥å£
â”œâ”€â”€ command # é€šç”¨è„šæ‰‹æ¶æ¡†æ¶
â”œâ”€â”€ commit # ä»£ç æäº¤å·¥å…·
â”œâ”€â”€ init # é¡¹ç›®åˆ›å»ºå·¥å…·
â”œâ”€â”€ install # æºç ä¸‹è½½å·¥å…·
â”œâ”€â”€ lint # ä»£ç è§„èŒƒæ£€æŸ¥å·¥å…·
â””â”€â”€ utils # é€šç”¨å·¥å…·ç±»
```

### é€šç”¨è„šæ‰‹æ¶æ¡†æ¶

#### packages/utils

##### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/utils",
  "version": "0.0.0",
  "description": "cli-oweqian utils",
  // ...
  "main": "lib/index.js",
  "directories": {
    "lib": "lib",
    "test": "__tests__"
  },
  "files": [
    "lib"
  ],
  // ...
  "dependencies": {
    "axios": "^1.1.3",
    "execa": "^6.1.0",
    "fs-extra": "^10.1.0",
    "inquirer": "^9.1.3",
    "npmlog": "^6.0.2",
    "path-exists": "^5.0.0",
    "url-join": "^5.0.0"
  },
  "type": "module"
}
```

> package.json ä¸­ type = "module" æ—¶ï¼Œ.js åç¼€æ–‡ä»¶ä¼šè¢«è¯†åˆ«ä¸º ESMï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤ä¸º commonjsã€‚

##### å…¥å£æ–‡ä»¶

```javascript
import isDebug from "./isDebug.js";
import log from "./log.js";
import printErrorLog from "./printErrorLog.js";
import { makeList, makeInput, makePassword } from "./inquirer.js";
import { getLatestVersion } from "./npm.js";
import request from "./request.js";
import Github from "./git/Github.js";
import Gitee from "./git/Gitee.js";
import { getGitPlatform, clearCache } from "./git/GitServer.js";
import {
  initGitServer,
  initGitType,
  createRemotoRepo,
} from "./git/GitUtils.js";

export {
  log,
  isDebug,
  makeList,
  makeInput,
  makePassword,
  getLatestVersion,
  printErrorLog,
  request,
  Github,
  Gitee,
  getGitPlatform,
  initGitServer,
  initGitType,
  clearCache,
  createRemotoRepo,
};
```

##### å°è£… isDebug

```javascript
/**
 * æ£€æµ‹å½“å‰ Node.js è¿›ç¨‹æ˜¯å¦ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨
 * é€šè¿‡æŒ‡å®šå‘½ä»¤è¡Œå‚æ•° --debug æˆ– -d
 */
export default function isDebug() {
  return process.argv.includes("--debug") || process.argv.includes("-d");
}
```

> process.argv æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº†å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ Node.js å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¢«æ‰§è¡Œçš„ JavaScript æ–‡ä»¶çš„è·¯å¾„ï¼Œåé¢çš„å…ƒç´ æ˜¯ä¼ é€’ç»™è„šæœ¬çš„å‘½ä»¤è¡Œå‚æ•°ã€‚

##### å°è£… npmlog

```javascript
import log from "npmlog";
import isDebug from "./isDebug.js";

/**
 * æ‰“å°æ—¥å¿—
 */
if (isDebug()) {
  log.level = "verbose";
} else {
  log.level = "info";
}

log.heading = "oweqian";
log.addLevel("success", 2000, { fg: "green", bold: true });

export default log;
```

##### å°è£… printErrorLog

```javascript
import log from "./log.js";
import isDebug from "./isDebug.js";

function printErrorLog(e, type) {
  if (isDebug()) {
    log.error(type, e);
  } else {
    log.error(type, e.message);
  }
}

export default printErrorLog;
```

##### å°è£… inquirer

```javascript
import inquirer from "inquirer";

function make({
  type = "list",
  message = "è¯·é€‰æ‹©",
  defaultValue,
  validate,
  require = true,
  pageSize,
  mask = "*",
  choices,
  loop,
}) {
  const options = {
    name: "name",
    type,
    message,
    default: defaultValue,
    validate,
    require,
    pageSize,
    mask,
    loop,
  };
  if (type === "list") {
    options.choices = choices;
  }

  return inquirer.prompt(options).then((answer) => answer.name);
}

// list
export function makeList(params) {
  return make({ ...params });
}

// input
export function makeInput(params) {
  return make({
    ...params,
    type: "input",
  });
}

// password
export function makePassword(params) {
  return make({
    ...params,
    type: "password",
  });
}
```

##### å°è£… npm api

```javascript
import urlJoin from "url-join";
import axios from "axios";
import log from "./log.js";

/**
 * è·å– package ä¿¡æ¯
 */
function getNpmInfo(npmName) {
  const registry = "https://registry.npmjs.org/";
  const url = urlJoin(registry, npmName);
  return axios.get(url).then((response) => {
    try {
      return response.data;
    } catch (err) {
      return Promise.reject(err);
    }
  });
}

/**
 * è·å– package æœ€æ–°ç‰ˆæœ¬
 */
export function getLatestVersion(npmName) {
  return getNpmInfo(npmName).then((data) => {
    if (!data["dist-tags"] || !data["dist-tags"].latest) {
      log.error("æ²¡æœ‰ latest ç‰ˆæœ¬å·");
      return Promise.reject(new Error("æ²¡æœ‰ latest ç‰ˆæœ¬å·"));
    }
    return data["dist-tags"].latest;
  });
}
```

##### å°è£… axios

```javascript
import axios from "axios";

const BASE_URL = "http://127.0.0.1:7001";

const service = axios.create({
  baseURL: BASE_URL,
  timeout: 5000,
});

// æˆåŠŸ
function onSuccess(response) {
  return response.data;
}

// å¤±è´¥
function onFailed(error) {
  return Promise.reject(error);
}

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(onSuccess, onFailed);

export default service;
```

##### å°è£… Git

###### GitServer ç±»

```javascript
import path from "node:path";
import { execa } from "execa";
import { pathExistsSync } from "path-exists";
import fse from "fs-extra";
import { homedir } from "node:os";
import { makePassword } from "../inquirer.js";
import log from "../log.js";

const TEMP_HOME = ".cli-oweqian";
// ç¼“å­˜ git token
const TEMP_TOKEN = ".git_token";
// ç¼“å­˜ git æ‰˜ç®¡å¹³å°ä¿¡æ¯
const TEMP_PLATFORM = ".git_platform";
// ç¼“å­˜ git å¹³å°ç”¨æˆ·ä¿¡æ¯
const TEMP_OWN = ".git_own";
// ç¼“å­˜ git å¹³å°ç»„ç»‡ä¿¡æ¯
const TEMP_LOGIN = ".git_login";

function createTokenPath() {
  return path.resolve(homedir(), TEMP_HOME, TEMP_TOKEN);
}

function createPlatformPath() {
  return path.resolve(homedir(), TEMP_HOME, TEMP_PLATFORM);
}

function createOwnPath() {
  return path.resolve(homedir(), TEMP_HOME, TEMP_OWN);
}

function createLoginPath() {
  return path.resolve(homedir(), TEMP_HOME, TEMP_LOGIN);
}

function getGitPlatform() {
  const platformPath = createPlatformPath();
  if (pathExistsSync(platformPath)) {
    return fse.readFileSync(platformPath).toString();
  }
  return null;
}

function getGitOwn() {
  const ownPath = createOwnPath();
  if (pathExistsSync(ownPath)) {
    return fse.readFileSync(ownPath).toString();
  }
}

function getGitLogin() {
  const loginPath = createLoginPath();
  if (pathExistsSync(loginPath)) {
    return fse.readFileSync(loginPath).toString();
  }
}

function getProjectPath(cwd, fullName) {
  const projectName = fullName.split("/")[1];
  const projectPath = path.resolve(cwd, projectName);
  return projectPath;
}

function getPackageJson(cwd, fullName) {
  const projectPath = getProjectPath(cwd, fullName);
  const pkgPath = path.resolve(projectPath, "package.json");
  if (pathExistsSync(pkgPath)) {
    return fse.readJSONSync(pkgPath);
  }
  return null;
}

/**
 * æ¸…é™¤ç¼“å­˜
 */
function clearCache() {
  const platform = createPlatformPath();
  const token = createTokenPath();
  const own = createOwnPath();
  const login = createLoginPath();
  fse.removeSync(platform);
  fse.removeSync(token);
  fse.removeSync(own);
  fse.removeSync(login);
}

/**
 * å°è£… GitServer ç±»
 */
class GitServer {
  constructor() {}

  // åˆå§‹åŒ–
  async init() {
    // åˆ¤æ–­ git token æ˜¯å¦å­˜åœ¨
    const tokenPath = createTokenPath();
    if (pathExistsSync(tokenPath)) {
      this.token = fse.readFileSync(tokenPath).toString();
    } else {
      this.token = await this.getToken();
      fse.writeFileSync(tokenPath, this.token);
    }
    log.verbose("token", this.token);
    log.verbose("token path", pathExistsSync(tokenPath));
  }

  getToken() {
    return makePassword({
      message: "è¯·è¾“å…¥ token çš„ä¿¡æ¯",
    });
  }

  savePlatform(platform) {
    this.platform = platform;
    fse.writeFileSync(createPlatformPath(), platform);
  }

  saveOwn(own) {
    this.own = own;
    fse.writeFileSync(createOwnPath(), own);
  }

  saveLogin(login) {
    this.login = login;
    fse.writeFileSync(createLoginPath(), login);
  }

  getPlatform() {
    return this.platform;
  }

  getOwn() {
    return this.own;
  }

  getLogin() {
    return this.login;
  }

  // å…‹éš†ä»“åº“
  cloneRepo(fullName, tag) {
    if (tag) {
      return execa("git", ["clone", this.getRepoUrl(fullName), "-b", tag]);
    }
    return execa("git", ["clone", this.getRepoUrl(fullName)]);
  }

  // å®‰è£…ä¾èµ–
  installDependencies(cwd, fullName) {
    const projectPath = getProjectPath(cwd, fullName);
    if (pathExistsSync(projectPath)) {
      return execa(
        "npm",
        ["install", "--registry=https://registry.npmmirror.com"],
        { cwd: projectPath }
      );
    }
  }

  // å¯åŠ¨é¡¹ç›®
  async runRepo(cwd, fullName) {
    const projectPath = getProjectPath(cwd, fullName);
    const pkg = getPackageJson(cwd, fullName);

    if (pkg) {
      const { scripts, bin, name } = pkg;
      // å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆï¼šè„šæ‰‹æ¶
      if (bin) {
        await execa(
          "npm",
          ["install", "-g", name, "--registry=https://registry.npmmirror.com"],
          {
            cwd: projectPath,
            stdout: "inherit",
          }
        );
      }

      // é¡¹ç›®
      if (scripts && scripts.dev) {
        return execa("npm", ["run", "dev"], {
          cwd: projectPath,
          stdout: "inherit",
        });
      } else if (scripts && scripts.start) {
        return execa("npm", ["run", "start"], {
          cwd: projectPath,
          stdout: "inherit",
        });
      } else {
        log.warn("æœªæ‰¾åˆ°å¯åŠ¨å‘½ä»¤");
      }
    }
  }

  getUser() {
    throw new Error("gitUser must be implemented!");
  }

  getOrganization() {
    throw new Error("getOrganization must be implemented!");
  }

  createRepo() {
    throw new Error("createRepo must be implemented!");
  }
}

export { getGitPlatform, GitServer, clearCache, getGitOwn, getGitLogin };
```

###### Github

```javascript
import axios from "axios";
import { GitServer } from "./GitServer.js";
import log from "../log.js";

const BASE_URL = "https://api.github.com";

class Github extends GitServer {
  constructor() {
    super();

    this.service = axios.create({
      baseURL: BASE_URL,
      timeout: 50000,
    });

    // è¯·æ±‚æ‹¦æˆªå™¨
    this.service.interceptors.request.use(
      (config) => {
        config.headers["Authorization"] = `Bearer ${this.token}`;
        config.headers["Accept"] = "application/vnd.github+json";
        return config;
      },
      (error) => {
        return Promise.reject(error);
      }
    );

    // å“åº”æ‹¦æˆªå™¨
    this.service.interceptors.response.use(
      (response) => {
        return response.data;
      },
      (error) => {
        return Promise.reject(error);
      }
    );
  }

  // å°è£… get æ–¹æ³•
  get(url, params, headers) {
    return this.service({
      url,
      params,
      method: "get",
      headers,
    });
  }

  // å°è£… post æ–¹æ³•
  post(url, data, headers) {
    return this.service({
      url,
      data,
      method: "post",
      headers,
    });
  }

  // æœç´¢ä»“åº“
  searchRepositories(params) {
    return this.get("/search/repositories", params);
  }

  // æœç´¢æºç 
  searchCode(params) {
    return this.get("/search/code", params);
  }

  // è·å– tags
  getTags(fullName, params) {
    console.log(`/repos/${fullName}/tags`);
    return this.get(`/repos/${fullName}/tags`, params);
  }

  getRepoUrl(fullName) {
    return `https://github.com/${fullName}.git`;
  }

  getUser() {
    return this.get("/user");
  }

  getOrganization() {
    return this.get("/user/orgs");
  }

  getRepo(login, repo) {
    return this.get(
      `/repos/${login}/${repo}`,
      {},
      {
        accept: "application/vnd.github+json",
      }
    ).catch((err) => {
      return null;
    });
  }

  async createRepo(name) {
    // æ£€æŸ¥è¿œç¨‹ä»“åº“æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è·³è¿‡åˆ›å»º
    const repo = await this.getRepo(this.login, name);
    if (!repo) {
      log.info("ä»“åº“ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆ›å»º");
      if (this.own === "user") {
        return this.post(
          "/user/repos",
          { name },
          {
            accept: "application/vnd.github+json",
          }
        );
      } else if (this.own === "organization") {
        return this.post(
          `/orgs/${this.login}/repos`,
          { name },
          {
            accept: "application/vnd.github+json",
          }
        );
      }
    } else {
      log.info("ä»“åº“å­˜åœ¨ï¼Œç›´æ¥è¿”å›");
      return repo;
    }
  }
}

export default Github;
```

###### Gitee

```javascript
import axios from "axios";
import { GitServer } from "./GitServer.js";
import log from "../log.js";

const BASE_URL = "https://gitee.com/api/v5";

class Gitee extends GitServer {
  constructor() {
    super();

    this.service = axios.create({
      baseURL: BASE_URL,
      timeout: 50000,
    });

    // å“åº”æ‹¦æˆªå™¨
    this.service.interceptors.response.use(
      (response) => {
        return response.data;
      },
      (error) => {
        return Promise.reject(error);
      }
    );
  }

  // å°è£… get æ–¹æ³•
  get(url, params, headers) {
    return this.service({
      url,
      params: {
        ...params,
        access_token: this.token,
      },
      method: "get",
      headers,
    });
  }

  // å°è£… post æ–¹æ³•
  post(url, data, headers) {
    return this.service({
      url,
      data: {
        ...data,
        access_token: this.token,
      },
      method: "post",
      headers,
    });
  }

  // æœç´¢ä»“åº“
  searchRepositories(params) {
    return this.get("/search/repositories", params);
  }

  // è·å– tags
  getTags(fullName) {
    return this.get(`/repos/${fullName}/tags`);
  }

  getRepoUrl(fullName) {
    return `https://gitee.com/${fullName}.git`;
  }

  getUser() {
    return this.get("/user");
  }

  getOrganization() {
    return this.get("/user/orgs");
  }

  getRepo(owner, repo) {
    return this.get(`/repos/${owner}/${repo}`).catch((err) => {
      return null;
    });
  }

  async createRepo(name) {
    // æ£€æŸ¥è¿œç¨‹ä»“åº“æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è·³è¿‡åˆ›å»º
    const repo = await this.getRepo(this.login, name);
    if (!repo) {
      log.info("ä»“åº“ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆ›å»º");
      if (this.own === "user") {
        return this.post("/user/repos", { name });
      } else if (this.own === "organization") {
        return this.post(`/orgs/${this.login}/repos`, { name });
      }
    } else {
      log.info("ä»“åº“å­˜åœ¨ï¼Œç›´æ¥è¿”å›");
      return repo;
    }
  }
}

export default Gitee;
```

###### Git Utils

```javascript
import { getGitPlatform, getGitLogin, getGitOwn } from "./GitServer.js";
import { makeList } from "../inquirer.js";
import log from "../log.js";
import Gitee from "./Gitee.js";
import Github from "./Github.js";

/**
 * å®ä¾‹åŒ– GitServer å¯¹è±¡ã€git æ‰˜ç®¡å¹³å°ã€git token
 */
export async function initGitServer() {
  let platform = getGitPlatform();
  if (!platform) {
    platform = await makeList({
      message: "è¯·é€‰æ‹© Git å¹³å°",
      choices: [
        {
          name: "Github",
          value: "github",
        },
        {
          name: "Gitee",
          value: "gitee",
        },
      ],
    });
  }
  log.verbose("platform", platform);

  let gitAPI;
  if (platform === "github") {
    gitAPI = new Github();
  } else {
    gitAPI = new Gitee();
  }
  gitAPI.savePlatform(platform);
  await gitAPI.init();
  return gitAPI;
}

/**
 * git å¹³å°ç”¨æˆ·ä¿¡æ¯ã€git å¹³å°ç»„ç»‡ä¿¡æ¯
 */
export async function initGitType(gitAPI) {
  // ç”¨æˆ·ä¿¡æ¯
  let gitOwn = getGitOwn();
  // ç»„ç»‡ä¿¡æ¯
  let gitLogin = getGitLogin();

  if (!gitLogin && !gitOwn) {
    const user = await gitAPI.getUser();
    const organization = await gitAPI.getOrganization();
    log.verbose("user", user);
    log.verbose("organization", organization);

    // é€‰æ‹©ä»“åº“ç±»å‹
    if (!gitOwn) {
      gitOwn = await makeList({
        message: "è¯·é€‰æ‹©ä»“åº“ç±»å‹",
        choices: [
          {
            name: "User",
            value: "user",
          },
          {
            name: "Organization",
            value: "organization",
          },
        ],
      });
      log.verbose("gitOwn", gitOwn);
    }

    if (gitOwn === "user") {
      gitLogin = user?.login;
    } else {
      const organizationList = organization.map((item) => ({
        name: item.name || item.login,
        value: item.login,
      }));
      gitLogin = await makeList({
        message: "è¯·é€‰æ‹©ç»„ç»‡",
        choices: organizationList,
      });
    }
    log.verbose("gitLogin", gitLogin);
  }

  if (!gitLogin || !gitOwn) {
    throw new Error(
      'æœªè·å–åˆ°ç”¨æˆ·çš„ Git ç™»å½•ä¿¡æ¯ï¼è¯·ä½¿ç”¨ "cli-oweqian commit --clear" æ¸…é™¤ç¼“å­˜åé‡è¯•'
    );
  }

  gitAPI.saveOwn(gitOwn);
  gitAPI.saveLogin(gitLogin);
  return gitLogin;
}

export async function createRemotoRepo(gitAPI, name) {
  const ret = await gitAPI.createRepo(name);
}
```

#### packages/command

##### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/command",
  "version": "0.0.0",
  "description": "common command class",
  "main": "lib/index.js",
  // ...
  "type": "module"
}
```

##### å°è£… Command ç±» â­ï¸

åŸºäº [Commander.js](https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md) è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œæä¾›äº†ä¸€ç§æ¨¡æ¿åŒ–çš„æ–¹æ³•æ¥å¤„ç†å‘½ä»¤åˆ›å»ºå’Œæ‰§è¡Œã€‚å…·ä½“çš„å‘½ä»¤éœ€è¦é€šè¿‡ç»§æ‰¿ Command ç±»å¹¶å®ç°æ‰€éœ€çš„ getter å’Œæ–¹æ³•æ¥å®Œæˆï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä»£ç å¤ç”¨å’Œç»“æ„æ¸…æ™°ï¼Œå‡å°‘äº†é‡å¤çš„å‘½ä»¤è®¾ç½®ä»£ç ã€‚

```javascript
/**
 * å°è£… Command ç±»
 */
class Command {
  constructor(instance) {
    // å‘½ä»¤è¡Œç¨‹åºçš„å®ä¾‹
    if (!instance) {
      throw new Error("command instance must not be null!");
    }

    this.program = instance;

    const cmd = this.program.command(this.command);
    cmd.description(this.description);

    cmd.hook("preAction", () => {
      this.preAction();
    });

    cmd.hook("postAction", () => {
      this.postAction();
    });

    if (this.options?.length > 0) {
      this.options.forEach((option) => {
        cmd.option(...option);
      });
    }

    cmd.action((...params) => {
      this.action(params);
    });
  }

  // å‘½ä»¤çš„åç§°
  get command() {
    throw new Error("command must be implements");
  }

  // å‘½ä»¤çš„æè¿°ä¿¡æ¯
  get description() {
    throw new Error("description must be implements");
  }

  // å‘½ä»¤çš„é€‰é¡¹
  get options() {
    return [];
  }

  // å‘½ä»¤æ‰§è¡Œæ—¶çš„åŠ¨ä½œ
  action() {
    throw new Error("action must be implements");
  }

  // å‘½ä»¤æ‰§è¡Œå‰çš„é’©å­
  preAction() {
    // empty
  }

  // å‘½ä»¤æ‰§è¡Œåçš„é’©å­
  postAction() {
    // empty
  }
}

export default Command;
```

#### packages/cli

##### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/cli",
  "version": "0.0.0",
  "description": "oweqian cli",
  // ...
  "main": "lib/index.js",
  "bin": {
    "cli-oweqian": "bin/cli.js"
  },
  "directories": {
    "lib": "lib",
    "test": "__tests__"
  },
  "files": [
    "lib",
    "bin"
  ],
  "scripts": {
    "test": "jest"
  },
  "dependencies": {
    "@oweqian/commit": "^0.0.0",
    "@oweqian/init": "^0.0.0",
    "@oweqian/install": "^0.0.0",
    "@oweqian/lint": "^0.0.0",
    "@oweqian/utils": "^0.0.0",
    "chalk": "^5.1.0",
    "commander": "^9.4.1",
    "dirname-filename-esm": "^1.1.1",
    "fs-extra": "^10.1.0",
    "import-local": "^3.1.0",
    "semver": "^7.3.8"
  },
  "devDependencies": {
    "@babel/core": "^7.19.3",
    "@babel/preset-env": "^7.19.4",
    "execa": "^6.1.0",
    "jest": "^29.1.2"
  },
  "type": "module"
}
```

##### å¯æ‰§è¡Œæ–‡ä»¶

```javascript
#!/usr/bin/env node

import importLocal from "import-local";
import { filename } from "dirname-filename-esm";
import { log } from "@oweqian/utils";
import entry from "../lib/index.js";

const __filename = filename(import.meta);

// ä¼˜å…ˆåŠ è½½æœ¬åœ°è„šæ‰‹æ¶ç‰ˆæœ¬
if (importLocal(__filename)) {
  log.info("cli", "ä½¿ç”¨æœ¬æ¬¡ cli-oweqian ç‰ˆæœ¬");
} else {
  entry(process.argv.slice(2));
}
```

##### å…¥å£æ–‡ä»¶

```javascript
import createInitCommand from "@oweqian/init";
import createInstallCommand from "@oweqian/install";
import createLintCommand from "@oweqian/lint";
import createCommitCommand from "@oweqian/commit";
import createCLI from "./createCLI.js";
import "./exception.js";

export default function (args) {
  const program = createCLI();
  // é¡¹ç›®åˆ›å»ºå·¥å…·
  createInitCommand(program);
  // æºç ä¸‹è½½å·¥å…·
  createInstallCommand(program);
  // ä»£ç è§„èŒƒæ£€æŸ¥å·¥å…·
  createLintCommand(program);
  // ä»£ç æäº¤å·¥å…·
  createCommitCommand(program);
  program.parse(process.argv);
}
```

##### æ•è·å¼‚å¸¸æ—¥å¿—

```javascript
import { printErrorLog } from "@oweqian/utils";

// å¤„ç†æœªæ•è·çš„å¼‚å¸¸
process.on("uncaughtException", (e) => printErrorLog(e, "error"));

// å¤„ç†æœªå¤„ç†çš„ Promise Reject
process.on("unhandledRejection", (e) => printErrorLog(e, "promise"));
```

##### å‘½ä»¤è¡ŒåŸºç¡€ç»“æ„

```javascript
import path from "node:path";
import { program } from "commander";
import { dirname } from "dirname-filename-esm";
import semver from "semver";
import chalk from "chalk";
import fse from "fs-extra";
import { log } from "@oweqian/utils";

// è·å–å½“å‰æ¨¡å—çš„ç›®å½•è·¯å¾„
const __dirname = dirname(import.meta);
// è·å– package.json æ–‡ä»¶è·¯å¾„
const pkgPath = path.resolve(__dirname, "../package.json");
// è¯»å– package.json æ–‡ä»¶
const pkg = fse.readJSONSync(pkgPath);

// å®šä¹‰æœ€ä½ Node.js ç‰ˆæœ¬
const LOWEST_NODE_VERSION = "14.0.0";

// æ£€æŸ¥ Node.js ç‰ˆæœ¬
function checkNodeVersion() {
  // ä½¿ç”¨ semver æ£€æŸ¥å½“å‰è¿è¡Œçš„ Node.js ç‰ˆæœ¬æ˜¯å¦æ»¡è¶³æœ€ä½è¦æ±‚
  if (!semver.gte(process.version, LOWEST_NODE_VERSION)) {
    throw new Error(
      chalk.red(
        `cli-oweqian éœ€è¦å®‰è£… ${LOWEST_NODE_VERSION} ä»¥ä¸Šç‰ˆæœ¬çš„ Node.js`
      )
    );
  }
}

function preAction() {
  // æ£€æŸ¥Nodeç‰ˆæœ¬
  checkNodeVersion();
}

function createCLI() {
  log.info("version", pkg.version);

  program
    .name(Object.keys(pkg.bin)[0])
    .usage("<command> [options]")
    .version(pkg.version)
    .option("-d, --debug", "æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼", false)
    .hook("preAction", preAction);

  // å¤„ç† debug é€‰é¡¹
  program.on("option:debug", function () {
    if (program.opts().debug) {
      log.verbose("debug", "launch debug mode!");
    }
  });

  // å¤„ç†æœªçŸ¥å‘½ä»¤
  program.on("command:*", function (obj) {
    log.error("æœªçŸ¥çš„å‘½ä»¤ï¼š" + obj[0]);
  });

  return program;
}

export default createCLI;
```

### é¡¹ç›®åˆ›å»ºå·¥å…·

ğŸ¤” ä¸ºä»€ä¹ˆè¦å¼€å‘åˆ›å»ºé¡¹ç›®çš„è„šæ‰‹æ¶å·¥å…·ï¼Ÿ

ğŸ¤” ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ vue-cli æˆ– create-react-appï¼Ÿ

é¡¹ç›®åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¼šæ·»åŠ å¾ˆå¤š â€æœ¬åœŸåŒ–â€œ å…ƒç´ ï¼Œå¦‚ï¼šH5 å…¼å®¹ã€æ¥å£è¯·æ±‚ã€åŸ‹ç‚¹ä¸ŠæŠ¥ã€ç»„ä»¶å°è£…ã€å¸¸ç”¨å·¥å…·å‡½æ•°å°è£…ç­‰ï¼Œç”šè‡³ä¼šå¯¹æ•´å—ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤ç”¨ï¼Œå¦‚ç™»å½•ã€é€€å‡ºç­‰ï¼›

å¦‚æœé€šè¿‡ vue-cli æˆ– create-react-app è¿™äº›é€šç”¨è„šæ‰‹æ¶ï¼Œæ¯æ¬¡åœ¨åˆ›å»ºé¡¹ç›®æ—¶éƒ½è¦é‡æ–°ç¼–å†™æˆ–å¤åˆ¶è¿™äº›ä»£ç æ˜¯éå¸¸è€—æ—¶çš„ï¼Œè€Œä¸”æ— æ³•å¯¹æ¯ä¸ªå›¢é˜Ÿæˆå‘˜è¿›è¡Œçº¦æŸï¼Œç»Ÿä¸€é¡¹ç›®è§„èŒƒã€‚åˆ©ç”¨è„šæ‰‹æ¶å¯ä»¥æ¥å®Œæˆé¡¹ç›®æ¨¡æ¿çš„æ²‰æ·€å’Œæ ‡å‡†åŒ–å»ºè®¾ã€‚

#### å‡†å¤‡å·¥ä½œ

å¼€å‘å¸¸è§é¡¹ç›®çš„è„šæ‰‹æ¶å·¥å…·å‰ï¼Œæˆ‘ä»¬å…ˆåšä¸€äº›å‰æœŸå‡†å¤‡å·¥ä½œã€‚

##### æ¨¡æ¿é…ç½®åŒ–

éšç€é¡¹ç›®æ²‰æ·€ï¼Œæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šé¡¹ç›®æ¨¡ç‰ˆï¼Œå¦‚æœæŠŠè¿™äº›é¡¹ç›®æ¨¡ç‰ˆå†™æ­»åœ¨è„šæ‰‹æ¶ä¸­ï¼Œå°±æ— æ³•è¿›è¡Œçµæ´»æ‰©å±•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é€šè¿‡è„šæ‰‹æ¶ + Egg + MongoDB å®ç°ä¸€å¥—å¯çµæ´»é…ç½®å’Œæ‰©å±•çš„é¡¹ç›®æ¨¡æ¿ç®¡ç†æœºåˆ¶ï¼Œçµæ´»ã€å¿«é€Ÿçš„å®ç°é¡¹ç›®æ¨¡ç‰ˆçš„å¢åˆ æ”¹æŸ¥ã€åˆ†ç±»ç­‰åŠŸèƒ½ï¼Œè§£å†³é¡¹ç›®æ¨¡ç‰ˆæ— æ³•æ‰©å±•çš„é—®é¢˜ã€‚

###### é¡¹ç›®æ¨¡ç‰ˆåˆ¶ä½œ

æˆ‘ä»¬åˆ†åˆ«ç”¨ vue-cliã€ create-react-appã€vue-element-admin å‡†å¤‡ä¸‰ä¸ªé¡¹ç›®åšé¡¹ç›®æ¨¡ç‰ˆï¼Œç„¶ååˆ†åˆ«å‘å¸ƒåˆ° npm ä¸Šã€‚

- @oweqian/template-vue3

[npm åœ°å€](https://www.npmjs.com/package/@oweqian/template-vue3)  
[é¡¹ç›®åœ°å€](https://github.com/OweQian/template-vue3)

- @oweqian/template-react18

[npm åœ°å€](https://www.npmjs.com/package/@oweqian/template-react18)  
[é¡¹ç›®åœ°å€](https://github.com/OweQian/template-react18)

- @oweqian/template-vue-element-admin

[npm åœ°å€](https://www.npmjs.com/package/@oweqian/template-vue-element-admin)  
[é¡¹ç›®åœ°å€](https://github.com/OweQian/template-vue-element-admin)

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_06.png" alt="" width="100%" />

ğŸ¤” ä¸ºä»€ä¹ˆä½¿ç”¨ npm ç®¡ç†é¡¹ç›®æ¨¡æ¿ï¼Ÿ

ä¼˜åŠ¿ï¼š

- çœå»è‡ªå·±æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨çš„æˆæœ¬
- npm åŒ…å«äº† package çš„ç‰ˆæœ¬ç®¡ç†æœºåˆ¶
- npm æä¾›äº†å¯ä»¥æ ¹æ® package åç§°æŸ¥è¯¢ä¸‹è½½åœ°å€çš„ api
- npm å¯¹æ‰€æœ‰ä¸Šä¼ çš„ package è¿›è¡Œ cdn åŠ é€Ÿ

(pâ‰§wâ‰¦q) å˜»å˜»å˜»ï¼Œç‹ ç‹ åœ°å¤¸å°±å®Œäº†~~~~

###### Egg + MongoDB

æˆ‘ä»¬å°†é€šè¿‡ä¼ä¸šçº§æ¡†æ¶ Egg.js å®ç°åç«¯æœåŠ¡æ­å»ºï¼Œå¹¶é€šè¿‡ Restful API å®ç°æ¥å£å¼€å‘ã€‚ç„¶ååœ¨æœ¬åœ°æ­å»º MongoDB æ•°æ®åº“ï¼Œå¹¶å¯¼å…¥é¡¹ç›®æ¨¡æ¿æ•°æ®ã€‚

é¡¹ç›®åœ°å€ï¼š[cli-oweqian-server](https://github.com/OweQian/cli-oweqian-server)

- å®šä¹‰è·¯ç”±ï¼š

```
router.resources("/v1/project", controller.v1.project);
```

- å®šä¹‰ GET æ–¹æ³•ï¼š

```javascript
const Controller = require("egg").Controller;

class ProjectController extends Controller {
  // é¡¹ç›®æ¨¡ç‰ˆæŸ¥è¯¢
  async index() {
    const { ctx } = this;
    const res = await ctx.model.Project.find({});
    ctx.body = res;
  }
  // é¡¹ç›®æ¨¡ç‰ˆæŸ¥è¯¢
  async show() {
    const { ctx } = this;
    const { id } = ctx.params;
    const res = await ctx.model.Project.find({ value: id });
    if (res.length > 0) {
      ctx.body = res[0];
    } else {
      ctx.body = res;
    }
  }
}
module.exports = ProjectController;
```

- é…ç½®æ’ä»¶ä¿¡æ¯ï¼š

```javascript
// plugin.js
/** @type Egg.EggPlugin */
exports.mongoose = {
  enable: true,
  package: "egg-mongoose",
};
```

- æ›´æ–°é…ç½®ä¿¡æ¯ï¼š

```javascript
// config.default.js
config.mongoose = {
  url: "mongodb://oweqian:123456@127.0.0.1:27017/cli-oweqian",
};
```

- åˆ›å»º model ä¿¡æ¯ï¼š

```javascript
module.exports = (app) => {
  const mongoose = app.mongoose;
  const Schema = mongoose.Schema;
  const ProjectSchema = new Schema({
    name: { type: String },
    value: { type: String },
    npmName: { type: String },
    version: { type: String },
  });
  return mongoose.model("Project", ProjectSchema);
};
```

> é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šåœ¨ collections åé¢åŠ  sï¼Œå¦‚ï¼šprojectï¼Œå®é™…æŸ¥è¯¢çš„æ˜¯ projectsã€‚

- æŸ¥è¯¢ model ä¿¡æ¯ï¼š

```
const { ctx } = this;
    const res = await ctx.model.Project.find({});
    ctx.body = res;
```

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_07.png" alt="" width="100%" />

##### æ¸²æŸ“åŠ¨æ€åŒ–

ä¸Šä¸€èŠ‚æˆ‘ä»¬é€šè¿‡ Egg + MongoDB å­˜å‚¨çš„æ–¹å¼å®ç°äº†æ¨¡æ¿é…ç½®åŒ–ï¼Œå³é€šè¿‡æ•°æ®åº“é…ç½®çš„æ–¹å¼å®ç°æ¨¡æ¿çš„ä¿®æ”¹ï¼Œè€Œä¸éœ€è¦æ”¹åŠ¨è„šæ‰‹æ¶ä»£ç ã€‚

ç›®å‰æˆ‘ä»¬çš„æ¨¡æ¿éƒ½æ˜¯é™æ€çš„ï¼Œå³åˆ›å»ºæ—¶ä»€ä¹ˆæ ·ï¼Œåˆ›å»ºåè¿˜æ˜¯ä»€ä¹ˆæ ·ï¼Œå…¶ä¸­çš„å†…å®¹æ— æ³•è¿›è¡ŒåŠ¨æ€æ¸²æŸ“ã€‚è¿™æ˜¯ä¸ç¬¦åˆæ›´å¤æ‚çš„éœ€æ±‚çš„ï¼Œæ¯”å¦‚ vue çš„é¡¹ç›®æ¨¡æ¿å°±å¤§é‡ä½¿ç”¨äº† ejs è¿›è¡Œæ¨¡æ¿çš„åŠ¨æ€æ¸²æŸ“ã€‚

ğŸ¤” å¦‚ä½•å®ç°æ¨¡æ¿æ¸²æŸ“åŠ¨æ€åŒ–ï¼Ÿ

é€šè¿‡ ejs æ”¹è‰¯é¡¹ç›®æ¨¡æ¿ï¼Œç”ŸæˆåŠ¨æ€æ¨¡æ¿

- è®¾è®¡ @cli-oweqian/init çš„æ’ä»¶æœºåˆ¶
- å®ç°ä¸€ä¸ª init æ’ä»¶ï¼Œåœ¨æ’ä»¶ä¸­å®ç° ejs æ¨¡æ¿æ¸²æŸ“é€»è¾‘

æ”¹é€  @oweqian/template-vue3 æ¨¡æ¿å¹¶å‘å¸ƒåˆ° npmï¼š

```javascript
// plugins/index.js
export default async function (api) {
  const mode = await api.makeList({
    choices: [
      {
        name: "API",
        value: "api",
      },
      {
        name: "é»˜è®¤",
        value: "default",
      },
    ],
    message: "è¯·é€‰æ‹©ä»£ç æ¨¡å¼",
  });
  console.log(mode);
  return {
    mode,
  };
}
```

```
// template/package.json
{
  "name": "<%= data.name %>",
  // ...
}
```

#### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/init",
  "version": "0.0.0",
  "description": "init command",
  // ...
  "main": "lib/index.js",
  "directories": {
    "lib": "lib",
    "test": "__tests__"
  },
  "files": [
    "lib"
  ],
  // ...
  "dependencies": {
    "@oweqian/command": "^0.0.0",
    "@oweqian/utils": "^0.0.0",
    "ejs": "^3.1.8",
    "execa": "^6.1.0",
    "fs-extra": "^10.1.0",
    "glob": "^8.0.3",
    "ora": "^6.1.2",
    "path-exists": "^5.0.0"
  },
  "type": "module"
}
```

#### å…¥å£æ–‡ä»¶

```javascript
import Command from "@oweqian/command";
import { log } from "@oweqian/utils";
import createTemplate from "./createTemplate.js";
import downloadTemplate from "./downloadTemplate.js";
import installTemplate from "./installTemplate.js";

/**
 * ç»§æ‰¿ Command ç±»
 * examples:
 * cli-oweqian init
 * cli-oweqian init aa -t project -tp template-react18 --force --debug
 */
class InitCommand extends Command {
  get command() {
    return "init [name]";
  }

  get description() {
    return "init project";
  }

  get options() {
    return [
      ["-f, --force", "æ˜¯å¦å¼ºåˆ¶æ›´æ–°", false],
      ["-t, --type <type>", "åˆ›å»ºç±»å‹ï¼ˆå€¼ï¼šproject/pageï¼‰"],
      ["-tp, --template <template>", "æ¨¡æ¿åç§°"],
    ];
  }

  async action([name, opts]) {
    log.verbose("init", name, opts);
    /**
     * 1.é€‰æ‹©é¡¹ç›®æ¨¡æ¿ï¼Œç”Ÿæˆé¡¹ç›®ä¿¡æ¯
     */
    const selectedTemplate = await createTemplate(name, opts);
    log.verbose("selectedTemplate", selectedTemplate);
    /**
     * 2.ä¸‹è½½é¡¹ç›®æ¨¡æ¿è‡³ç¼“å­˜ç›®å½•
     */
    await downloadTemplate(selectedTemplate);
    /**
     * 3.å®‰è£…é¡¹ç›®æ¨¡æ¿è‡³é¡¹ç›®ç›®å½•
     */
    await installTemplate(selectedTemplate, opts);
  }

  preAction() {
    console.log("pre");
  }

  postAction() {
    console.log("post");
  }
}

function Init(instance) {
  return new InitCommand(instance);
}

export default Init;
```

#### é€‰æ‹©é¡¹ç›®æ¨¡æ¿

æä¾›åˆ›å»ºé¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯é€‰æ‹©ï¼š

- åˆ›å»ºç±»å‹ï¼šå†³å®šåˆ›å»ºçš„æ˜¯é¡¹ç›®è¿˜æ˜¯é¡µé¢
- é¡¹ç›®åç§°ï¼šå†³å®šæ–‡ä»¶å¤¹åç§°
- é¡¹ç›®æ¨¡æ¿ï¼šå†³å®šé¡¹ç›®ç±»å‹

```javascript
// ./createTemplate.js
import path from "node:path";
import { homedir } from "node:os";
import {
  makeList,
  log,
  makeInput,
  getLatestVersion,
  request,
  printErrorLog,
} from "@oweqian/utils";

const ADD_TYPE_PROJECT = "project";
const ADD_TYPE_PAGE = "page";
const ADD_TYPE = [
  {
    name: "é¡¹ç›®",
    value: ADD_TYPE_PROJECT,
  },
  {
    name: "é¡µé¢",
    value: ADD_TYPE_PAGE,
  },
];

const TEMP_HOME = ".cli-oweqian";

/**
 * é€‰æ‹©åˆ›å»ºç±»å‹
 * å†³å®šåˆ›å»ºçš„æ˜¯é¡¹ç›®æˆ–è€…é¡µé¢
 */
function getAddType() {
  return makeList({
    choices: ADD_TYPE,
    message: "è¯·é€‰æ‹©åˆå§‹åŒ–ç±»å‹",
    defaultValue: ADD_TYPE_PROJECT,
  });
}

/**
 * è¾“å…¥é¡¹ç›®åç§°
 */
function getAddName() {
  return makeInput({
    message: "è¯·è¾“å…¥é¡¹ç›®åç§°",
    defaultValue: "",
    validate: (v) => {
      if (v.length > 0) {
        return true;
      }
      return "é¡¹ç›®åç§°å¿…é¡»è¾“å…¥";
    },
  });
}

/**
 * é€‰æ‹©é¡¹ç›®æ¨¡æ¿
 */
function getAddTemplate(choices) {
  return makeList({
    choices,
    message: "è¯·é€‰æ‹©é¡¹ç›®æ¨¡æ¿",
  });
}

/**
 * é€‰æ‹©æ‰€åœ¨å›¢é˜Ÿ
 * ä¸åŒçš„å›¢é˜Ÿæœ‰ä¸åŒçš„é¡¹ç›®æ¨¡æ¿
 */
function getAddTeam(team) {
  return makeList({
    choices: team.map((item) => ({ name: item, value: item })),
    message: "è¯·é€‰æ‹©å›¢é˜Ÿ",
  });
}

/**
 * æ¨¡æ¿ç¼“å­˜ç›®å½•
 * os.homedir(): è¿”å›å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•çš„å­—ç¬¦ä¸²è·¯å¾„
 */
function makeTargetPath() {
  return path.resolve(`${homedir()}/${TEMP_HOME}`, "addTemplate");
}

/**
 * é€šè¿‡APIè·å–é¡¹ç›®æ¨¡æ¿
 */
async function getTemplateFromAPI() {
  try {
    const data = await request({
      url: "/v1/project",
      method: "get",
    });
    log.verbose("template", data);
    return data;
  } catch (e) {
    printErrorLog(e);
    return null;
  }
}

async function createTemplate(name, opts) {
  // é€šè¿‡APIè·å–é¡¹ç›®æ¨¡æ¿
  const ADD_TEMPLATE = await getTemplateFromAPI();
  if (!ADD_TEMPLATE) {
    throw new Error("é¡¹ç›®æ¨¡æ¿ä¸å­˜åœ¨");
  }

  /**
   * nameï¼šé¡¹ç›®åç§°
   * typeï¼šåˆ›å»ºç±»å‹ï¼ˆå€¼ï¼šproject/pageï¼‰
   * templateï¼šæ¨¡æ¿åç§°
   */
  const { type = null, template = null } = opts;

  // é¡¹ç›®åç§°
  let addName;
  // é€‰æ‹©çš„åˆ›å»ºç±»å‹
  let addType;
  // é€‰æ‹©çš„æ¨¡æ¿ä¿¡æ¯
  let selectedTemplate;

  // å…¼å®¹äº¤äº’å¼ï¼ˆOptionsï¼‰å’Œéäº¤äº’å¼é¡¹ç›®åˆ›å»ºé€»è¾‘
  if (type) {
    addType = type;
  } else {
    addType = await getAddType();
  }
  log.verbose("addType", addType);

  if (addType === ADD_TYPE_PROJECT) {
    if (name) {
      addName = name;
    } else {
      addName = await getAddName();
    }
    log.verbose("addName", addName);

    if (template) {
      selectedTemplate = ADD_TEMPLATE.find((tp) => tp.value === template);
      if (!selectedTemplate) {
        throw new Error(`é¡¹ç›®æ¨¡æ¿ ${template} ä¸å­˜åœ¨`);
      }
    } else {
      // è·å–å›¢é˜Ÿä¿¡æ¯
      let teamList = ADD_TEMPLATE.map((_) => _.team);
      teamList = [...new Set(teamList)];

      const addTeam = await getAddTeam(teamList);
      log.verbose("addTeam", addTeam);

      // æ ¹æ®é€‰æ‹©çš„å›¢é˜Ÿä¿¡æ¯è¿‡æ»¤æ¨¡æ¿
      let addTemplate = await getAddTemplate(
        ADD_TEMPLATE.filter((_) => _.team === addTeam)
      );
      log.verbose("addTemplate", addTemplate);

      selectedTemplate = ADD_TEMPLATE.find((_) => _.value === addTemplate);
    }
    log.verbose("selectedTemplate", selectedTemplate);

    // é€šè¿‡ package åç§°ä» npm è·å–æœ€æ–°ç‰ˆæœ¬å·
    const latestVersion = await getLatestVersion(selectedTemplate.npmName);
    log.verbose("latestVersion", latestVersion);
    selectedTemplate.version = latestVersion;

    // æ¨¡æ¿ç¼“å­˜ç›®å½•
    const targetPath = makeTargetPath();

    return {
      type: addType,
      name: addName,
      template: selectedTemplate,
      targetPath,
    };
  } else {
    throw new Error(`ç±»å‹ ${addType} ä¸æ”¯æŒ`);
  }
}

export default createTemplate;
```

#### ä¸‹è½½é¡¹ç›®æ¨¡æ¿

æ ¹æ®ä¸Šä¸€æ­¥é€‰æ‹©çš„é¡¹ç›®æ¨¡æ¿ï¼š

- ç”Ÿæˆç¼“å­˜ç›®å½•
- åˆ©ç”¨ npm api æ¥å£è·å–ä¸‹è½½è·¯å¾„
- ä¸‹è½½æ¨¡æ¿è‡³ç¼“å­˜ç›®å½•

```javascript
// ./downloadTemplate.js
import path from "node:path";
import fse from "fs-extra";
import ora from "ora";
import { execa } from "execa";
import { pathExistsSync } from "path-exists";
import { log, printErrorLog } from "@oweqian/utils";

/**
 * ğŸ ä¸‹è½½çš„æ–‡ä»¶å¤¹ä¸‹éœ€è¦å®‰è£…node_modulesç›®å½•ï¼Œå¦åˆ™ç›´æ¥ä½¿ç”¨ npm install æ— æ³•ä¸‹è½½æˆåŠŸ
 */
function getCacheDir(targetPath) {
  return path.resolve(targetPath, "node_modules");
}

function makeCacheDir(targetPath) {
  const cacheDir = getCacheDir(targetPath);
  // åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
  if (!pathExistsSync(cacheDir)) {
    // åˆ›å»ºæ–‡ä»¶å¤¹
    fse.mkdirpSync(cacheDir);
  }
}

async function downloadAddTemplate(targetPath, selectedTemplate) {
  const { npmName, version } = selectedTemplate;
  const installCommand = "npm";
  const installArgs = ["install", `${npmName}@${version}`];
  const cwd = targetPath;
  log.verbose("installArgs", installArgs);
  log.verbose("cwd", cwd);
  await execa(installCommand, installArgs, { cwd });
}

async function downloadTemplate(selectedTemplate) {
  const { targetPath, template } = selectedTemplate;
  makeCacheDir(targetPath);

  // ä¸‹è½½è¿›åº¦æ˜¾ç¤º
  const spinner = ora("æ­£åœ¨ä¸‹è½½æ¨¡æ¿...").start();

  try {
    // ä¸‹è½½æ¨¡æ¿è‡³ç¼“å­˜ç›®å½•
    await downloadAddTemplate(targetPath, template);
    log.success("ä¸‹è½½æ¨¡æ¿æˆåŠŸ");
  } catch (e) {
    printErrorLog(e);
  } finally {
    spinner.stop();
  }
}

export default downloadTemplate;
```

#### å®‰è£…é¡¹ç›®æ¨¡æ¿

ä¸‹è½½æ¨¡æ¿åˆ°æŒ‡å®šçš„ç¼“å­˜ç›®å½•åï¼š

- ä»ç¼“å­˜ç›®å½•æ‹·è´æ¨¡æ¿æ–‡ä»¶åˆ°é¡¹ç›®ç›®å½•ä¸‹
- å¿½ç•¥ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶
- æ ¹æ® --force option å¼ºåˆ¶å®‰è£…

```javascript
// ./installTemplate.js
import path from "node:path";
import fse from "fs-extra";
import ora from "ora";
import ejs from "ejs";
import glob from "glob";
import { pathExistsSync } from "path-exists";
import { log, makeInput, makeList } from "@oweqian/utils";

function getCacheFilePath(targetPath, template) {
  return path.resolve(targetPath, "node_modules", template.npmName, "template");
}

function copyFile(targetPath, template, installDir) {
  // ä»ç¼“å­˜ç›®å½•æ‰¾æ¨¡æ¿
  const originFile = getCacheFilePath(targetPath, template);
  // è¯»å– template æ–‡ä»¶å¤¹
  const fileList = fse.readdirSync(originFile);
  const spinner = ora("æ­£åœ¨æ‹·è´æ¨¡æ¿æ–‡ä»¶...").start();
  fileList.map((file) => {
    // æ‹·è´æ–‡ä»¶
    fse.copySync(`${originFile}/${file}`, `${installDir}/${file}`);
  });
  spinner.stop();
  log.success("æ¨¡æ¿æ‹·è´æˆåŠŸ");
}

function getPluginFilePath(targetPath, template) {
  return path.resolve(
    targetPath,
    "node_modules",
    template.npmName,
    "plugins",
    "index.js"
  );
}

async function ejsRender(targetPath, installDir, template, name) {
  // å¿½ç•¥ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶
  const { ignore = [] } = template;

  let data;

  // è·å–æ’ä»¶
  const pluginPath = getPluginFilePath(targetPath, template);
  if (pathExistsSync(pluginPath)) {
    // åŠ¨æ€åŠ è½½
    const pluginFn = (await import(pluginPath)).default;
    // æ‰§è¡Œæ’ä»¶
    data = await pluginFn({ makeList, makeInput });
  }

  const ejsData = {
    data: {
      name,
      ...data,
    },
  };

  // glob åŒ¹é…æ–‡ä»¶è·¯å¾„
  glob(
    "**",
    {
      cwd: installDir,
      nodir: true,
      // å¿½ç•¥ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶
      ignore: [...ignore, "**/node_modules/**"],
    },
    (err, files) => {
      files.forEach((file) => {
        const filePath = path.join(installDir, file);
        log.verbose("filePath", filePath);
        // ejs æ¨¡æ¿æ¸²æŸ“
        ejs.renderFile(filePath, ejsData, (err, result) => {
          if (!err) {
            // resultï¼šæ¸²æŸ“åçš„ html å­—ç¬¦ä¸²
            // æŠŠæ¸²æŸ“åçš„å†…å®¹å†™å›æ–‡ä»¶
            fse.writeFileSync(filePath, result);
          } else {
            log.error(err);
          }
        });
      });
    }
  );
}

async function installTemplate(selectedTemplate, opts) {
  // force: æ˜¯å¦å¼ºåˆ¶å®‰è£…
  const { force = false } = opts;
  const { targetPath, name, template } = selectedTemplate;

  // process.cwd()ï¼šè¿”å› Node.js è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•
  const rootDir = process.cwd();
  fse.ensureDirSync(targetPath);
  // é¡¹ç›®ç›®å½•
  const installDir = path.resolve(`${rootDir}/${name}`);

  if (pathExistsSync(installDir)) {
    if (!force) {
      log.error(`å½“å‰ç›®å½•ä¸‹å·²å­˜åœ¨ ${installDir} æ–‡ä»¶å¤¹`);
      return;
    } else {
      // åˆ é™¤é¡¹ç›®ç›®å½•
      fse.removeSync(installDir);
      // é‡æ–°åˆ›å»ºé¡¹ç›®ç›®å½•
      fse.ensureDirSync(installDir);
    }
  } else {
    // åˆ›å»ºé¡¹ç›®ç›®å½•
    fse.ensureDirSync(installDir);
  }

  // æ‹·è´æ¨¡æ¿æ–‡ä»¶
  copyFile(targetPath, template, installDir);

  // æ¨¡æ¿åŠ¨æ€æ¸²æŸ“
  await ejsRender(targetPath, installDir, template, name);
}

export default installTemplate;
```

#### å·¥å…·æ¼”ç¤º

ğŸŒ°ï¼šcommand help

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_08.png" alt="" width="100%" />

ğŸŒ°ï¼šreact18

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_09.png" alt="" width="100%" />

ğŸŒ°ï¼švue3

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_10.png" alt="" width="100%" />

ğŸŒ°ï¼švue-element-admin

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_11.png" alt="" width="100%" />

### æºç ä¸‹è½½å·¥å…·

ğŸ¤” ä¸ºä»€ä¹ˆè¦å¼€å‘æºç ä¸‹è½½å·¥å…·ï¼Ÿ

- npm åªèƒ½ä¸‹è½½ npm registry ä¸­çš„åŒ…ï¼Œè€Œå¯¹äºæœªä¸Šä¼  npm çš„åŒ…æ— æ³•ä¸‹è½½
- å¯¹äºæ‰˜ç®¡åˆ° github æˆ– gitee çš„é¡¹ç›®æˆ–åŒ…ï¼Œå¦‚æœæ‰‹åŠ¨ä¸‹è½½æ•ˆç‡ä½ä¸‹ï¼Œå¯ä»¥é€šè¿‡å¼€å‘æºç ä¸‹è½½å·¥å…·æ¥æå‡æ•ˆç‡ã€‚

ğŸ¤” å¦‚ä½•å®ç°æºç ä¸‹è½½å·¥å…·ï¼Ÿ

- æŒæ¡ github API å’Œ gitee API çš„ä½¿ç”¨æ–¹æ³•
- å­˜å‚¨ github æˆ– gitee çš„ tokenï¼Œå…·å¤‡ github API æˆ– gitee API çš„è°ƒç”¨æ¡ä»¶
- é€šè¿‡ github å’Œ gitee å®ç°æ ¹æ®ä»“åº“åç§°æœç´¢é¡¹ç›®ï¼Œé€‰å–æŒ‡å®šç‰ˆæœ¬ï¼ˆæ”¯æŒç¿»é¡µï¼‰
- å°†æŒ‡å®šç‰ˆæœ¬çš„æºç æ‹‰å–åˆ°æœ¬åœ°ï¼Œåœ¨æœ¬åœ°å®‰è£…ä¾èµ–ï¼Œå®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯åŠ¨é¡¹ç›®

#### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/install",
  "version": "0.0.0",
  "description": "install command",
  // ...
  "main": "lib/index.js",
  // ...
  "type": "module",
  "dependencies": {
    "@oweqian/utils": "^0.0.0",
    "@oweqian/command": "^0.0.0",
    "ora": "^6.1.2"
  }
}
```

#### å…¥å£æ–‡ä»¶

```javascript
import ora from "ora";
import Command from "@oweqian/command";
import {
  log,
  makeList,
  makeInput,
  initGitServer,
  printErrorLog,
  clearCache,
} from "@oweqian/utils";

// ä¸Šä¸€é¡µ
const PREV_PAGE = "${prev_page}";
// ä¸‹ä¸€é¡µ
const NEXT_PAGE = "${next_page}";
// æœç´¢ä»“åº“
const SEARCH_MODE_REPO = "search_repo";
// æœç´¢æºç 
const SEARCH_MODE_CODE = "search_code";

class InstallCommand extends Command {
  get command() {
    return "install";
  }

  get description() {
    return "install project";
  }

  get options() {
    return [["-c, --clear", "æ¸…ç©ºç¼“å­˜", false]];
  }

  async action([{ clear }]) {
    if (clear) {
      clearCache();
    }
    await this.generateGitAPI();
    await this.searchGitAPI();
    await this.selectTags();
    log.verbose("full_name", this.keyword);
    log.verbose("selected_tag", this.selectedTag);
    await this.downloadRepo();
    await this.installDependencies();
    await this.runRepo();
  }

  async generateGitAPI() {
    // åˆå§‹åŒ– gitAPIã€platformã€token
    this.gitAPI = await initGitServer();
  }

  async doSearch() {
    const platform = this.gitAPI.getPlatform();

    // æœç´¢ç»“æœ
    let searchResult;
    // æ€»æ¡æ•°
    let count = 0;
    // ç»„è£… choices
    let list = [];

    if (platform === "github") {
      // 2ã€ç”Ÿæˆæœç´¢å‚æ•°
      // github
      const params = {
        q: `${this.q}${this.language ? `+language:${this.language}` : ""}`,
        order: "desc",
        // sort: "stars",
        per_page: this.perPage,
        page: this.page,
      };
      log.verbose("search params", params);

      if (this.mode === SEARCH_MODE_REPO) {
        searchResult = await this.gitAPI.searchRepositories({
          ...params,
        });

        list = searchResult.items.map((item) => ({
          name: `${item.full_name}${item.description}`,
          value: item.full_name,
        }));
      } else {
        searchResult = await this.gitAPI.searchCode({
          ...params,
        });
        list = searchResult.items.map((item) => ({
          name: `${item.repository.full_name}${
            item.repository && item.repository.description
          }`,
          value: item.repository.full_name,
        }));
      }

      count = searchResult.total_count; // æ•´ä½“æ•°æ®é‡
    } else {
      // 2ã€ç”Ÿæˆæœç´¢å‚æ•°
      // gitee
      const params = {
        q: this.q,
        order: "desc",
        // sort: "stars_count",
        per_page: this.perPage,
        page: this.page,
      };
      log.verbose("search params", params);

      if (this.language) {
        params.language = this.language;
      }

      searchResult = await this.gitAPI.searchRepositories({
        ...params,
      });
      count = 999;
      list = searchResult.map((item) => ({
        name: `${item.full_name}${item.description}`,
        value: item.full_name,
      }));
    }

    /**
     * åˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦å·²ç»åˆ°è¾¾æœ€å¤§é¡µé¢
     * ç»„è£… choices çš„ä¸Šä¸€é¡µ / ä¸‹ä¸€é¡µ
     */
    if (
      (platform === "github" && this.page * this.perPage < count) ||
      list.length > 0
    ) {
      list.push({
        name: "ä¸‹ä¸€é¡µ",
        value: NEXT_PAGE,
      });
    }

    if (this.page > 1) {
      list.unshift({
        name: "ä¸Šä¸€é¡µ",
        value: PREV_PAGE,
      });
    }

    if (count > 0) {
      const keyword = await makeList({
        message:
          platform === "github"
            ? `è¯·é€‰æ‹©è¦ä¸‹è½½çš„é¡¹ç›®ï¼ˆå…±${count}æ¡æ•°æ®ï¼‰`
            : "è¯·é€‰æ‹©è¦ä¸‹è½½çš„é¡¹ç›®",
        choices: list,
      });

      if (keyword === NEXT_PAGE) {
        await this.nextPage();
      } else if (keyword === PREV_PAGE) {
        await this.prevPage();
      } else {
        // ä¸‹è½½é¡¹ç›®
        this.keyword = keyword;
      }
    }
  }

  async nextPage() {
    this.page++;
    await this.doSearch();
  }

  async prevPage() {
    this.page--;
    await this.doSearch();
  }

  async searchGitAPI() {
    // 1ã€æ”¶é›†æœç´¢å…³é”®è¯å’Œå¼€å‘è¯­è¨€
    const platform = this.gitAPI.getPlatform();

    if (platform === "github") {
      // github æ”¯æŒä»“åº“ã€æºç ä¸¤ç§æœç´¢æ–¹å¼
      this.mode = await makeList({
        message: "è¯·é€‰æ‹©æœç´¢æ¨¡å¼",
        choices: [
          {
            name: "ä»“åº“",
            value: SEARCH_MODE_REPO,
          },
          {
            name: "æºç ",
            value: SEARCH_MODE_CODE,
          },
        ],
      });
    } else {
      // gitee åªæ”¯æŒä»“åº“æœç´¢æ–¹å¼
      this.mode = SEARCH_MODE_REPO;
    }

    // æœç´¢å…³é”®å­—
    this.q = await makeInput({
      message: "è¯·è¾“å…¥æœç´¢å…³é”®è¯",
      validate(value) {
        if (value.length > 0) {
          return true;
        } else {
          return "è¯·è¾“å…¥æœç´¢å…³é”®è¯";
        }
      },
    });

    // å¼€å‘è¯­è¨€
    this.language = await makeInput({
      message: "è¯·è¾“å…¥å¼€å‘è¯­è¨€",
    });
    log.verbose("search keyword", this.q, this.language, platform);

    this.page = 1;
    this.perPage = 10;
    await this.doSearch();
  }

  async doSelectTags() {
    const platform = this.gitAPI.getPlatform();

    // æ ¹æ® keyword è·å– tags
    let tagsListChoices = [];

    if (platform === "github") {
      const params = {
        page: this.tagPage,
        per_page: this.tagPerPage,
      };
      const tagsList = await this.gitAPI.getTags(this.keyword, { ...params });

      tagsListChoices = tagsList.map((item) => ({
        name: item.name,
        value: item.name,
      }));

      if (tagsListChoices.length > 0) {
        tagsListChoices.push({
          name: "ä¸‹ä¸€é¡µ",
          value: NEXT_PAGE,
        });
      }

      if (this.tagPage > 1) {
        tagsListChoices.unshift({
          name: "ä¸Šä¸€é¡µ",
          value: PREV_PAGE,
        });
      }
    } else {
      const tagList = await this.gitAPI.getTags(this.keyword);

      tagsListChoices = tagsList.map((item) => ({
        name: item.name,
        value: item.name,
      }));
    }

    const selectedTag = await makeList({
      message: "è¯·é€‰æ‹©tag",
      choices: tagsListChoices,
    });

    if (selectedTag === NEXT_PAGE) {
      await this.nextTags();
    } else if (selectedTag === PREV_PAGE) {
      await this.prevTags();
    } else {
      this.selectedTag = selectedTag;
    }
  }

  async nextTags() {
    this.tagPage++;
    await this.doSelectTags();
  }

  async prevTags() {
    this.tagPage--;
    await this.doSelectTags();
  }

  async selectTags() {
    this.tagPage = 1;
    this.tagPerPage = 10;
    await this.doSelectTags();
  }

  async downloadRepo() {
    // æ ¹æ® keyword å’Œ selectedTag ä¸‹è½½ä»“åº“
    const spinner = ora(
      `æ­£åœ¨ä¸‹è½½: ${this.keyword}${this.selectedTag}...`
    ).start();

    try {
      await this.gitAPI.cloneRepo(this.keyword, this.selectedTag);
      log.success(`ä¸‹è½½æˆåŠŸ: ${this.keyword}(${this.selectedTag})`);
    } catch (e) {
      printErrorLog(e);
    } finally {
      spinner.stop();
    }
  }

  async installDependencies() {
    const spinner = ora(
      `æ­£åœ¨å®‰è£…ä¾èµ–: ${this.keyword}${this.selectedTag}...`
    ).start();

    try {
      let ret = await this.gitAPI.installDependencies(
        process.cwd(),
        this.keyword
      );
      if (!ret) {
        log.error(`ä¾èµ–å®‰è£…å¤±è´¥: ${this.keyword}(${this.selectedTag})`);
      } else {
        log.success(`ä¾èµ–å®‰è£…æˆåŠŸ: ${this.keyword}(${this.selectedTag})`);
      }
    } catch (e) {
      printErrorLog(e);
    } finally {
      spinner.stop();
    }
  }

  async runRepo() {
    await this.gitAPI.runRepo(process.cwd(), this.keyword);
  }
}

function Install(instance) {
  return new InstallCommand(instance);
}

export default Install;
```

#### å·¥å…·æ¼”ç¤º

ğŸŒ°ï¼šcommand help

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_12.png" alt="" width="100%" />

ğŸŒ°ï¼šGithub - react-material-admin

æºç ä¸‹è½½ï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_13.png" alt="" width="100%" />
 
é¡¹ç›®è¿è¡Œï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_14.png" alt="" width="100%" />

è¿è¡Œç»“æœï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_15.png" alt="" width="100%" />

### ä»£ç æ£€æŸ¥å·¥å…·

ğŸ¤” ä¸ºä»€ä¹ˆè¦å®ç°ä»£ç æ£€æŸ¥å·¥å…·ï¼Ÿ

- ä¸åŒçš„é¡¹ç›®ç»´æŠ¤ä¸åŒçš„ lint è§„èŒƒï¼Œå¼€å‘ä»£ç æ£€æŸ¥å·¥å…·å¯¹å›¢é˜Ÿä»£ç è§„èŒƒè¿›è¡Œç»Ÿä¸€ç®¡æ§

- åœ¨æäº¤ä»£ç å‰å¯¹é¡¹ç›®è¿›è¡Œé›†ä¸­ç®¡æ§ï¼Œå¯¹ä¸ç¬¦åˆè§„èŒƒçš„é¡¹ç›®è¿›è¡Œæ‹¦æˆª

- å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•çš„è‡ªåŠ¨è¯†åˆ«å’Œæ‰§è¡Œï¼Œé¿å…æ‰‹åŠ¨æ‰§è¡Œ

ğŸ¤” å¦‚ä½•å®ç°ä»£ç æ£€æŸ¥å·¥å…·ï¼Ÿ

- eslint é…ç½® + API è°ƒç”¨
- jest å’Œ mocha è‡ªåŠ¨åŒ–æµ‹è¯•

#### å‡†å¤‡å·¥ä½œ

ä»¥ vue ç±»å‹çš„é¡¹ç›®ä¸ºä¾‹ï¼Œæ–°å»º eslint-test é¡¹ç›®ï¼Œæ‰§è¡Œ npm init åˆå§‹åŒ–é¡¹ç›®ã€‚

ç´§æ¥ç€ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®é‡Œæ–°å»ºä¸€äº›ç›®å½•å’Œæ–‡ä»¶ï¼Œç¼–å†™ä¸€äº›å…³äº javascriptã€vue ç»„ä»¶ã€jestã€mocha çš„ä»£ç ï¼š

[é¡¹ç›®åœ°å€](https://github.com/OweQian/eslint-test)

```
eslint-test
â”œâ”€â”€ __test__
|    â”œâ”€â”€ index.js
|    â”œâ”€â”€ mocha_test.js
â”œâ”€â”€ src
|    â”œâ”€â”€ views
|    |    â”œâ”€â”€ components
|    |    |    â”œâ”€â”€ index.js
|    |    |    â”œâ”€â”€ index.vue
|    â”œâ”€â”€ index.js
|    â”œâ”€â”€ index2.js
|    â”œâ”€â”€ sum.js
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
```

#### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/lint",
  "version": "0.0.0",
  "description": "lint command",
  // ...
  "main": "lib/index.js",
  // ...
  "type": "module",
  "dependencies": {
    "@oweqian/command": "^0.0.0",
    "@oweqian/utils": "^0.0.0",
    "eslint": "^8.28.0",
    "execa": "^6.1.0",
    "fs-extra": "^10.1.0",
    "jest": "^29.3.1",
    "mocha": "^10.1.0",
    "ora": "^6.1.2",
    "path-exists": "^5.0.0"
  }
}
```

#### å…¥å£æ–‡ä»¶

```javascript
import path from "node:path";
import { ESLint } from "eslint";
import { execa } from "execa";
import ora from "ora";
import jest from "jest";
import Mocha from "mocha";
import { pathExistsSync } from "path-exists";
import fse from "fs-extra";
import Command from "@oweqian/command";
import { log, printErrorLog, makeList } from "@oweqian/utils";
import vueConfig from "./eslint/vueConfig.js";

const TEMP_HOME = ".cli-oweqian";

class LintCommand extends Command {
  get command() {
    return "lint";
  }

  get description() {
    return "lint project";
  }

  get options() {}

  extractESLint(resultText, type) {
    const problems = /([0-9]+) problems/;
    const warnings = /([0-9]+) warnings/;
    const errors = /([0-9]+) errors/;
    switch (type) {
      case "problems":
        return resultText.match(problems)[0].match(/[0-9]+/)[0];
      case "errors":
        return resultText.match(errors)[0].match(/[0-9]+/)[0];
      case "warnings":
        return resultText.match(warnings)[0].match(/[0-9]+/)[0];
      default:
        return null;
    }
  }

  parseESLintResult(resultText) {
    // eslint æ£€æŸ¥ç»“æœåˆ†ç±»
    const problems = this.extractESLint(resultText, "problems");
    const errors = this.extractESLint(resultText, "errors");
    const warnings = this.extractESLint(resultText, "warnings");
    return {
      problems: +problems || 0,
      errors: +errors || 0,
      warnings: +warnings || 0,
    };
  }

  async eslint() {
    const cwd = process.cwd();
    // 1ã€eslint
    // å‡†å¤‡å·¥ä½œï¼Œå®‰è£…ä¾èµ–
    const spinner = ora("æ­£åœ¨å®‰è£…ä¾èµ–...").start();

    try {
      // å®‰è£… eslint-plugin-vue@9.8.0
      await execa("npm", ["install", "-D", "eslint-plugin-vue@9.8.0"], {
        cwd,
        stdout: "inherit",
      });
      // å®‰è£… eslint-config-airbnb-base@15.0.0
      await execa(
        "npm",
        ["install", "-D", "eslint-config-airbnb-base@15.0.0"],
        {
          cwd,
          stdout: "inherit",
        }
      );
    } catch (e) {
      printErrorLog(e);
    } finally {
      spinner.stop();
    }

    log.info("æ­£åœ¨æ‰§è¡Œ eslint æ£€æŸ¥");

    // æ‰§è¡Œå·¥ä½œï¼Œeslint
    const eslint = new ESLint({ cwd, overrideConfig: vueConfig });
    // åŒ¹é… src ä¸‹çš„æ‰€æœ‰ jsã€vue æ–‡ä»¶
    const results = await eslint.lintFiles(["./src/**/*.js", "./src/**/*.vue"]);
    const formatter = await eslint.loadFormatter("stylish");
    const resultText = formatter.format(results);
    const eslintResult = this.parseESLintResult(resultText);

    log.verbose("eslintResult", eslintResult);
    log.success(
      "eslintæ£€æŸ¥å®Œæ¯•",
      "é—®é¢˜: " + eslintResult.problems,
      "ï¼Œé”™è¯¯: " + eslintResult.errors,
      "ï¼Œè­¦å‘Š: " + eslintResult.warnings
    );
  }

  async autoTest() {
    const cwd = process.cwd();

    // æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å‰ï¼Œè®©ç”¨æˆ·é€‰æ‹©é‡‡ç”¨å“ªç§æ–¹å¼è¿›è¡Œæµ‹è¯•
    let testMode;
    let config;
    // è¯»å–ç¼“å­˜æ–‡ä»¶ï¼Œè·å– testMode
    const oweqianConfigFile = path.resolve(cwd, TEMP_HOME);
    if (pathExistsSync(oweqianConfigFile)) {
      config = fse.readJSONSync(oweqianConfigFile);
      testMode = config.testMode;
      if (!testMode) {
        testMode = await makeList({
          message: "è¯·é€‰æ‹©è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•",
          choices: [
            { name: "jest", value: "jest" },
            { name: "mocha", value: "mocha" },
          ],
        });
        config.testMode = testMode;
        fse.writeJsonSync(oweqianConfigFile, config);
      }
    } else {
      testMode = await makeList({
        message: "è¯·é€‰æ‹©è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•",
        choices: [
          { name: "jest", value: "jest" },
          { name: "mocha", value: "mocha" },
        ],
      });
      fse.writeJsonSync(oweqianConfigFile, {
        testMode,
      });
    }

    if (testMode === "jest") {
      // 2ã€jest
      log.info("è‡ªåŠ¨æ‰§è¡Œjestæµ‹è¯•");
      await jest.run("test");
      log.success("jestæµ‹è¯•æ‰§è¡Œå®Œæ¯•");
    } else {
      // 3ã€mocha
      log.info("è‡ªåŠ¨æ‰§è¡Œmochaæµ‹è¯•");
      const mochaInstance = new Mocha();
      mochaInstance.addFile(path.resolve(cwd, "__tests__/mocha_test.js"));
      mochaInstance.run(() => {
        log.success("mochaæµ‹è¯•æ‰§è¡Œå®Œæ¯•");
      });
    }
  }

  async action() {
    // ä»£ç è§„èŒƒæ£€æŸ¥
    await this.eslint();
    // è‡ªåŠ¨åŒ–æµ‹è¯•
    await this.autoTest();
  }
}

function Lint(instance) {
  return new LintCommand(instance);
}

export default Lint;
```

#### eslint - vueConfig

```javascript
// lib/eslint/vueConfig.js
export default {
  env: {
    browser: true,
    es2021: true,
  },
  extends: ["plugin:vue/vue3-essential", "airbnb-base"],
  overrides: [],
  parserOptions: {
    ecmaVersion: "latest",
    sourceType: "module",
  },
  plugins: ["vue"],
  rules: {},
};
```

#### å·¥å…·æ¼”ç¤º

ğŸŒ°ï¼šcommand help

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_16.png" alt="" width="100%" />

ğŸŒ°ï¼šJest æµ‹è¯•

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_17.png" alt="" width="100%" />

ğŸŒ°ï¼šMocha æµ‹è¯•

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_18.png" alt="" width="100%" />

### ä»£ç æäº¤å·¥å…·

ğŸ¤” ä¸ºä»€ä¹ˆè¦å®ç°ä»£ç æäº¤å·¥å…·ï¼Ÿ

ä¼˜åŠ¿ï¼š

- è§„èŒƒä»£ç æäº¤æµç¨‹
- æå‡ä»£ç æäº¤æ•ˆç‡

å±€é™ï¼š

- æ— æ³•è‡ªåŠ¨è§£å†³ä»£ç å†²çªï¼Œéœ€è¦å¼€å‘äººå‘˜æ‰‹åŠ¨è§£å†³ä»£ç å†²çª

ğŸ¤” å¦‚ä½•å®ç°ä»£ç æäº¤å·¥å…·ï¼Ÿ

åŸºäºå¯¹ GitFlow æŒæ¡çš„æƒ…å†µä¸‹ï¼Œå®ç°ä»£ç è‡ªåŠ¨æäº¤åŠŸèƒ½éœ€è¦å®Œæˆ 4 ä¸ªé˜¶æ®µï¼š

1. è¿œç¨‹ä»“åº“åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ©ç”¨ githubã€gitee API åˆ›å»ºä»“åº“

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_19.png" alt="" width="100%" />

2. git åˆå§‹åŒ–é˜¶æ®µï¼Œçº¿ä¸Šä»“åº“å’Œæœ¬åœ°ä»£ç è¿›è¡ŒåŒæ­¥

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_20.png" alt="" width="100%" />

3. git æäº¤é˜¶æ®µï¼Œä»£ç å†²çªæƒ…å†µå¦‚ä½•å¤„ç†

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_21.png" alt="" width="100%" />

4. git å‘å¸ƒé˜¶æ®µï¼Œè‡ªåŠ¨å‘å¸ƒæµç¨‹è®¾è®¡å’Œå®ç°

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_22.png" alt="" width="100%" />

#### å‡†å¤‡å·¥ä½œ

å¼€å‘ä»£ç æäº¤å·¥å…·å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ GitFlow åŸç†ã€‚

[A successful Git branching model](https://nvie.com/posts/a-successful-git-branching-model/)

- GitFlow ä¸»æµç¨‹

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_19.jpg" alt="" width="100%" />

- GitFlow å¤šäººåä½œæµç¨‹

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_20.jpg" alt="" width="100%" />

#### è°ƒæ•´ package.json

```
{
  "name": "@oweqian/commit",
  "version": "0.0.0",
  "description": "commit command",
  // ...
  "main": "lib/index.js",
  // ...
  "type": "module",
  "dependencies": {
    "@oweqian/utils": "^0.0.0",
    "fs-extra": "^10.1.0",
    "path-exists": "^5.0.0",
    "semver": "^7.3.8",
    "simple-git": "^3.15.1"
  }
}
```

#### å…¥å£æ–‡ä»¶

```javascript
import Command from "@oweqian/command";
import path from "node:path";
import fse from "fs-extra";
import SimpleGit from "simple-git";
import semver from "semver";
import { pathExistsSync } from "path-exists";
import {
  log,
  initGitType,
  initGitServer,
  clearCache,
  createRemotoRepo,
  makeInput,
  makeList,
} from "@oweqian/utils";

class CommitCommand extends Command {
  get command() {
    return "commit";
  }

  get description() {
    return "commit project";
  }

  get options() {
    return [
      ["-c, --clear", "æ¸…ç©ºç¼“å­˜", false],
      ["-p, --publish", "å‘å¸ƒ", false],
    ];
  }

  async action([{ clear, publish }]) {
    if (clear) {
      clearCache();
    }
    // é˜¶æ®µ 1ã€è¿œç¨‹ä»“åº“åˆå§‹åŒ–
    await this.createRomoteRepo();
    // é˜¶æ®µ 2ã€git åˆå§‹åŒ–
    await this.initLocal();
    // é˜¶æ®µ 3ã€git æäº¤
    await this.commit();
    // é˜¶æ®µ 4ã€git å‘å¸ƒ
    if (publish) {
      await this.publish();
    }
  }

  async createRomoteRepo() {
    // 1ã€ç¡®å®š git å¹³å°ã€ç”Ÿæˆ git token
    this.gitAPI = await initGitServer();

    // 2ã€ç¡®å®šä»“åº“ç±»å‹
    await initGitType(this.gitAPI);

    // 3ã€åˆ›å»ºè¿œç¨‹ä»“åº“
    const dir = process.cwd();

    const pkgPath = path.resolve(dir, "package.json");
    const pkg = fse.readJSONSync(pkgPath);
    this.name = pkg.name;
    this.version = pkg.version || "1.0.0";
    await createRemotoRepo(this.gitAPI, this.name);

    // 4ã€ç”Ÿæˆ.gitignore
    const gitIgnorePath = path.resolve(dir, ".gitignore");
    if (!pathExistsSync(gitIgnorePath)) {
      log.info(".gitignore ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆ›å»º");
      fse.writeFileSync(
        gitIgnorePath,
        `.DS_Store
      node_modules
      /dist
      
      
      # local env files
      .env.local
      .env.*.local
      
      # Log files
      npm-debug.log*
      yarn-debug.log*
      yarn-error.log*
      pnpm-debug.log*
      
      # Editor directories and files
      .idea
      .vscode
      *.suo
      *.ntvs*
      *.njsproj
      *.sln
      *.sw?`
      );
      log.success(".gitignore åˆ›å»ºæˆåŠŸ");
    }
  }

  async checkNotCommitted() {
    const status = await this.git.status();

    if (
      status.not_added.length > 0 ||
      status.created.length > 0 ||
      status.deleted.length > 0 ||
      status.modified.length > 0 ||
      status.renamed.length > 0
    ) {
      log.verbose("status", status);

      // æ‰§è¡Œ git add
      await this.git.add(status.not_added);
      await this.git.add(status.created);
      await this.git.add(status.deleted);
      await this.git.add(status.modified);
      await this.git.add(status.renamed.map((item) => item.to)); // è·å–renamedå†…å®¹

      // æ‰§è¡Œ git commit -m "xxx"
      let message;
      while (!message) {
        message = await makeInput({
          message: "è¯·è¾“å…¥ commit ä¿¡æ¯: ",
        });
      }
      await this.git.commit(message);
      log.success("æœ¬åœ° commit æäº¤æˆåŠŸ");
    }
  }

  async initLocal() {
    // ç”Ÿæˆ git remote åœ°å€
    const remoteUrl = this.gitAPI.getRepoUrl(
      `${this.gitAPI.login}/${this.name}`
    );

    // åˆå§‹åŒ– git å¯¹è±¡
    this.git = SimpleGit(process.cwd());

    // åˆ¤æ–­å½“å‰é¡¹ç›®æ˜¯å¦è¿›è¡Œ git åˆå§‹åŒ–
    const gitDir = path.resolve(process.cwd(), ".git");
    if (!pathExistsSync(gitDir)) {
      // æ‰§è¡Œ git init
      await this.git.init();
      log.success("å®Œæˆ git åˆå§‹åŒ–");
    }

    // è·å–æ‰€æœ‰ remotes
    const remotes = await this.git.getRemotes();
    if (!remotes.find((remote) => remote.name === "origin")) {
      // æ‰§è¡Œ git add remote
      this.git.addRemote("origin", remoteUrl);
      log.success("æ·»åŠ  git remote", remoteUrl);
    }

    // è‡ªåŠ¨æäº¤æœªæäº¤ä»£ç 
    await this.checkNotCommitted();

    // æ‹‰å–è¿œç¨‹ main åˆ†æ”¯
    const tags = await this.git.listRemote(["--refs"]);
    log.verbose("listRemotes", tags);

    if (tags.indexOf("refs/heads/main") >= 0) {
      // æ‹‰å–è¿œç¨‹ main åˆ†æ”¯ï¼Œå®ç°ä»£ç åŒæ­¥
      await this.pullRemoteRepo("main", {
        "--allow-unrelated-histories": null,
      });
    } else {
      // æ¨é€ä»£ç åˆ°è¿œç¨‹ main åˆ†æ”¯
      await this.pushRemoteRepo("main");
    }
  }

  syncVersionToPackageJson() {
    const dir = process.cwd();
    const pkgPath = path.resolve(dir, "package.json");
    const pkg = fse.readJSONSync(pkgPath);
    if (pkg && pkg.version !== this.version) {
      pkg.version = this.version;
      fse.writeJSONSync(pkgPath, pkg, { spaces: 2 });
    }
  }

  /**
   * ç‰ˆæœ¬å·æ•°ç»„ï¼ˆæ’åºæ–¹å¼ï¼šASCï¼‰
   */
  async getRomoteBranchList(type) {
    const remoteList = await this.git.listRemote(["--refs"]);
    let reg;
    // ç”Ÿäº§ or å¼€å‘
    if (type === "release") {
      // release/0.0.1
      reg = /.+?refs\/tags\/release\/(\d+\.\d+\.\d+)/g;
    } else {
      // develop/0.0.1
      reg = /.+?refs\/tags\/develop\/(\d+\.\d+\.\d+)/g;
    }
    return remoteList
      .split("\n")
      .map((remote) => {
        const match = reg.exec(remote);
        reg.lastIndex = 0;
        // semver åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆç‰ˆæœ¬å·
        if (match && semver.valid(match[1])) {
          return match[1];
        }
      })
      .filter(Boolean)
      .sort((a, b) => {
        // ASC
        if (semver.lte(b, a)) {
          if (a === b) return 0;
          return -1;
        }
        return 1;
      });
  }

  async getCorrectVersion() {
    log.info("è·å–ä»£ç åˆ†æ”¯");

    const remoteBranchList = await this.getRomoteBranchList("release");
    let releaseVersion = null;
    if (remoteBranchList && remoteBranchList.length > 0) {
      releaseVersion = remoteBranchList[0];
    }

    const developVersion = this.version;

    if (!releaseVersion) {
      this.branch = `develop/${developVersion}`;
    } else if (semver.gt(developVersion, releaseVersion)) {
      log.info(
        `å½“å‰æœ¬åœ°ç‰ˆæœ¬å·å¤§äºçº¿ä¸Šæœ€æ–°ç‰ˆæœ¬å·`,
        `${developVersion} > ${releaseVersion}`
      );

      this.branch = `develop/${developVersion}`;
    } else {
      log.info(
        `å½“å‰çº¿ä¸Šæœ€æ–°ç‰ˆæœ¬å·å¤§äºæœ¬åœ°ç‰ˆæœ¬å·`,
        `${releaseVersion} > ${developVersion}`
      );

      const incType = await makeList({
        message: "è‡ªåŠ¨å‡çº§ç‰ˆæœ¬ï¼Œè¯·é€‰æ‹©å‡çº§ç‰ˆæœ¬ç±»å‹",
        defaultValue: "patch",
        choices: [
          {
            name: `å°ç‰ˆæœ¬ (${releaseVersion} -> ${semver.inc(
              releaseVersion,
              "patch"
            )})`,
            value: "patch",
          },
          {
            name: `ä¸­ç‰ˆæœ¬ (${releaseVersion} -> ${semver.inc(
              releaseVersion,
              "minor"
            )})`,
            value: "minor",
          },
          {
            name: `å¤§ç‰ˆæœ¬ (${releaseVersion} -> ${semver.inc(
              releaseVersion,
              "major"
            )})`,
            value: "major",
          },
        ],
      });

      const incVersion = semver.inc(releaseVersion, incType);
      this.branch = `develop/${incVersion}`;
      this.version = incVersion;
      // æ›´æ–° package.json version
      this.syncVersionToPackageJson();
    }

    log.success(`ä»£ç åˆ†æ”¯è·å–æˆåŠŸ ${this.branch}`);
  }

  async checkStash() {
    log.info("æ£€æŸ¥ stash è®°å½•");

    const stashList = await this.git.stashList();

    if (stashList.all.length > 0) {
      await this.git.stash(["pop"]);
      log.success("stash pop æˆåŠŸ");
    }
  }

  async checkConflicted() {
    log.info("ä»£ç å†²çªæ£€æŸ¥");

    const status = await this.git.status();

    if (status.conflicted.length > 0) {
      throw new Error("å½“å‰ä»£ç å­˜åœ¨å†²çªï¼Œè¯·æ‰‹åŠ¨å¤„ç†åˆå¹¶åå†è¯•ï¼");
    }

    log.success("ä»£ç å†²çªæ£€æŸ¥é€šè¿‡");
  }

  async checkoutBranch(branchName) {
    const localBranchList = await this.git.branchLocal();

    if (localBranchList.all.indexOf(branchName) >= 0) {
      await this.git.checkout(branchName);
    } else {
      await this.git.checkoutLocalBranch(branchName);
    }

    log.success(`æœ¬åœ°åˆ†æ”¯åˆ‡æ¢åˆ° ${branchName}`);
  }

  async pullRemoteRepo(branch = "main", options = {}) {
    // åˆå¹¶è¿œç¨‹åˆ†æ”¯ä»£ç 
    log.info(`åŒæ­¥è¿œç¨‹ ${branch} åˆ†æ”¯ä»£ç `);

    await this.git.pull("origin", branch, options).catch((err) => {
      log.verbose(`git pull origin ${branch}`, err.message);
      if (err.message.indexOf(`couldn't find remote ref ${branch}`) >= 0) {
        log.warn(`è·å–è¿œç¨‹ [${branch}] åˆ†æ”¯å¤±è´¥`);
      }
      process.exit(0);
    });
  }

  async pullRemoteMainAndBranch() {
    // åˆå¹¶è¿œç¨‹ main åˆ†æ”¯
    log.info(`åˆå¹¶ [main] -> [${this.branch}]`);
    await this.pullRemoteRepo();
    log.success("åˆå¹¶è¿œç¨‹ [main] åˆ†æ”¯æˆåŠŸ");
    log.info("æ£€æŸ¥è¿œç¨‹åˆ†æ”¯");

    // åˆå¹¶è¿œç¨‹å¼€å‘åˆ†æ”¯
    const remoteBranchList = await this.getRomoteBranchList();
    if (remoteBranchList.indexOf(this.version) >= 0) {
      log.info(`åˆå¹¶ [${this.branch}] -> [${this.branch}]`);
      await this.pullRemoteRepo(this.branch);
      log.success(`åˆå¹¶è¿œç¨‹ [${this.branch}] åˆ†æ”¯æˆåŠŸ`);
      await this.checkConflicted();
    } else {
      log.success(`ä¸å­˜åœ¨è¿œç¨‹åˆ†æ”¯ [${this.branch}]`);
    }
  }

  async pushRemoteRepo(branchName) {
    log.info(`æ¨é€ä»£ç è‡³è¿œç¨‹ ${branchName} åˆ†æ”¯`);
    await this.git.push("origin", branchName);
    log.success("æ¨é€ä»£ç æˆåŠŸ");
  }

  async commit() {
    // è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·
    await this.getCorrectVersion();
    // æ£€æŸ¥ stash åŒº
    await this.checkStash();
    // æ£€æŸ¥ä»£ç å†²çª
    await this.checkConflicted();
    // è‡ªåŠ¨æäº¤æœªæäº¤ä»£ç 
    await this.checkNotCommitted();
    // è‡ªåŠ¨åˆ‡æ¢åˆ†æ”¯
    await this.checkoutBranch(this.branch);
    // è‡ªåŠ¨åˆå¹¶è¿œç¨‹ main åˆ†æ”¯å’Œè¿œç¨‹å¼€å‘åˆ†æ”¯
    await this.pullRemoteMainAndBranch();
    // æ¨é€å¼€å‘åˆ†æ”¯è‡³è¿œç¨‹å¼€å‘åˆ†æ”¯
    await this.pushRemoteRepo(this.branch);
  }

  async checkTag() {
    log.info("è·å–è¿œç¨‹ tag åˆ—è¡¨");

    const tag = `release/${this.version}`;
    const tagList = await this.getRomoteBranchList("release");

    if (tagList.includes(this.version)) {
      log.info("è¿œç¨‹ tag å·²å­˜åœ¨", tag);
      await this.git.push(["origin", `:refs/tags/${tag}`]);
      log.success("è¿œç¨‹ tag å·²åˆ é™¤", tag);
    }

    const localTagList = await this.git.tags();

    if (localTagList.all.includes(tag)) {
      log.info("æœ¬åœ° tag å·²å­˜åœ¨", tag);
      await this.git.tag(["-d", tag]);
      log.success("æœ¬åœ° tag å·²åˆ é™¤", tag);
    }

    await this.git.addTag(tag);
    log.success("æœ¬åœ° tag åˆ›å»ºæˆåŠŸ", tag);

    await this.git.pushTags("origin");
    log.success("è¿œç¨‹ tag æ¨é€æˆåŠŸ", tag);
  }

  async mergeBranchToMain() {
    log.info("å¼€å§‹åˆå¹¶ä»£ç ", `[${this.branch}] -> [main]`);
    await this.git.mergeFromTo(this.branch, "main");
    log.success("ä»£ç åˆå¹¶æˆåŠŸ", `[${this.branch}] -> [main]`);
  }

  async deleteLocalBranch() {
    log.info("å¼€å§‹åˆ é™¤æœ¬åœ°åˆ†æ”¯", this.branch);
    await this.git.deleteLocalBranch(this.branch);
    log.success("åˆ é™¤æœ¬åœ°åˆ†æ”¯æˆåŠŸ", this.branch);
  }

  async deleteRemoteBranch() {
    log.info("å¼€å§‹åˆ é™¤è¿œç¨‹åˆ†æ”¯", this.branch);
    await this.git.push(["origin", "--delete", this.branch]);
    log.success("åˆ é™¤è¿œç¨‹åˆ†æ”¯æˆåŠŸ", this.branch);
  }

  async publish() {
    // åˆ›å»º Tag å¹¶æ¨é€è‡³è¿œç¨‹ Tag
    await this.checkTag();
    // æœ¬åœ°åˆ‡æ¢åˆ° main åˆ†æ”¯
    await this.checkoutBranch("main");
    // å°†å¼€å‘åˆ†æ”¯ä»£ç åˆå¹¶åˆ° main åˆ†æ”¯
    await this.mergeBranchToMain();
    // æ¨é€è¿œç¨‹ main åˆ†æ”¯
    await this.pushRemoteRepo("main");
    // åˆ é™¤æœ¬åœ°å¼€å‘åˆ†æ”¯
    await this.deleteLocalBranch();
    // åˆ é™¤è¿œç¨‹å¼€å‘åˆ†æ”¯
    await this.deleteRemoteBranch();
  }
}

function Commit(instance) {
  return new CommitCommand(instance);
}

export default Commit;
```

#### å·¥å…·æ¼”ç¤º

ğŸŒ°ï¼šcommand help

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_23.png" alt="" width="100%" />

ğŸŒ°ï¼šGithub User

[é¡¹ç›®åœ°å€](https://github.com/OweQian/github-user-demo)

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_24.png" alt="" width="100%" />

ğŸŒ°ï¼šGithub Organization

[é¡¹ç›®åœ°å€](https://github.com/oweqianxyz/github-org-demo)

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_25.png" alt="" width="100%" />

ğŸŒ°ï¼šGitee User

[é¡¹ç›®åœ°å€](https://gitee.com/wangxiaobai2019/gitee-user-demo)

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_26.png" alt="" width="100%" />

ç‰ˆæœ¬å‘å¸ƒï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_28.png" alt="" width="100%" />

ç‰ˆæœ¬å‡çº§ï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_29.png" alt="" width="100%" />

ğŸŒ°ï¼šGitee Organization

[é¡¹ç›®åœ°å€](https://gitee.com/oweqian/gitee-org-demo)

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_27.png" alt="" width="100%" />

### è„šæ‰‹æ¶äº‘å‘å¸ƒ

ğŸ¤” ä¸ºä»€ä¹ˆè¦å®ç°è‡ªåŠ¨å‘å¸ƒï¼Ÿ

ä¼˜åŠ¿ï¼š

- å‡å°‘å‘å¸ƒè¿‡ç¨‹ä¸­çš„æ‰‹åŠ¨æ“ä½œæˆæœ¬ï¼Œå¤§å¹…æå‡ CI/CD æ•ˆç‡ï¼Œå¿«é€Ÿå®ç°é¡¹ç›®å‘å¸ƒä¸Šçº¿

å±€é™ï¼š

- å­˜åœ¨è¾ƒé«˜çš„æŠ€æœ¯é—¨æ§›
- éœ€è¦ç§Ÿç”¨é¢å¤–çš„æœåŠ¡ï¼Œä¼šäº§ç”ŸæŠ€æœ¯æˆæœ¬

ğŸ¤” å¦‚ä½•å®ç°è‡ªåŠ¨å‘å¸ƒï¼Ÿ

- æ–¹æ¡ˆ 1ï¼šå®Œå…¨è‡ªä¸»å®ç°è‡ªåŠ¨å‘å¸ƒé€»è¾‘
- æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ github actions
- æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ docker + jenkins

#### Github Actions

[Github Actions](https://docs.github.com/en/actions) æ˜¯ Github å®˜æ–¹æ¨å‡ºçš„ CI/CD è§£å†³æ–¹æ¡ˆ

å·¥ä½œåŸç†ï¼š

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_34.png" alt="" width="100%" />

#### å·¥å…·æ¼”ç¤º

ğŸ“¢ å› ä¸ºæœ¬äººæ²¡æœ‰å……è¶³ ğŸ’° è´­ä¹°æœåŠ¡å™¨å’ŒåŸŸåï¼Œæ‰€ä»¥åªè·‘äº†ä¸‹å¤§æ¦‚æµç¨‹ï¼Œå¦‚æœæ‚¨æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡ŒæŸ¥æ‰¾å…¶ä»–èµ„æ–™ã€‚

ğŸŒ°ï¼šGithub Actions

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_30.png" alt="" width="100%" />

ğŸŒ°ï¼šdocker + jenkins

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_31.png" alt="" width="100%" />

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_32.png" alt="" width="100%" />

<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/cli/img_33.png" alt="" width="100%" />

## å†™åœ¨æœ€å

Everything will be okay in the end. If it's not okay, it's not the end.
