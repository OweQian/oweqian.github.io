<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ğŸ‘©â€ğŸ’» åŸºäº Electron &#43; Vue3 çš„æ¡Œé¢åº”ç”¨å¼€å‘å®æˆ˜ - OweQian</title><meta name="Description" content="Hugo theme - LoveIt"><meta property="og:title" content="ğŸ‘©â€ğŸ’» åŸºäº Electron &#43; Vue3 çš„æ¡Œé¢åº”ç”¨å¼€å‘å®æˆ˜" />
<meta property="og:description" content="é¡¹ç›®åœ°å€ï¼š ElectronVue3" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://oweqian.xyz/electron/" /><meta property="og:image" content="http://oweqian.xyz/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-07T10:20:47+08:00" />
<meta property="article:modified_time" content="2023-03-16T11:21:02+08:00" /><meta property="og:site_name" content="OweQian" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://oweqian.xyz/logo.png"/>

<meta name="twitter:title" content="ğŸ‘©â€ğŸ’» åŸºäº Electron &#43; Vue3 çš„æ¡Œé¢åº”ç”¨å¼€å‘å®æˆ˜"/>
<meta name="twitter:description" content="é¡¹ç›®åœ°å€ï¼š ElectronVue3"/>
<meta name="application-name" content="OweQian">
<meta name="apple-mobile-web-app-title" content="OweQian"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://oweqian.xyz/electron/" /><link rel="prev" href="http://oweqian.xyz/books/" /><link rel="next" href="http://oweqian.xyz/draw/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ğŸ‘©â€ğŸ’» åŸºäº Electron + Vue3 çš„æ¡Œé¢åº”ç”¨å¼€å‘å®æˆ˜",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/oweqian.xyz\/electron\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "http:\/\/oweqian.xyz\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "ç¬¬ä¸€æŠ€èƒ½","wordcount":  30148 ,
        "url": "http:\/\/oweqian.xyz\/electron\/","datePublished": "2023-02-07T10:20:47+08:00","dateModified": "2023-03-16T11:21:02+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/oweqian.xyz\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "OweQian"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="OweQian"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>OweQian</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="https://github.com/OweQian" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="OweQian"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>OweQian</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="https://github.com/OweQian" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ğŸ‘©â€ğŸ’» åŸºäº Electron + Vue3 çš„æ¡Œé¢åº”ç”¨å¼€å‘å®æˆ˜</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>OweQian</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E7%AC%AC%E4%B8%80%E6%8A%80%E8%83%BD/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>ç¬¬ä¸€æŠ€èƒ½</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-02-07">2023-02-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;çº¦ 30148 å­—&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;é¢„è®¡é˜…è¯» 61 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#æ„å»ºå¼€å‘ç¯å¢ƒ">æ„å»ºå¼€å‘ç¯å¢ƒ</a>
      <ul>
        <li><a href="#åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</a></li>
        <li><a href="#åˆ›å»ºä¸»è¿›ç¨‹ä»£ç ">åˆ›å»ºä¸»è¿›ç¨‹ä»£ç </a></li>
        <li><a href="#å¼€å‘ç¯å¢ƒ-vite-æ’ä»¶">å¼€å‘ç¯å¢ƒ Vite æ’ä»¶</a></li>
        <li><a href="#æ¸²æŸ“è¿›ç¨‹é›†æˆå†…ç½®æ¨¡å—">æ¸²æŸ“è¿›ç¨‹é›†æˆå†…ç½®æ¨¡å—</a></li>
        <li><a href="#è®¾ç½®æ¨¡å—åˆ«åä¸è§£æé’©å­">è®¾ç½®æ¨¡å—åˆ«åä¸è§£æé’©å­</a></li>
      </ul>
    </li>
    <li><a href="#æ„å»ºç”Ÿäº§ç¯å¢ƒ">æ„å»ºç”Ÿäº§ç¯å¢ƒ</a>
      <ul>
        <li><a href="#ç¼–è¯‘ç»“æŸé’©å­å‡½æ•°">ç¼–è¯‘ç»“æŸé’©å­å‡½æ•°</a></li>
        <li><a href="#åˆ¶ä½œåº”ç”¨å®‰è£…åŒ…">åˆ¶ä½œåº”ç”¨å®‰è£…åŒ…</a></li>
        <li><a href="#ä¸»è¿›ç¨‹ç”Ÿäº§ç¯å¢ƒåŠ è½½æœ¬åœ°æ–‡ä»¶">ä¸»è¿›ç¨‹ç”Ÿäº§ç¯å¢ƒåŠ è½½æœ¬åœ°æ–‡ä»¶</a></li>
      </ul>
    </li>
    <li><a href="#è®¾è®¡å·¥ç¨‹é¡¹ç›®ç»“æ„">è®¾è®¡å·¥ç¨‹é¡¹ç›®ç»“æ„</a></li>
    <li><a href="#å¼•å…¥-vue-router">å¼•å…¥ vue-router</a></li>
    <li><a href="#èœå•ç»„ä»¶åŠè·³è½¬">èœå•ç»„ä»¶åŠè·³è½¬</a></li>
    <li><a href="#å¼•å…¥å­—ä½“å›¾æ ‡">å¼•å…¥å­—ä½“å›¾æ ‡</a></li>
    <li><a href="#ç®¡æ§åº”ç”¨çª—å£">ç®¡æ§åº”ç”¨çª—å£</a>
      <ul>
        <li><a href="#ä¸»çª—å£æ˜¾ç¤ºæ—¶æœº">ä¸»çª—å£æ˜¾ç¤ºæ—¶æœº</a></li>
        <li><a href="#è‡ªå®šä¹‰çª—å£æ ‡é¢˜æ ">è‡ªå®šä¹‰çª—å£æ ‡é¢˜æ </a></li>
        <li><a href="#çª—å£åŠ è½½è¿‡æ…¢è§£å†³æ–¹æ¡ˆ">çª—å£åŠ è½½è¿‡æ…¢è§£å†³æ–¹æ¡ˆ</a>
          <ul>
            <li><a href="#çª—å£æ± è§£å†³æ–¹æ¡ˆ">çª—å£æ± è§£å†³æ–¹æ¡ˆ</a></li>
            <li><a href="#windowopen-è§£å†³æ–¹æ¡ˆ">window.open è§£å†³æ–¹æ¡ˆ</a>
              <ul>
                <li><a href="#å­çª—å£çš„æ ‡é¢˜æ æ¶ˆæ¯">å­çª—å£çš„æ ‡é¢˜æ æ¶ˆæ¯</a></li>
                <li><a href="#åŠ¨æ€è®¾ç½®å­çª—å£çš„é…ç½®">åŠ¨æ€è®¾ç½®å­çª—å£çš„é…ç½®</a></li>
                <li><a href="#å°è£…å­çª—å£åŠ è½½æˆåŠŸçš„äº‹ä»¶">å°è£…å­çª—å£åŠ è½½æˆåŠŸçš„äº‹ä»¶</a></li>
                <li><a href="#çˆ¶å­çª—å£äº’ç›¸é€šä¿¡">çˆ¶å­çª—å£äº’ç›¸é€šä¿¡</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#pinia-ç®¡ç†åº”ç”¨çŠ¶æ€">Pinia ç®¡ç†åº”ç”¨çŠ¶æ€</a>
      <ul>
        <li><a href="#å®‰è£…-pinia">å®‰è£… Pinia</a></li>
        <li><a href="#åˆ›å»º-store">åˆ›å»º Store</a></li>
        <li><a href="#æ•°æ®æ¨¡å‹--model">æ•°æ®æ¨¡å‹  Model</a></li>
        <li><a href="#ä½¿ç”¨-store">ä½¿ç”¨ Store</a></li>
        <li><a href="#è®¢é˜…-store">è®¢é˜… Store</a></li>
        <li><a href="#äº’è®¿-store">äº’è®¿ Store</a></li>
      </ul>
    </li>
    <li><a href="#å®¢æˆ·ç«¯æ•°æ®åº“">å®¢æˆ·ç«¯æ•°æ®åº“</a>
      <ul>
        <li><a href="#å®‰è£…-sqlite">å®‰è£… SQLite</a></li>
        <li><a href="#å‹ç¼©å®‰è£…åŒ…ä½“ç§¯">å‹ç¼©å®‰è£…åŒ…ä½“ç§¯</a></li>
        <li><a href="#å®‰è£…-knexjs">å®‰è£… Knex.js</a></li>
        <li><a href="#è®¿é—®æ•°æ®åº“">è®¿é—®æ•°æ®åº“</a></li>
        <li><a href="#æ•°æ®åº“åŸºæœ¬æ“ä½œ">æ•°æ®åº“åŸºæœ¬æ“ä½œ</a>
          <ul>
            <li><a href="#å¢åŠ æ•°æ®">å¢åŠ æ•°æ®</a></li>
            <li><a href="#æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</a></li>
            <li><a href="#ä¿®æ”¹æ•°æ®">ä¿®æ”¹æ•°æ®</a></li>
            <li><a href="#åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</a></li>
            <li><a href="#äº‹åŠ¡">äº‹åŠ¡</a></li>
            <li><a href="#åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#å¼€å‘åŸç”Ÿæ¨¡å—">å¼€å‘åŸç”Ÿæ¨¡å—</a>
      <ul>
        <li><a href="#æ­å»ºå¼€å‘ç¯å¢ƒ">æ­å»ºå¼€å‘ç¯å¢ƒ</a></li>
        <li><a href="#è¯»å–å‰ªåˆ‡æ¿æ–‡ä»¶è·¯å¾„">è¯»å–å‰ªåˆ‡æ¿æ–‡ä»¶è·¯å¾„</a></li>
        <li><a href="#ç¼–è¯‘åŸç”Ÿæ¨¡å—">ç¼–è¯‘åŸç”Ÿæ¨¡å—</a></li>
      </ul>
    </li>
    <li><a href="#åº”ç”¨å‡çº§æ–¹æ¡ˆ">åº”ç”¨å‡çº§æ–¹æ¡ˆ</a>
      <ul>
        <li><a href="#å…¨é‡å‡çº§">å…¨é‡å‡çº§</a></li>
        <li><a href="#å¢é‡å‡çº§">å¢é‡å‡çº§</a></li>
      </ul>
    </li>
    <li><a href="#è°ƒè¯•çº¿ä¸Šåº”ç”¨">è°ƒè¯•çº¿ä¸Šåº”ç”¨</a>
      <ul>
        <li><a href="#ä¸šåŠ¡ä»£ç è§£æ">ä¸šåŠ¡ä»£ç è§£æ</a></li>
        <li><a href="#ç”Ÿäº§ç¯å¢ƒè°ƒè¯•">ç”Ÿäº§ç¯å¢ƒè°ƒè¯•</a></li>
        <li><a href="#åˆ†æå´©æºƒæŠ¥å‘Š">åˆ†æå´©æºƒæŠ¥å‘Š</a></li>
      </ul>
    </li>
    <li><a href="#å…¶å®ƒ">å…¶å®ƒ</a>
      <ul>
        <li><a href="#åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•">åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•</a></li>
        <li><a href="#åº”ç”¨ç¨‹åºç¼“å­˜ç›®å½•">åº”ç”¨ç¨‹åºç¼“å­˜ç›®å½•</a></li>
        <li><a href="#çª—å£é’‰åœ¨æ¡Œé¢ä¸Š">çª—å£é’‰åœ¨æ¡Œé¢ä¸Š</a></li>
        <li><a href="#æ–‡ä»¶é‡æ–°ä¸Šä¼ ">æ–‡ä»¶é‡æ–°ä¸Šä¼ </a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/OweQian/ElectronVue3" target="_blank" rel="noopener noreffer ">ElectronVue3</a></p>
<h2 id="æ„å»ºå¼€å‘ç¯å¢ƒ">æ„å»ºå¼€å‘ç¯å¢ƒ</h2>
<p>æŒ‰å¦‚ä¸‹æ­¥éª¤æ­å»ºå¼€å‘ç¯å¢ƒï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img.png" alt="" width="700" />  
<h3 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</h3>
<p>é¦–å…ˆé€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ª Vue é¡¹ç›®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm create vite@latest electron -- --template vue-ts
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£… electron ä¾èµ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm i electron -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>è°ƒæ•´ package.json æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;name&#34;: &#34;electron&#34;,
</span></span><span class="line"><span class="cl">  &#34;private&#34;: true,
</span></span><span class="line"><span class="cl">  &#34;version&#34;: &#34;0.0.0&#34;,
</span></span><span class="line"><span class="cl">  &#34;scripts&#34;: {
</span></span><span class="line"><span class="cl">    &#34;dev&#34;: &#34;vite&#34;,
</span></span><span class="line"><span class="cl">    &#34;build&#34;: &#34;vue-tsc --noEmit &amp;&amp; vite build&#34;,
</span></span><span class="line"><span class="cl">    &#34;preview&#34;: &#34;vite preview&#34;
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  &#34;dependencies&#34;: {},
</span></span><span class="line"><span class="cl">  &#34;devDependencies&#34;: {
</span></span><span class="line"><span class="cl">    &#34;@vitejs/plugin-vue&#34;: &#34;^4.0.0&#34;,
</span></span><span class="line"><span class="cl">    &#34;electron&#34;: &#34;^22.0.3&#34;,
</span></span><span class="line"><span class="cl">    &#34;typescript&#34;: &#34;^4.9.3&#34;,
</span></span><span class="line"><span class="cl">    &#34;vite&#34;: &#34;^4.0.0&#34;,
</span></span><span class="line"><span class="cl">    &#34;vue-tsc&#34;: &#34;^1.0.11&#34;,
</span></span><span class="line"><span class="cl">    &#34;vue&#34;: &#34;^3.2.45&#34;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å°† vue ä» dependencies ç§»åˆ° devDependenciesã€‚</li>
</ul>
<p>åœ¨ Vite ç¼–è¯‘é¡¹ç›®çš„æ—¶å€™ï¼ŒVue åº“ä¼šè¢«ç¼–è¯‘åˆ°è¾“å‡ºç›®å½•ä¸‹ï¼Œè¾“å‡ºç›®å½•ä¸‹çš„å†…å®¹æ˜¯å®Œæ•´çš„ï¼Œæ²¡å¿…è¦æŠŠ Vue æ ‡è®°ä¸ºç”Ÿäº§ä¾èµ–ï¼›è€Œä¸”åœ¨æˆ‘ä»¬å°†æ¥åˆ¶ä½œå®‰è£…åŒ…çš„æ—¶å€™ï¼Œè¿˜è¦ç”¨åˆ°è¿™ä¸ª package.json æ–‡ä»¶ï¼Œå®ƒçš„ç”Ÿäº§ä¾èµ–é‡Œä¸åº”è¯¥æœ‰æ²¡ç”¨çš„ä¸œè¥¿ã€‚</p>
<ul>
<li>å»æ‰ type: module é…ç½®é¡¹ã€‚</li>
</ul>
<p>package.json é‡Œçš„ type å®šä¹‰äº†è¿™ä¸ªé¡¹ç›®æ‰€æœ‰ .js æ–‡ä»¶çš„å¤„ç†æ–¹å¼ã€‚ å¦‚æœ type çš„å€¼ä¸º moduleï¼Œé‚£ä¹ˆæ‰€æœ‰ .js æ–‡ä»¶å°†è¢«å½“åš ES Modules å¯¹å¾…ã€‚å¦‚æœ type çš„å€¼ä¸º commonjsï¼Œé‚£ä¹ˆæ‰€æœ‰ .js æ–‡ä»¶å°†è¢«å½“åš CommonJS æ¨¡å—å¯¹å¾…ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® typeï¼Œé‚£ä¹ˆå®ƒçš„é»˜è®¤å€¼ä¸º commonjsã€‚</p>
<h3 id="åˆ›å»ºä¸»è¿›ç¨‹ä»£ç ">åˆ›å»ºä¸»è¿›ç¨‹ä»£ç </h3>
<p>æ–°å»ºä¸»è¿›ç¨‹å…¥å£æ–‡ä»¶ï¼šsrc/main/mainEntry.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">BrowserWindow</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;electron&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainWindow</span>: <span class="kt">BrowserWindow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">whenReady</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">({});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>app æ˜¯ Electron çš„å…¨å±€å¯¹è±¡ï¼Œç”¨äºæ§åˆ¶æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>Electron åˆå§‹åŒ–å®Œæˆåï¼Œapp å¯¹è±¡çš„ ready äº‹ä»¶è¢«è§¦å‘ã€‚</p>
<p>app ready ååˆ›å»ºä¸€ä¸ª BrowserWindow å¯¹è±¡ï¼ŒmainWindow è¢«è®¾ç½®ä¸ºä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé¿å…è¢« JS åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚</p>
<p>çª—å£åŠ è½½äº†ä¸€ä¸ª Url è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„ä»¥å‘½ä»¤è¡Œå‚æ•°ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰çš„æ–¹å¼ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚</p>
<p>app å’Œ BrowserWindow éƒ½æ˜¯ Electron çš„å†…ç½®æ¨¡å—ï¼Œè¿™äº›å†…ç½®æ¨¡å—æ˜¯é€šè¿‡ ES Module çš„å½¢å¼å¯¼å…¥è¿›æ¥çš„ã€‚</p>
<h3 id="å¼€å‘ç¯å¢ƒ-vite-æ’ä»¶">å¼€å‘ç¯å¢ƒ Vite æ’ä»¶</h3>
<p>ä¸»è¿›ç¨‹çš„ä»£ç å†™å¥½åï¼Œéœ€è¦ç¼–è¯‘è¿‡ä¹‹åæ‰èƒ½è¢« Electron åŠ è½½ï¼Œé€šè¿‡ Vite æ’ä»¶çš„å½¢å¼æ¥å®Œæˆç¼–è¯‘å’ŒåŠ è½½å·¥ä½œã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ViteDevServer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vite&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">IAddressInfo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">address</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">port</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">let</span> <span class="nx">devPlugin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;dev-plugin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">configureServer</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">ViteDevServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;esbuild&#39;</span><span class="p">).</span><span class="nx">buildSync</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">entryPoints</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./src/main/mainEntry.ts&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">bundle</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">platform</span><span class="o">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">outfile</span><span class="o">:</span> <span class="s1">&#39;./dist/mainEntry.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">external</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;electron&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">server</span><span class="o">?</span><span class="p">.</span><span class="nx">httpServer</span><span class="o">?</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;listening&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="p">{</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">addressInfo</span>: <span class="kt">IAddressInfo</span> <span class="o">=</span> <span class="nx">server</span><span class="o">?</span><span class="p">.</span><span class="nx">httpServer</span><span class="o">?</span><span class="p">.</span><span class="nx">address</span><span class="p">()</span> <span class="kr">as</span> <span class="kt">unknown</span> <span class="kr">as</span> <span class="nx">IAddressInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">httpAddress</span> <span class="o">=</span> <span class="sb">`http://</span><span class="si">${</span><span class="nx">addressInfo</span><span class="o">?</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">addressInfo</span><span class="o">?</span><span class="p">.</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">electronProcess</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="kr">require</span><span class="p">(</span><span class="s1">&#39;electron&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;./dist/mainEntry.js&#39;</span><span class="p">,</span> <span class="nx">httpAddress</span><span class="p">],</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">cwd</span>: <span class="kt">process.cwd</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">stdio</span><span class="o">:</span> <span class="s1">&#39;inherit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="nx">electronProcess</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨å†Œäº†ä¸€ä¸ªåä¸º configureServer çš„é’©å­ï¼Œå½“ Vite å¯åŠ¨ Http æœåŠ¡æ—¶ï¼ŒconfigureServer ä¼šæ‰§è¡Œã€‚</p>
<p>å…¥å‚ä¸ºç±»å‹ä¸º ViteDevServer çš„å¯¹è±¡ serverï¼Œserver æŒæœ‰ä¸€ä¸ª http.Server ç±»å‹çš„å±æ€§ httpServerï¼Œè¿™ä¸ªå±æ€§ä»£è¡¨è°ƒè¯• Vue é¡µé¢çš„ http æœåŠ¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åœ°å€ä¸ºï¼šhttp://127.0.0.1:5173/ã€‚</p>
<p>é€šè¿‡ç›‘å¬ server.httpServer çš„ listening äº‹ä»¶æ¥åˆ¤æ–­ httpServer æ˜¯å¦å·²ç»æˆåŠŸå¯åŠ¨ã€‚å¦‚æœå·²ç»æˆåŠŸå¯åŠ¨ï¼Œå°±å¯åŠ¨ Electron åº”ç”¨ï¼Œå¹¶ç»™å®ƒä¼ é€’ä¸¤ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸»è¿›ç¨‹ä»£ç ç¼–è¯‘åçš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Vue é¡µé¢çš„ http åœ°å€ã€‚</p>
<p>é€šè¿‡ Node.js child_process æ¨¡å—çš„ spawn æ–¹æ³•å¯åŠ¨ electron å­è¿›ç¨‹ï¼Œé™¤äº†ä¸¤ä¸ªå‘½ä»¤è¡Œå‚æ•°å¤–ï¼Œè¿˜ä¼ é€’äº†ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚</p>
<p>è¿™ä¸ªå¯¹è±¡çš„ cwd å±æ€§ç”¨äºè®¾ç½®å½“å‰çš„å·¥ä½œç›®å½•ï¼Œprocess.cwd() è¿”å›çš„å€¼å°±æ˜¯å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</p>
<p>stdio ç”¨äºè®¾ç½® electron è¿›ç¨‹çš„æ§åˆ¶å°è¾“å‡ºï¼Œè¿™é‡Œè®¾ç½® inherit å¯ä»¥è®© electron å­è¿›ç¨‹çš„æ§åˆ¶å°è¾“å‡ºæ•°æ®åŒæ­¥åˆ°ä¸»è¿›ç¨‹çš„æ§åˆ¶å°ã€‚</p>
<p>åœ¨ä¸»è¿›ç¨‹ä¸­ console.log çš„å†…å®¹å°±å¯ä»¥åœ¨ VSCode çš„æ§åˆ¶å°ä¸Šçœ‹åˆ°äº†ã€‚</p>
<p>å½“ electron å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œè¦å…³é—­ Vite çš„ http æœåŠ¡ï¼Œå¹¶ä¸”æ§åˆ¶çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡å¯åŠ¨ã€‚</p>
<p>http æœåŠ¡å¯åŠ¨ä¹‹å‰ï¼Œä½¿ç”¨ esbuild æ¨¡å—å®Œæˆäº†ä¸»è¿›ç¨‹ TypeScript ä»£ç çš„ç¼–è¯‘å·¥ä½œï¼Œè¿™ä¸ªæ¨¡å—æ˜¯ Vite è‡ªå¸¦çš„ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>ä¸»è¿›ç¨‹çš„å…¥å£æ–‡ä»¶æ˜¯é€šè¿‡ entryPoints é…ç½®å±æ€§è®¾ç½®çš„ï¼Œç¼–è¯‘å®Œæˆåçš„è¾“å‡ºæ–‡ä»¶æ˜¯é€šè¿‡ outfile å±æ€§é…ç½®çš„ã€‚</p>
<p>ç¼–è¯‘å¹³å° platform è®¾ç½®ä¸º nodeï¼Œæ’é™¤çš„æ¨¡å— external è®¾ç½®ä¸º electronï¼Œè¿™ä¸¤ä¸ªè®¾ç½®ä½¿åœ¨ä¸»è¿›ç¨‹ä»£ç ä¸­å¯ä»¥é€šè¿‡ import çš„æ–¹å¼å¯¼å…¥ electron å†…ç½®çš„æ¨¡å—ï¼Œéä½†å¦‚æ­¤ï¼ŒNode çš„å†…ç½®æ¨¡å—ä¹Ÿå¯ä»¥é€šè¿‡ import çš„æ–¹å¼å¼•å…¥ã€‚</p>
<p>åœ¨ vite.config.ts æ–‡ä»¶ä¸­å¼•å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vite&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">vue</span> <span class="kr">from</span> <span class="s1">&#39;@vitejs/plugin-vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">devPlugin</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./plugins/devPlugin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// https://vitejs.dev/config/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">devPlugin</span><span class="p">(),</span> <span class="nx">vue</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ tsconfig.node.json ä¸­é…ç½® plugins è·¯å¾„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;compilerOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;composite&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;module&#34;</span><span class="p">:</span> <span class="s2">&#34;ESNext&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;moduleResolution&#34;</span><span class="p">:</span> <span class="s2">&#34;Node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;allowSyntheticDefaultImports&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;include&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;vite.config.ts&#34;</span><span class="p">,</span> <span class="s2">&#34;./plugins/*.*&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œå‘½ä»¤ npm run dev:</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_1.png" alt="" width="700" />  
<h3 id="æ¸²æŸ“è¿›ç¨‹é›†æˆå†…ç½®æ¨¡å—">æ¸²æŸ“è¿›ç¨‹é›†æˆå†…ç½®æ¨¡å—</h3>
<p>ç°åœ¨ä¸»è¿›ç¨‹å†…å¯ä»¥è‡ªç”±çš„ä½¿ç”¨ Electron å’Œ Node.js çš„å†…ç½®æ¨¡å—äº†ï¼Œä½†æ¸²æŸ“è¿›ç¨‹è¿˜ä¸è¡Œã€‚</p>
<p>ä¿®æ”¹ä¸»è¿›ç¨‹ä»£ç ï¼Œæ‰“å¼€æ¸²æŸ“è¿›ç¨‹çš„ä¸€äº›å¼€å…³ï¼Œå…è®¸æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨ Node.js çš„å†…ç½®æ¨¡å—:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">BrowserWindow</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ELECTRON_DISABLE_SECURITY_WARNINGS</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainWindow</span>: <span class="kt">BrowserWindow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">whenReady</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">nodeIntegration</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webSecurity</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">allowRunningInsecureContent</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">contextIsolation</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webviewTag</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">spellcheck</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">disableHtmlFullscreenWindowResize</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">openDevTools</span><span class="p">({</span> <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;undocked&#39;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ELECTRON_DISABLE_SECURITY_WARNINGS ç”¨äºè®¾ç½®æ¸²æŸ“è¿›ç¨‹å¼€å‘è€…è°ƒè¯•å·¥å…·çš„è­¦å‘Šï¼Œè¿™é‡Œè®¾ç½®ä¸º true å°±ä¸ä¼šå†æ˜¾ç¤ºä»»ä½•è­¦å‘Šäº†ã€‚</p>
<p>nodeIntegrationé…ç½®é¡¹çš„ä½œç”¨æ˜¯æŠŠ Node.js ç¯å¢ƒé›†æˆåˆ°æ¸²æŸ“è¿›ç¨‹ä¸­ã€‚</p>
<p>contextIsolationé…ç½®é¡¹çš„ä½œç”¨æ˜¯åœ¨åŒä¸€ä¸ª JavaScript ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ Electron APIã€‚</p>
<p>webContentsçš„openDevToolsæ–¹æ³•ç”¨äºæ‰“å¼€å¼€å‘è€…è°ƒè¯•å·¥å…·ã€‚</p>
<p>ç°åœ¨å¯ä»¥åœ¨å¼€å‘è€…è°ƒè¯•å·¥å…·ä¸­è®¿é—® Node.js å’Œ Electron çš„å†…ç½®æ¨¡å—äº†ã€‚</p>
<h3 id="è®¾ç½®æ¨¡å—åˆ«åä¸è§£æé’©å­">è®¾ç½®æ¨¡å—åˆ«åä¸è§£æé’©å­</h3>
<p>è™½ç„¶å¯ä»¥åœ¨å¼€å‘è€…è°ƒè¯•å·¥å…·ä¸­ä½¿ç”¨ Node.js å’Œ Electron çš„å†…ç½®æ¨¡å—ï¼Œä½†ç°åœ¨è¿˜ä¸èƒ½åœ¨ Vue çš„é¡µé¢å†…ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚</p>
<p>å› ä¸º Vite ä¸»åŠ¨å±è”½äº†è¿™äº›å†…ç½®çš„æ¨¡å—ï¼Œå¦‚æœå¼€å‘è€…å¼ºè¡Œå¼•å…¥å®ƒä»¬ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡ä¼šå¾—åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Module &#34;xxxx&#34; has been externalized for browser compatibility and cannot be accessed in client code.
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£… vite-plugin-optimizerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm i vite-plugin-optimizer -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ vite.config.ts çš„ä»£ç ï¼Œè®© Vite åŠ è½½è¿™ä¸ªæ’ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vite&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">vue</span> <span class="kr">from</span> <span class="s1">&#39;@vitejs/plugin-vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">devPlugin</span><span class="p">,</span> <span class="nx">getReplacer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./plugins/devPlugin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">optimizer</span> <span class="kr">from</span> <span class="s1">&#39;vite-plugin-optimizer&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// https://vitejs.dev/config/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">optimizer</span><span class="p">(</span><span class="nx">getReplacer</span><span class="p">()),</span> <span class="nx">devPlugin</span><span class="p">(),</span> <span class="nx">vue</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>vite-plugin-optimizer æ’ä»¶ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼šnode_modules.vite-plugin-optimizerã€‚</p>
<p>ç„¶åæŠŠç±»ä¼¼ const fs = require(&lsquo;fs&rsquo;); export { fs as default } è¿™æ ·çš„ä»£ç å†™å…¥è¿™ä¸ªç›®å½•ä¸‹çš„ fs.js æ–‡ä»¶ä¸­ã€‚</p>
<p>æ¸²æŸ“è¿›ç¨‹æ‰§è¡Œåˆ°ï¼šimport fs from &ldquo;fs&rdquo; æ—¶ï¼Œå°±ä¼šè¯·æ±‚è¿™ä¸ªç›®å½•ä¸‹çš„ fs.js æ–‡ä»¶ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å¼•å…¥ Node å†…ç½®æ¨¡å—çš„ç›®çš„ã€‚</p>
<p>getReplacer æ–¹æ³•æ˜¯ä¸º vite-plugin-optimizer æ’ä»¶æä¾›çš„å†…ç½®æ¨¡å—åˆ—è¡¨:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">let</span> <span class="nx">getReplacer</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">externalModels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="s1">&#39;child_process&#39;</span><span class="p">,</span> <span class="s1">&#39;crypto&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;better-sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;knex&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">externalModels</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">result</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">find</span>: <span class="kt">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="sb">`^</span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb">$`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">code</span><span class="o">:</span> <span class="sb">`const </span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb"> = require(&#39;</span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb">&#39;); export { </span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb"> as default }`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">result</span><span class="p">[</span><span class="s1">&#39;electron&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">electronModules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clipboard&#39;</span><span class="p">,</span> <span class="s1">&#39;ipcRenderer&#39;</span><span class="p">,</span> <span class="s1">&#39;nativeImage&#39;</span><span class="p">,</span> <span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="s1">&#39;webFrame&#39;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">find</span>: <span class="kt">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="sb">`^electron$`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">code</span><span class="o">:</span> <span class="sb">`const {</span><span class="si">${</span><span class="nx">electronModules</span><span class="si">}</span><span class="sb">} = require(&#39;electron&#39;); export { </span><span class="si">${</span><span class="nx">electronModules</span><span class="si">}</span><span class="sb"> }`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æŠŠä¸€äº›å¸¸ç”¨çš„ Node æ¨¡å—å’Œ electron çš„å†…ç½®æ¨¡å—æä¾›ç»™äº† vite-plugin-optimizer æ’ä»¶ï¼Œä»¥åæƒ³è¦å¢åŠ æ–°çš„å†…ç½®æ¨¡å—åªè¦ä¿®æ”¹è¿™ä¸ªæ–¹æ³•å³å¯ã€‚</p>
<p>vite-plugin-optimizer æ’ä»¶ä¸ä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œç¼–è¯‘ Vue é¡¹ç›®æ—¶ï¼Œå®ƒä¹Ÿä¼šå‚ä¸å·¥ä½œã€‚</p>
<p>é€šè¿‡å¦‚ä¸‹ä»£ç åœ¨ Vue ç»„ä»¶ä¸­åšæµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c1">// src\App.vue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s2">&#34;fs&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ipcRenderer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;electron&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">onMounted</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vue&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">onMounted</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ipcRenderer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼€å‘è€…è°ƒè¯•å·¥å…·å°†ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_2.png" alt="" width="700" />  
<h2 id="æ„å»ºç”Ÿäº§ç¯å¢ƒ">æ„å»ºç”Ÿäº§ç¯å¢ƒ</h2>
<p>åˆ¶ä½œä¸€ä¸ª Vite æ’ä»¶ã€‚é€šè¿‡è¿™ä¸ªæ–°çš„æ’ä»¶ç”Ÿæˆå®‰è£…åŒ…ï¼Œæœ‰äº†å®‰è£…åŒ…å°±å¯ä»¥æŠŠåº”ç”¨åˆ†å‘ç»™ç”¨æˆ·äº†ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_3.png" alt="" width="700" />  
<h3 id="ç¼–è¯‘ç»“æŸé’©å­å‡½æ•°">ç¼–è¯‘ç»“æŸé’©å­å‡½æ•°</h3>
<p>vite.config.ts å¢åŠ ä¸€ä¸ªæ–°çš„é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vite&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">vue</span> <span class="kr">from</span> <span class="s1">&#39;@vitejs/plugin-vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">devPlugin</span><span class="p">,</span> <span class="nx">getReplacer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./plugins/devPlugin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">buildPlugin</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./plugins/buildPlugin&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">optimizer</span> <span class="kr">from</span> <span class="s1">&#39;vite-plugin-optimizer&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// https://vitejs.dev/config/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">build</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rollupOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">buildPlugin</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">optimizer</span><span class="p">(</span><span class="nx">getReplacer</span><span class="p">()),</span> <span class="nx">devPlugin</span><span class="p">(),</span> <span class="nx">vue</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ¶ä½œåº”ç”¨å®‰è£…åŒ…">åˆ¶ä½œåº”ç”¨å®‰è£…åŒ…</h3>
<p>vite ç¼–è¯‘å®Œæˆä¹‹åï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ npm run build æŒ‡ä»¤ï¼Œå°†åœ¨é¡¹ç›®distç›®å½•å†…ä¼šç”Ÿæˆä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œæ­¤æ—¶ closeBundle é’©å­è¢«è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªé’©å­ä¸­æŠŠä¸Šè¿°ç”Ÿæˆçš„æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªåº”ç”¨ç¨‹åºå®‰è£…åŒ…ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_4.png" alt="" width="300" />  
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">fs</span> <span class="kr">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">BuildObj</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç¼–è¯‘ä¸»è¿›ç¨‹ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">buildMain() {</span>
</span></span><span class="line"><span class="cl">    <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;esbuild&#39;</span><span class="p">).</span><span class="nx">buildSync</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">entryPoints</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./src/main/mainEntry.ts&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bundle</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">platform</span><span class="o">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">minify</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">outfile</span><span class="o">:</span> <span class="s1">&#39;./dist/mainEntry.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">external</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;electron&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ä¸ºç”Ÿäº§ç¯å¢ƒå‡†å¤‡package.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">preparePackageJson() {</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">pkgJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;package.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">localPkgJson</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">pkgJsonPath</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">electronConfig</span> <span class="o">=</span> <span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">devDependencies</span><span class="p">.</span><span class="nx">electron</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="s1">&#39;mainEntry.js&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">localPkgJson</span><span class="p">[</span><span class="s1">&#39;scripts&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">localPkgJson</span><span class="p">[</span><span class="s1">&#39;devDependencies&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">devDependencies</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">electron</span>: <span class="kt">electronConfig</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">tarJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;package.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">tarJsonPath</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">localPkgJson</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist/node_modules&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ä½¿ç”¨electron-builderåˆ¶æˆå®‰è£…åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">buildInstaller() {</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">directories</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">output</span>: <span class="kt">path.join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;release&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">app</span>: <span class="kt">path.join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">files</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;**&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="kr">extends</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">productName</span><span class="o">:</span> <span class="s1">&#39;Electron&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">appId</span><span class="o">:</span> <span class="s1">&#39;com.xxx.desktop&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">asar</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">nsis</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">oneClick</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">perMachine</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">allowToChangeInstallationDirectory</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createDesktopShortcut</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createStartMenuShortcut</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">shortcutName</span><span class="o">:</span> <span class="s1">&#39;ElectronDesktop&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">publish</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">provider</span><span class="o">:</span> <span class="s1">&#39;generic&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:5500/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">project</span>: <span class="kt">process.cwd</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;electron-builder&#39;</span><span class="p">).</span><span class="nx">build</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">let</span> <span class="nx">buildPlugin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;build-plugin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">closeBundle</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">buildObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BuildObj</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">buildObj</span><span class="o">?</span><span class="p">.</span><span class="nx">buildMain</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">buildObj</span><span class="o">?</span><span class="p">.</span><span class="nx">preparePackageJson</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">buildObj</span><span class="o">?</span><span class="p">.</span><span class="nx">buildInstaller</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå¯¹è±¡é€šè¿‡ä¸‰ä¸ªæ–¹æ³•æä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>buildMainã€‚ç”±äº ite åœ¨ç¼–è¯‘ä¹‹å‰ä¼šæ¸…ç©º dist ç›®å½•ï¼Œæ‰€ä»¥åœ¨ä¹‹å‰ç”Ÿæˆçš„ mainEntry.js æ–‡ä»¶ä¹Ÿè¢«åˆ é™¤äº†ï¼Œæ­¤å¤„é€šè¿‡ buildMain æ–¹æ³•å†æ¬¡ç¼–è¯‘ä¸»è¿›ç¨‹ä»£ç ã€‚ä¸è¿‡ç”±äºæ­¤å¤„æ˜¯åœ¨ä¸ºç”Ÿäº§ç¯å¢ƒç¼–è¯‘ä»£ç ï¼Œæ‰€ä»¥å¢åŠ äº†minify: true é…ç½®ï¼Œç”Ÿæˆå‹ç¼©åçš„ä»£ç ã€‚</li>
<li>preparePackageJsonã€‚ç”¨æˆ·å®‰è£…äº§å“åï¼Œåœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ Electron å¯åŠ¨ä¸€ä¸ª Node.js çš„é¡¹ç›®ï¼Œæ‰€ä»¥è¦ä¸ºè¿™ä¸ªé¡¹ç›®å‡†å¤‡ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä»¥å½“å‰é¡¹ç›®çš„ package.json æ–‡ä»¶ä¸ºè“æœ¬åˆ¶ä½œè€Œæˆçš„ã€‚é‡Œé¢æ³¨æ˜äº†ä¸»è¿›ç¨‹çš„å…¥å£æ–‡ä»¶ï¼Œç§»é™¤äº†ä¸€äº›å¯¹æœ€ç»ˆç”¨æˆ·æ²¡ç”¨çš„é…ç½®èŠ‚ã€‚</li>
<li>buildInstallerã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£è°ƒç”¨ electron-builderï¼ˆnpm install electron-builder -D å®‰è£… electron-builder åº“ï¼‰ æä¾›çš„ API ä»¥ç”Ÿæˆå®‰è£…åŒ…ã€‚æœ€ç»ˆç”Ÿæˆçš„å®‰è£…åŒ…è¢«æ”¾ç½®åœ¨ release ç›®å½•ä¸‹ï¼Œè¿™æ˜¯é€šè¿‡ config.directories.output æŒ‡å®šçš„ã€‚é™æ€æ–‡ä»¶æ‰€åœ¨ç›®å½•æ˜¯é€šè¿‡ config.directories.app é…ç½®é¡¹æŒ‡å®šã€‚å…¶ä»–é…ç½®é¡¹ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…å®˜ç½‘æ–‡æ¡£ã€‚</li>
</ul>
<p>ç”Ÿæˆ package.json æ–‡ä»¶ä¹‹åï¼Œè¿˜åˆ›å»ºäº†ä¸€ä¸ª node_modules ç›®å½•ã€‚æ­¤ä¸¾æ˜¯ä¸ºäº†é˜»æ­¢ electron-builder çš„ä¸€äº›é»˜è®¤è¡Œä¸ºï¼ˆç›®å‰æ¥è¯´å®ƒä¼šé˜»æ­¢ electron-builder åˆ›å»ºä¸€äº›æ²¡ç”¨çš„ç›®å½•æˆ–æ–‡ä»¶ï¼‰ã€‚</p>
<p>è¿™æ®µè„šæœ¬è¿˜æ˜ç¡®æŒ‡å®šäº† Electron çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœ Electron çš„ç‰ˆæœ¬å·å‰é¢æœ‰&quot;^&ldquo;ç¬¦å·çš„è¯ï¼Œéœ€æŠŠå®ƒåˆ æ‰ã€‚è¿™æ˜¯ electron-builder çš„ä¸€ä¸ª Bugï¼Œè¿™ä¸ª bug å¯¼è‡´ electron-builder æ— æ³•è¯†åˆ«å¸¦ ^ æˆ– ~ ç¬¦å·çš„ç‰ˆæœ¬å·ã€‚</p>
<p>åšå¥½è¿™äº›é…ç½®ä¹‹åï¼Œæ‰§è¡Œ npm run build å°±å¯ä»¥åˆ¶ä½œå®‰è£…åŒ…äº†ï¼Œæœ€ç»ˆç”Ÿæˆçš„å®‰è£…æ–‡ä»¶ä¼šè¢«æ”¾ç½®åˆ° release ç›®å½•ä¸‹ã€‚</p>
<h3 id="ä¸»è¿›ç¨‹ç”Ÿäº§ç¯å¢ƒåŠ è½½æœ¬åœ°æ–‡ä»¶">ä¸»è¿›ç¨‹ç”Ÿäº§ç¯å¢ƒåŠ è½½æœ¬åœ°æ–‡ä»¶</h3>
<p>è™½ç„¶æˆåŠŸåˆ¶ä½œäº†å®‰è£…åŒ…ï¼Œè€Œä¸”è¿™ä¸ªå®‰è£…åŒ…å¯ä»¥æ­£ç¡®å®‰è£…åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œè¿™æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºçš„ä¸»è¿›ç¨‹è¿˜åœ¨é€šè¿‡ process.argv[2] åŠ è½½é¦–é¡µã€‚æ˜¾ç„¶ç”¨æˆ·é€šè¿‡å®‰è£…åŒ…å®‰è£…çš„åº”ç”¨ç¨‹åºæ²¡æœ‰è¿™ä¸ªå‚æ•°ã€‚</p>
<p>æ¥ä¸‹æ¥å°±è¦è®©åº”ç”¨ç¨‹åºåœ¨æ²¡æœ‰è¿™ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½åŠ è½½é™æ€é¡µé¢ã€‚</p>
<p>æ–°å»º src\main\CustomScheme.tsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">protocol</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">fs</span> <span class="kr">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸ºè‡ªå®šä¹‰appåè®®æä¾›ç‰¹æƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">schemeConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">standard</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">supportFetchAPI</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">bypassCSP</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">corsEnabled</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">stream</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">protocol</span><span class="p">.</span><span class="nx">registerSchemesAsPrivileged</span><span class="p">([{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">scheme</span><span class="o">:</span> <span class="s1">&#39;app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">privileges</span>: <span class="kt">schemeConfig</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">CustomScheme</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ ¹æ®æ–‡ä»¶æ‰©å±•åè·å–mime-type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">private</span> <span class="kr">static</span> <span class="nx">getMimeType</span><span class="p">(</span><span class="nx">extension</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">&#39;.js&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">&#39;.html&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">&#39;.css&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;text/css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">&#39;.svg&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;image/svg+xml&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s1">&#39;.json&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mineType</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">mineType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ³¨å†Œè‡ªå®šä¹‰appåè®®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">static</span> <span class="nx">registerScheme() {</span>
</span></span><span class="line"><span class="cl">    <span class="nx">protocol</span><span class="p">.</span><span class="nx">registerStreamProtocol</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">pathName</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">extension</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">pathName</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">extension</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">pathName</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">extension</span> <span class="o">=</span> <span class="s1">&#39;.html&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">tarFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">pathName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">callback</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">statusCode</span>: <span class="kt">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">extension</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">data</span>: <span class="kt">fs.createReadStream</span><span class="p">(</span><span class="nx">tarFile</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸»è¿›ç¨‹ app ready å‰ï¼Œé€šè¿‡ protocol å¯¹è±¡çš„ registerSchemesAsPrivileged æ–¹æ³•ä¸ºåä¸º app çš„ scheme æ³¨å†Œäº†ç‰¹æƒï¼ˆå¯ä»¥ä½¿ç”¨ FetchAPIã€ç»•è¿‡å†…å®¹å®‰å…¨ç­–ç•¥ç­‰ï¼‰ã€‚</p>
<p>åœ¨ app ready ä¹‹åï¼Œé€šè¿‡ protocol å¯¹è±¡çš„ registerStreamProtocol æ–¹æ³•ä¸ºåä¸º app çš„ scheme æ³¨å†Œäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“åŠ è½½ç±»ä¼¼ app://index.html è¿™æ ·çš„è·¯å¾„æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†è¢«æ‰§è¡Œã€‚</p>
<p>è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªä¼ å…¥å‚æ•° request å’Œ callbackï¼Œé€šè¿‡ request.url è·å–åˆ°è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œé€šè¿‡ callback åšå‡ºå“åº”ã€‚</p>
<p>ç»™å‡ºå“åº”æ—¶ï¼Œè¦æŒ‡å®šå“åº”çš„ statusCode å’Œ content-typeï¼Œè¿™ä¸ª content-type æ˜¯é€šè¿‡æ–‡ä»¶çš„æ‰©å±•åå¾—åˆ°çš„ã€‚è¿™é‡Œé€šè¿‡ getMimeType æ–¹æ³•ç¡®å®šäº†æ–‡ä»¶çš„ content-typeã€‚</p>
<p>å“åº”çš„ data å±æ€§ä¸ºç›®æ ‡æ–‡ä»¶çš„å¯è¯»æ•°æ®æµï¼Œå½“ä½ çš„é™æ€æ–‡ä»¶æ¯”è¾ƒå¤§æ—¶ï¼Œä¸å¿…è¯»å‡ºæ•´ä¸ªæ–‡ä»¶å†ç»™å‡ºå“åº”ã€‚</p>
<p>æ¥ä¸‹æ¥åœ¨ src\main\mainEntry.ts ä¸­ä½¿ç”¨è¿™æ®µä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">CustomScheme</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./customScheme&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">CustomScheme</span><span class="p">.</span><span class="nx">registerScheme</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="s1">&#39;app&#34;//index.html&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å½“å­˜åœ¨æŒ‡å®šçš„å‘½ä»¤è¡Œå‚æ•°æ—¶ï¼Œå°±è®¤ä¸ºæ˜¯å¼€å‘ç¯å¢ƒï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°åŠ è½½é¡µé¢ï¼Œå½“ä¸å­˜åœ¨å‘½ä»¤è¡Œå‚æ•°æ—¶ï¼Œå°±è®¤ä¸ºæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œé€šè¿‡ app:// scheme åŠ è½½é¡µé¢ã€‚</p>
<h2 id="è®¾è®¡å·¥ç¨‹é¡¹ç›®ç»“æ„">è®¾è®¡å·¥ç¨‹é¡¹ç›®ç»“æ„</h2>
<p>åœ¨ç»§ç»­å¼•å…¥æ–°çš„æ¨¡å—æˆ–ç»„ä»¶ä¹‹å‰ï¼Œå…ˆè°ƒæ•´ä¸€ä¸‹å·¥ç¨‹çš„ç»“æ„ï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_5.png" alt="" width="300" />  
<ul>
<li>dist ç›®å½•æ˜¯æ‰“åŒ…è¿‡ç¨‹çš„ä¸´æ—¶äº§ç‰©æ”¾ç½®ç›®å½•ã€‚</li>
<li>plugins ç›®å½•æ”¾ç½®å¼€å‘ç¯å¢ƒ vite æ’ä»¶å’Œæ‰“åŒ… vite æ’ä»¶ã€‚</li>
<li>release ç›®å½•æ”¾ç½®æœ€ç»ˆç”Ÿæˆçš„å®‰è£…åŒ…ã€‚</li>
<li>resource ç›®å½•æ”¾ç½®ä¸€äº›å¤–éƒ¨èµ„æºï¼Œæ¯”å¦‚åº”ç”¨ç¨‹åºå›¾æ ‡ã€ç¬¬ä¸‰æ–¹ç±»åº“ç­‰ã€‚</li>
<li>src/common ç›®å½•æ”¾ç½®ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½ä¼šç”¨åˆ°çš„å…¬å…±ä»£ç ï¼Œæ¯”å¦‚æ—¥æœŸæ ¼å¼åŒ–çš„å·¥å…·ç±»ã€æ•°æ®åº“è®¿é—®å·¥å…·ç±»ç­‰ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„ä»£ç éƒ½æœ‰å¯èƒ½ä½¿ç”¨è¿™äº›ç±»ã€‚</li>
<li>src/main ç›®å½•æ”¾ç½®ä¸»è¿›ç¨‹çš„ä»£ç ã€‚</li>
<li>src/model ç›®å½•æ”¾ç½®åº”ç”¨ç¨‹åºçš„æ¨¡å‹æ–‡ä»¶ï¼Œæ¯”å¦‚æ¶ˆæ¯ç±»ã€ä¼šè¯ç±»ã€ç”¨æˆ·è®¾ç½®ç±»ç­‰ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„ä»£ç éƒ½æœ‰å¯èƒ½ä½¿ç”¨è¿™äº›ç±»ã€‚</li>
<li>src/renderer ç›®å½•æ”¾ç½®æ¸²æŸ“è¿›ç¨‹çš„ä»£ç ã€‚</li>
<li>src/renderer/assets æ”¾ç½®å­—ä½“å›¾æ ‡ã€å…¬å…±æ ·å¼ã€å›¾ç‰‡ç­‰æ–‡ä»¶ã€‚</li>
<li>src/renderer/components æ”¾ç½®å…¬å…±ç»„ä»¶ï¼Œæ¯”å¦‚æ ‡é¢˜æ ç»„ä»¶ã€èœå•ç»„ä»¶ç­‰ã€‚</li>
<li>src/renderer/store ç›®å½•å­˜æ”¾ Vue é¡¹ç›®çš„æ•°æ®çŠ¶æ€ç»„ä»¶ï¼Œç”¨äºåœ¨ä¸åŒçš„ Vue ç»„ä»¶ä¸­å…±äº«æ•°æ®ã€‚</li>
<li>src/renderer/router ç›®å½•å­˜æ”¾ Vue é¡¹ç›®çš„è·¯ç”±é…ç½®ä¿¡æ¯ã€‚</li>
<li>src/renderer/indow ç›®å½•å­˜æ”¾ä¸åŒçª—å£çš„å…¥å£ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶æ˜¯é€šè¿‡ vue-router å¯¼èˆªçš„ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„å­ç›®å½•å­˜æ”¾å¯¹åº”çª—å£çš„å­ç»„ä»¶ã€‚</li>
<li>src/renderer/App.vue æ˜¯æ¸²æŸ“è¿›ç¨‹çš„å…¥å£ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å†…åªæœ‰ä¸€ä¸ªç”¨äºå¯¼èˆªåˆ°ä¸åŒçš„çª—å£ã€‚</li>
<li>src/renderer/main.ts æ˜¯æ¸²æŸ“è¿›ç¨‹çš„å…¥å£è„šæœ¬ã€‚</li>
<li>index.html æ˜¯æ¸²æŸ“è¿›ç¨‹çš„å…¥å£é¡µé¢ã€‚</li>
<li>vite.config.ts æ˜¯ vite çš„é…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<p>è°ƒæ•´å¥½å·¥ç¨‹ç»“æ„åï¼Œè¦ä¿®æ”¹ä¸€ä¸‹ index.html çš„ä»£ç æ‰èƒ½è®©è¿™äº›è°ƒæ•´ç”Ÿæ•ˆã€‚å®é™…ä¸Šå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ¸²æŸ“è¿›ç¨‹å…¥å£è„šæœ¬çš„å¼•å…¥è·¯å¾„:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;module&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/src/renderer/main.ts&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼•å…¥-vue-router">å¼•å…¥ vue-router</h2>
<p>å®‰è£… vue-router æ¨¡å—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install vue-router@4 -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…å®Œæˆåï¼Œä¸º src/renderer/router/index.ts æ·»åŠ å¦‚ä¸‹ä»£ç é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">VueRouter</span> <span class="kr">from</span> <span class="s1">&#39;vue-router&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·¯ç”±è§„åˆ™æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">routes</span> <span class="o">=</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">redirect</span><span class="o">:</span> <span class="s1">&#39;/WindowMain/Chat&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/WindowMain&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowMain.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">children</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;Chat&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowMain/Chat.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowMain/Contact.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;Collection&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowMain/Collection.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">},]</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/WindowSetting&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowSetting.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">children</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;AccountSetting&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowSetting/AccountSetting.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/WindowUserInfo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">component</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../window/WindowUserInfo.vue&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">let</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">VueRouter</span><span class="p">.</span><span class="nx">createRouter</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">history</span>: <span class="kt">VueRouter.createWebHistory</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">routes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç å¯¼å‡ºäº†ä¸€ä¸ª router å¯¹è±¡ï¼Œè¿™ä¸ª router å¯¹è±¡æ˜¯åŸºäº WebHistory æ¨¡å¼åˆ›å»ºè·¯ç”±çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é¡µé¢è·¯å¾„çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼šhttp://127.0.0.1:5173/WindowMain/PageChatï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œapp://index.html/WindowMain/PageChatï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ã€‚</p>
<p>ä¸Šè¿°ä»£ç ä¸­ routes æ•°ç»„é‡Œçš„å†…å®¹å°±æ˜¯å¯¼èˆªçš„å…·ä½“é…ç½®ï¼Œåœ¨è¿™äº›é…ç½®ä¸­ä½¿ç”¨ import æ–¹æ³•åŠ¨æ€å¼•å…¥ Vue ç»„ä»¶ï¼Œvite åœ¨å¤„ç†è¿™ç§åŠ¨æ€å¼•å…¥çš„ç»„ä»¶æ—¶ï¼Œä¼šæŠŠå¯¹åº”çš„ç»„ä»¶ç¼–è¯‘åˆ°ç‹¬ç«‹çš„æºç æ–‡ä»¶ä¸­ï¼Œç±»ä¼¼ WindowUserInfo.689249b8.js å’Œ WindowSetting.6354f6d6.jsï¼Œè¿™ç§ç¼–è¯‘ç­–ç•¥å¯ä»¥å¸®åŠ©æ§åˆ¶æœ€ç»ˆç¼–è¯‘äº§ç‰©çš„å¤§å°ï¼Œé¿å…åº”ç”¨å¯åŠ¨æ—¶å°±åŠ è½½ä¸€ä¸ªåºå¤§çš„ JavaScript æ–‡ä»¶ã€‚</p>
<p>åœ¨åº”ç”¨å¯åŠ¨æ—¶è¯·æ±‚çš„è·¯å¾„æ˜¯ï¼š&rdquo;/&quot;ï¼Œè¿™ä¸ªè·¯å¾„è¢«é‡å®šå‘åˆ°&quot;/WindowMain/Chat&quot;ï¼Œä¹Ÿå°±æ˜¯è¯´ WindowMain ç»„ä»¶å’Œ Chat ç»„ä»¶æ˜¯é¦–é¡µç»„ä»¶ï¼ˆè¿™æ˜¯åœ¨ç¬¬ä¸€ä¸ªå¯¼èˆªé…ç½®å¯¹è±¡ä¸­è®¾ç½®çš„ï¼‰ã€‚</p>
<p>ä¸Šè¿°ä»£ç å®Œæˆåï¼Œéœ€è¦åœ¨ main.ts ä¸­ä½¿ç”¨å®ƒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./style.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./router&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">App</span> <span class="kr">from</span> <span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createApp</span><span class="p">(</span><span class="nx">App</span><span class="p">).</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">).</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥æŠŠ App.vue çš„ä»£ç ä¿®æ”¹æˆå¦‚ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">router-view</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨å¯åŠ¨æ—¶ï¼Œç¬¬ä¸€ä¸ªçª—å£ï¼ˆä¸»çª—å£ï¼‰å°±ä¼šåŠ è½½ src\renderer\window\WindowMain.vue ç»„ä»¶çš„ä»£ç ã€‚</p>
<p>å½“åœ¨ä¸»çª—å£å†…æ‰“å¼€åˆ«çš„å­çª—å£æ—¶ï¼ˆå¼¹å‡ºä¸€ä¸ªå­çª—å£ï¼‰ï¼Œåªè¦åŠ è½½ç±»ä¼¼è¿™æ ·çš„è·¯å¾„/WindowUserInfoï¼Œå°±å¯ä»¥è®©å­çª—å£åŠ è½½ src\renderer\Window\WindowUserInfo.vue è¿™ä¸ªç»„ä»¶ã€‚</p>
<h2 id="èœå•ç»„ä»¶åŠè·³è½¬">èœå•ç»„ä»¶åŠè·³è½¬</h2>
<p>åœ¨ src\renderer\components ç›®å½•ä¸‹æ–°å»º BarLeft.vue çš„ç»„ä»¶ï¼Œè¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„ä¾§è¾¹æ ç»„ä»¶ï¼Œé‡Œé¢æ”¾ç½®åº”ç”¨ç¨‹åºçš„èœå•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;BarLeft&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;userIcon&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;../assets/avatar.jpg&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;menu&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">router-link</span> <span class="nt">v-for</span><span class="s">=&#34;item in mainWindowRoutes&#34; :to=&#34;item.path&#34; :class=&#34;[&#39;menuItem&#39;, {&#39;selected&#39;: item.isSelected}]&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;i :class=&#34;[&#39;icon&#39;, item.isSelected ? item.iconSelected : item.icon]&#34;&gt;&lt;/i&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/router-link&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;div class=&#34;setting&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;div class=&#34;menuItem&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;i class=&#34;icon icon-setting&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">  &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/template&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;script setup lang=&#34;ts&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">import { ref, watch } from &#39;vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { useRoute } from &#39;vue-router&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">let mainWindowRoutes = ref([
</span></span></span><span class="line"><span class="cl"><span class="s">  { path: &#39;/WindowMain/Chat&#39;, isSelected: true, icon: &#39;icon-chat&#39;, iconSelected: &#39;icon-chat&#39; },
</span></span></span><span class="line"><span class="cl"><span class="s">  { path: &#39;/WindowMain/Contact&#39;, isSelected: false, icon: &#39;icon-tongxunlu1&#39;, iconSelected: &#39;icon-tongxunlu&#39; },
</span></span></span><span class="line"><span class="cl"><span class="s">  { path: &#39;/WindowMain/Collection&#39;, isSelected: false, icon: &#39;icon-shoucang1&#39;, iconSelected: &#39;icon-shoucang&#39; },
</span></span></span><span class="line"><span class="cl"><span class="s">])
</span></span></span><span class="line"><span class="cl"><span class="s">let route = useRoute();
</span></span></span><span class="line"><span class="cl"><span class="s">watch(
</span></span></span><span class="line"><span class="cl"><span class="s">    () =&gt; route,
</span></span></span><span class="line"><span class="cl"><span class="s">    () =&gt; mainWindowRoutes.value.forEach(v =&gt; v.isSelected = v.path === route.fullPath),
</span></span></span><span class="line"><span class="cl"><span class="s">    {
</span></span></span><span class="line"><span class="cl"><span class="s">      immediate: true,
</span></span></span><span class="line"><span class="cl"><span class="s">      deep: true,
</span></span></span><span class="line"><span class="cl"><span class="s">    })
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;style scoped lang=&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">.BarLeft</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">width</span><span class="o">:</span> <span class="na">54px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="na">100</span><span class="err">%;</span>
</span></span><span class="line"><span class="cl">  <span class="na">display</span><span class="o">:</span> <span class="na">flex</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="nt">-direction</span><span class="o">:</span> <span class="na">column</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">background</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">46</span><span class="err">,</span> <span class="na">46</span><span class="err">,</span> <span class="na">46</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="nt">-webkit-app-region</span><span class="o">:</span> <span class="na">drag</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.userIcon</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="na">84px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">padding</span><span class="nt">-top</span><span class="o">:</span> <span class="na">36px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">box</span><span class="nt">-sizing</span><span class="o">:</span> <span class="na">border</span><span class="nt">-box</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">width</span><span class="o">:</span> <span class="na">34px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    <span class="na">height</span><span class="o">:</span> <span class="na">34px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    <span class="na">margin</span><span class="nt">-left</span><span class="o">:</span> <span class="na">10px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.menu</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="o">:</span> <span class="na">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.menuItem</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="na">44px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">line</span><span class="nt">-height</span><span class="o">:</span> <span class="na">44px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">text</span><span class="nt">-align</span><span class="o">:</span> <span class="na">center</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">padding</span><span class="nt">-left</span><span class="o">:</span> <span class="na">12px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">padding</span><span class="nt">-right</span><span class="o">:</span> <span class="na">12px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">display</span><span class="o">:</span> <span class="na">block</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">text</span><span class="nt">-decoration</span><span class="o">:</span> <span class="na">none</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">color</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">126</span><span class="err">,</span> <span class="na">126</span><span class="err">,</span> <span class="na">126</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="na">cursor</span><span class="o">:</span> <span class="na">pointer</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">-webkit-app-region</span><span class="o">:</span> <span class="na">no</span><span class="nt">-drag</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">font</span><span class="nt">-size</span><span class="o">:</span> <span class="na">22px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">&amp;</span><span class="o">:</span><span class="na">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">color</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">141</span><span class="err">,</span> <span class="na">141</span><span class="err">,</span> <span class="na">141</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.selected</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">color</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">7</span><span class="err">,</span> <span class="na">193</span><span class="err">,</span> <span class="na">96</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="err">&amp;</span><span class="o">:</span><span class="na">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="na">color</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">7</span><span class="err">,</span> <span class="na">193</span><span class="err">,</span> <span class="na">96</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.setting</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">margin</span><span class="nt">-bottom</span><span class="o">:</span> <span class="na">5px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ ·å¼ä¸º menu çš„ div ç”¨äºå­˜æ”¾ä¸»çª—å£çš„èœå•ï¼Œé€šè¿‡ mainWindowRoutes æ•°ç»„é‡Œçš„æ•°æ®æ¥æ¸²æŸ“èœå•ã€‚</li>
<li>router-link ç»„ä»¶ä¼šè¢«æ¸²æŸ“æˆ a æ ‡ç­¾ï¼Œå½“ç”¨æˆ·ç‚¹å‡»èœå•æ—¶ï¼Œä¸»çª—å£çš„äºŒçº§è·¯ç”±å‘ç”Ÿè·³è½¬ï¼ˆsrc\renderer\window\WindowMain.vueï¼‰ã€‚</li>
<li>é€šè¿‡ watch æ–¹æ³•ç›‘æ§è·¯ç”±è·³è½¬çš„è¡Œä¸ºï¼Œå½“è·¯ç”±è·³è½¬åï¼Œéå† mainWindowRoutes æ•°ç»„å†…çš„å¯¹è±¡ï¼Œå–æ¶ˆä»¥å‰é€‰ä¸­çš„èœå•ï¼Œé€‰ä¸­æ–°çš„èœå•ã€‚</li>
<li>ç”±äº mainWindowRoutes æ˜¯ä¸€ä¸ª Ref å¯¹è±¡ï¼Œæ‰€ä»¥èœå•è¢«é€‰ä¸­æˆ–å–æ¶ˆé€‰ä¸­ä¹‹åï¼Œç›¸åº”çš„èœå•æ ·å¼ï¼ˆå’Œèœå•å†…çš„å­—ä½“å›¾æ ‡ï¼‰ä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚</li>
</ul>
<p>åœ¨ WindowMain.vue ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ipcRenderer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;electron&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">onMounted</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vue&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">BarLeft</span> <span class="nx">from</span> <span class="s2">&#34;../components/BarLeft.vue&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">onMounted</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&#34;showWindow&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">BarLeft</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pageBox&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">router-view</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">pageBox</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">border</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="mi">1</span><span class="nx">px</span> <span class="nx">solid</span> <span class="err">#</span><span class="nx">e6e6e6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">box</span><span class="o">-</span><span class="nx">sizing</span><span class="o">:</span> <span class="nx">border</span><span class="o">-</span><span class="nx">box</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">margin</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼•å…¥å­—ä½“å›¾æ ‡">å¼•å…¥å­—ä½“å›¾æ ‡</h2>
<p>åœ¨ <a href="https://www.iconfont.cn/" target="_blank" rel="noopener noreffer ">www.iconfont.cn/</a> è·å¾—å­—ä½“å›¾æ ‡ï¼ŒElectron ä½¿ç”¨ Chromium æ ¸å¿ƒï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªä½¿ç”¨ iconfont.css å’Œ iconfont.ttf è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ° src/renderer/assets/icon ä¸‹ï¼Œåœ¨ main.ts å¯¼å…¥ä¸€ä¸‹ iconfont.css å°±å¯ä»¥å…¨å±€ä½¿ç”¨å­—ä½“å›¾æ ‡äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./style.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;./assets/icon/iconfont.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./router&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">App</span> <span class="kr">from</span> <span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createApp</span><span class="p">(</span><span class="nx">App</span><span class="p">).</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">).</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon icon-chat&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ iconfont.ttf è¶³å¤Ÿå°ï¼Œé‚£ä¹ˆ vite ä¼šæŠŠå®ƒè½¬ä¹‰æˆ base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥åµŒå…¥åˆ°æ ·å¼æ–‡ä»¶ä¸­æ¥è¾¾åˆ°å°‘è¯·æ±‚æ•°é‡çš„ç›®çš„ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡åœ¨ vite.config.ts ä¸­å¢åŠ  build.assetsInlineLimit é…ç½®ï¼ˆå€¼è®¾ç½®ä¸º 0 å³å¯ï¼‰æ¥å…³é—­ vite çš„è¿™ä¸ªè¡Œä¸ºã€‚</p>
<p>è¿è¡Œé¡¹ç›®ï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_6.png" alt="" width="700" />  
<h2 id="ç®¡æ§åº”ç”¨çª—å£">ç®¡æ§åº”ç”¨çª—å£</h2>
<p>å¦‚ä½•ç®¡æ§åº”ç”¨å†…çš„çª—å£ï¼Œæ¯”å¦‚ï¼šä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºçª—å£ã€å¦‚ä½•é€šè¿‡è‡ªå®šä¹‰çª—å£æ ‡é¢˜æ æ¥ç®¡æ§å•ä¸ªçª—å£ç­‰å†…å®¹ã€‚</p>
<h3 id="ä¸»çª—å£æ˜¾ç¤ºæ—¶æœº">ä¸»çª—å£æ˜¾ç¤ºæ—¶æœº</h3>
<p>åœ¨ç¬¬ä¸€ä¸ªçª—å£åˆå§‹åŒ–çš„ç¬é—´ï¼Œä¼šæœ‰ä¸€ä¸ªé»‘çª—å£é—ªç°ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_7.png" alt="" width="700" />  
<p>æŒ‰ç…§ Electron å®˜ç½‘çš„å»ºè®®ï¼Œçª—å£ä¸€å¼€å§‹åº”è¯¥æ˜¯éšè—çš„ï¼Œåœ¨ ready-to-show äº‹ä»¶è§¦å‘åå†æ˜¾ç¤ºçª—å£ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">const { BrowserWindow } = require(&#34;electron&#34;);
</span></span><span class="line"><span class="cl">const win = new BrowserWindow({ show: false });
</span></span><span class="line"><span class="cl">win.once(&#34;ready-to-show&#34;, () =&gt; {
</span></span><span class="line"><span class="cl">win.show();
</span></span><span class="line"><span class="cl">});
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†è¿™ä¸ªäº‹ä»¶çš„è§¦å‘å¤ªæ—©äº†ï¼Œå› ä¸º Vue é¡¹ç›®çš„ HTML åŠ è½½ä¹‹åï¼ŒJavaScript è„šæœ¬è¿˜éœ€è¦åšå¾ˆå¤šäº‹æƒ…æ‰èƒ½æŠŠç»„ä»¶æ¸²æŸ“å‡ºæ¥ã€‚å†µä¸”å¼€å‘è€…å¯èƒ½è¿˜ä¼šåœ¨ Vue ç»„ä»¶åˆå§‹åŒ–çš„æ—©æœŸåšå¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œæ‰€ä»¥æ˜¾ç¤ºçª—å£ä¸èƒ½ä¾èµ– ready-to-show äº‹ä»¶ï¼Œå¿…é¡»æ‰‹åŠ¨æ§åˆ¶ã€‚</p>
<p>ä¸»çª—å£å¯¹è±¡ mainWindow åˆå§‹åŒ–æ—¶ï¼ŒæŠŠé…ç½®å±æ€§ show è®¾ç½®ä¸º falseï¼Œå°±å¯ä»¥è®©ä¸»çª—å£åˆå§‹åŒ–æˆåŠŸåå¤„äºéšè—çŠ¶æ€ã€‚</p>
<p>æ¥ä¸‹æ¥å†åœ¨åˆé€‚çš„æ—¶æœºè®©æ¸²æŸ“è¿›ç¨‹æ§åˆ¶ä¸»çª—å£æ˜¾ç¤ºå‡ºæ¥å³å¯ã€‚è¿™é‡Œåœ¨ WindowMain.vue ç»„ä»¶æ¸²æŸ“å®Œæˆä¹‹åæ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ipcRenderer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;electron&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">onMounted</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;vue&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">onMounted</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&#34;showWindow&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªå®šä¹‰çª—å£æ ‡é¢˜æ ">è‡ªå®šä¹‰çª—å£æ ‡é¢˜æ </h3>
<p>åœ¨ src/renderer/components ä¸‹æ–°å»º BarTop.vueï¼Œè¿™æ˜¯çª—å£æ ‡é¢˜æ ç»„ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;topBar&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;winTitle&#34;</span><span class="p">&gt;{{</span> <span class="nx">title</span> <span class="p">}}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;winTool&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="nt">@click</span><span class="s">=&#34;minimizeMainWindow&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon icon-minimize&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="nt">v-if</span><span class="s">=&#34;isMaximized&#34; @click=&#34;unmaximizeMainWindow&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;i class=&#34;icon icon-restore&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;div v-else @click=&#34;maxmizeMainWin&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;i class=&#34;icon icon-maximize&#34;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;div @click=&#34;closeWindow&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;icon icon-close&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span> <span class="na">setup</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">topBar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">25</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">line</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">25</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span><span class="nx">webkit</span><span class="o">-</span><span class="nx">app</span><span class="o">-</span><span class="nx">region</span><span class="o">:</span> <span class="nx">drag</span><span class="p">;</span> <span class="cm">/* å¯æ‹–æ‹½åŒºåŸŸ */</span>
</span></span><span class="line"><span class="cl">  <span class="nx">width</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTitle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">14</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="err">#</span><span class="mi">888</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span><span class="nx">webkit</span><span class="o">-</span><span class="nx">app</span><span class="o">-</span><span class="nx">region</span><span class="o">:</span> <span class="nx">no</span><span class="o">-</span><span class="nx">drag</span><span class="p">;</span> <span class="cm">/* å¯æ‹–æ‹½åŒºåŸŸå†…çš„ä¸å¯æ‹–æ‹½åŒºåŸŸ */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="nx">div</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">width</span><span class="o">:</span> <span class="mi">34</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">text</span><span class="o">-</span><span class="nx">align</span><span class="o">:</span> <span class="nx">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="err">#</span><span class="mi">999</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cursor</span><span class="o">:</span> <span class="nx">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">line</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">25</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="p">.</span><span class="nx">icon</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="err">#</span><span class="mi">666666</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span> <span class="nx">bold</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="nx">div</span><span class="o">:</span><span class="nx">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">background</span><span class="o">:</span> <span class="err">#</span><span class="nx">efefef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="nx">div</span><span class="o">:</span><span class="nx">last</span><span class="o">-</span><span class="nx">child</span><span class="o">:</span><span class="nx">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">background</span><span class="o">:</span> <span class="err">#</span><span class="nx">ff7875</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">winTool</span> <span class="nx">div</span><span class="o">:</span><span class="nx">last</span><span class="o">-</span><span class="nx">child</span><span class="o">:</span><span class="nx">hover</span> <span class="nx">i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="err">#</span><span class="nx">fff</span> <span class="o">!</span><span class="nx">important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¦è‡ªå®šä¹‰ä¸€ä¸ªçª—å£çš„æ ‡é¢˜æ å¿…é¡»æŠŠçª—å£é»˜è®¤çš„æ ‡é¢˜æ å–æ¶ˆæ‰æ‰è¡Œã€‚åªéœ€è¦åœ¨åˆå§‹åŒ– mainWindow å¯¹è±¡æ—¶ï¼ˆä¸»è¿›ç¨‹é‡Œçš„é€»è¾‘ï¼‰ï¼ŒæŠŠçª—å£é…ç½®å¯¹è±¡çš„ frame å±æ€§è®¾ç½®ä¸º false å°±å¯ä»¥ä½¿è¿™ä¸ªçª—å£æˆä¸ºæ— è¾¹æ¡†çª—å£äº†ã€‚</p>
</li>
<li>
<p>çª—å£æ ‡é¢˜æ˜¯é€šè¿‡ props æ•°æ®ä¼ é€’ç»™æ ‡é¢˜æ ç»„ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ ‡é¢˜æ çš„æ ‡é¢˜æ˜¯ç”±å…¶çˆ¶ç»„ä»¶æ¥ç¡®å®šçš„ã€‚</p>
</li>
<li>
<p>æ ‡é¢˜æ ä¸­å¯æ‹–æ‹½åŒºåŸŸæ˜¯é€šè¿‡æ ·å¼ -webkit-app-region: drag å®šä¹‰çš„ï¼Œé¼ æ ‡åœ¨è¿™ä¸ªæ ·å¼å®šä¹‰çš„ç»„ä»¶ä¸Šæ‹–æ‹½å¯ä»¥ç§»åŠ¨çª—å£ï¼ŒåŒå‡»å¯ä»¥æ”¾å¤§æˆ–è€…è¿˜åŸçª—å£ï¼Œå¦‚æœè¿™ä¸ªç»„ä»¶å†…æœ‰å­ç»„ä»¶ä¸å¸Œæœ›æ‹¥æœ‰è¯¥èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡ -webkit-app-region: no-drag; æ¥å–æ¶ˆæ­¤èƒ½åŠ›ã€‚</p>
</li>
<li>
<p>æœ€å¤§åŒ–ã€æœ€å°åŒ–ã€è¿˜åŸã€å…³é—­çª—å£ç­‰æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œéƒ½æ˜¯é€šè¿‡ ipcRenderer.invoke æ–¹æ³•æ¥è°ƒç”¨ä¸»è¿›ç¨‹ CommonWindowEvent ç±»æä¾›çš„æ¶ˆæ¯ç®¡é“æ¥å®ç°å¯¹åº”çš„åŠŸèƒ½çš„ã€‚</p>
</li>
<li>
<p>ç”±äºçª—å£æœ€å¤§åŒ–ï¼ˆæˆ–è¿˜åŸï¼‰ä¸ä¸€å®šæ˜¯é€šè¿‡ç‚¹å‡»æœ€å¤§åŒ–æŒ‰é’®ï¼ˆæˆ–è¿˜åŸæŒ‰é’®ï¼‰è§¦å‘çš„ï¼Œæœ‰å¯èƒ½æ˜¯é€šè¿‡åŒå‡»æ ‡é¢˜æ å¯æ‹–æ‹½åŒºåŸŸè§¦å‘çš„ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½é€šè¿‡ ipcRenderer.on æ¥ç›‘å¬çª—å£çš„æœ€å¤§åŒ–æˆ–è¿˜åŸäº‹ä»¶ï¼Œä»¥æ­¤æ¥æ”¹å˜å¯¹åº”çš„æœ€å¤§åŒ–æˆ–è¿˜åŸæŒ‰é’®çš„æ˜¾éšçŠ¶æ€ã€‚ä¸èƒ½åœ¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚windowMaximized æ¶ˆæ¯å’Œ windowUnmaximized æ¶ˆæ¯ä¹Ÿæ˜¯ç”±ä¸»è¿›ç¨‹çš„ CommonWindowEvent ç±»å‘æ¥çš„ã€‚</p>
</li>
<li>
<p>ç”±äºå¤šä¸ªäºŒçº§è·¯ç”±é¡µé¢ä¼šå¼•ç”¨ BarTop.vueï¼Œä¸ºäº†é¿å…åœ¨åˆ‡æ¢è·¯ç”±çš„æ—¶å€™ï¼Œåå¤é€šè¿‡ ipcRenderer.on æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨ï¼Œæ‰€ä»¥åœ¨ç»„ä»¶çš„ onUnmounted äº‹ä»¶å†…æ³¨é”€äº†æ¶ˆæ¯ç›‘å¬å™¨ï¼Œé¿å…äº‹ä»¶æ³„æ¼ã€‚</p>
</li>
</ul>
<p>src/main/CommonWindowEvent.ts çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">BrowserWindow</span><span class="p">,</span> <span class="nx">ipcMain</span><span class="p">,</span> <span class="nx">app</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸»è¿›ç¨‹å…¬å…±æ¶ˆæ¯å¤„ç†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">CommonWindowEvent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">private</span> <span class="kr">static</span> <span class="nx">getWin</span><span class="p">(</span><span class="nx">event</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">BrowserWindow</span><span class="p">.</span><span class="nx">fromWebContents</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">public</span> <span class="kr">static</span> <span class="nx">listen() {</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;minimizeWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">minimize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;maxmizeWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">maximize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;unmaximizeWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">unmaximize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;hideWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;showWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;closeWindow&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;resizable&#39;</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getWin</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">isResizable</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">ipcMain</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="s1">&#39;getPath&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">getPath</span><span class="p">(</span><span class="nx">name</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ä¸»è¿›ç¨‹å…¬å…±äº‹ä»¶å¤„ç†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">public</span> <span class="kr">static</span> <span class="nx">regWinEvent</span><span class="p">(</span><span class="nx">win</span>: <span class="kt">BrowserWindow</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">win</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">win</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;windowMaximized&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">win</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;unmaximize&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">win</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;windowUnmaximized&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨ listen æ–¹æ³•å†…éƒ¨æ³¨å†Œäº†ä¸€ç³»åˆ—æ¶ˆæ¯ç®¡é“ï¼Œæ–¹ä¾¿æ¸²æŸ“è¿›ç¨‹æ§åˆ¶ä¸»è¿›ç¨‹çš„ä¸€äº›è¡Œä¸ºï¼Œæ ‡é¢˜æ ç»„ä»¶çš„çª—å£çš„æœ€å¤§åŒ–ã€æœ€å°åŒ–ã€è¿˜åŸç­‰åŠŸèƒ½éƒ½æ˜¯åœ¨è¿™é‡Œå®ç°çš„ã€‚åœ¨ app ready ä¹‹åè°ƒç”¨ CommonWindowEvent.listen(); è¿™ä¸ªæ–¹æ³•å³å¯æ³¨å†Œè¿™äº›æ¶ˆæ¯ç®¡é“ã€‚</li>
<li>regWinEvent æ–¹æ³•è´Ÿè´£ä¸ºçª—å£å¯¹è±¡æ³¨å†Œäº‹ä»¶ï¼Œå½“çª—å£æœ€å¤§åŒ–æˆ–è¿˜åŸåï¼Œè¿™äº›äº‹ä»¶çš„å¤„ç†å‡½æ•°è´Ÿè´£æŠŠæ¶ˆæ¯å‘é€ç»™æ¸²æŸ“è¿›ç¨‹ã€‚æ ‡é¢˜æ çš„å¯¹åº”æŒ‰é’®çš„å›¾æ ‡ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„å˜åŒ–ï¼ŒåŒæ ·ä¹Ÿæ˜¯åœ¨ app ready ä¹‹åè°ƒç”¨ CommonWindowEvent.regWinEvent(mainWindow); è¿™ä¸ªæ–¹æ³•å³å¯ã€‚</li>
</ul>
<p>åœ¨ src/main/mainEntry.ts ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">app</span><span class="p">,</span> <span class="nx">BrowserWindow</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">CustomScheme</span><span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./customScheme&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">CommonWindowEvent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./CommonWindowEvent&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ELECTRON_DISABLE_SECURITY_WARNINGS</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainWindow</span>: <span class="kt">BrowserWindow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è°ƒç”¨ CommonWindowEvent.regWinEvent(win);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;browser-window-created&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CommonWindowEvent</span><span class="p">.</span><span class="nx">regWinEvent</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">whenReady</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">nodeIntegration</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webSecurity</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">allowRunningInsecureContent</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">contextIsolation</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webviewTag</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">spellcheck</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">disableHtmlFullscreenWindowResize</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">openDevTools</span><span class="p">({</span><span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;undocked&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">CustomScheme</span><span class="p">.</span><span class="nx">registerScheme</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="s1">&#39;app&#34;//index.html&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è°ƒç”¨ CommonWindowEvent.listen();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">CommonWindowEvent</span><span class="p">.</span><span class="nx">listen</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="çª—å£åŠ è½½è¿‡æ…¢è§£å†³æ–¹æ¡ˆ">çª—å£åŠ è½½è¿‡æ…¢è§£å†³æ–¹æ¡ˆ</h3>
<p>Electron åˆ›å»ºä¸€ä¸ª BrowserWindow å¯¹è±¡ï¼Œå¹¶è®©å®ƒæˆåŠŸæ¸²æŸ“ä¸€ä¸ªé¡µé¢æ˜¯éå¸¸è€—æ—¶çš„ï¼Œåœ¨ä¸€ä¸ªæ™®é€šé…ç½®çš„ç”µè„‘ä¸Šï¼Œè¿™å¤§æ¦‚éœ€è¦ 2~5 ç§’å·¦å³çš„æ—¶é—´ï¼ˆå°‘é‡ç”¨æˆ·åé¦ˆæ²¡è¿™ä¸ªé—®é¢˜ï¼‰ã€‚</p>
<h4 id="çª—å£æ± è§£å†³æ–¹æ¡ˆ">çª—å£æ± è§£å†³æ–¹æ¡ˆ</h4>
<p>æå‰å‡†å¤‡ 1 ä¸ªæˆ–å¤šä¸ªéšè—çš„çª—å£ï¼Œè®©å®ƒä»¬åŠ è½½ä¸€ä¸ªéª¨æ¶å±é¡µé¢ï¼Œæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œå½“åº”ç”¨ç¨‹åºéœ€è¦æ‰“å¼€ä¸€ä¸ªæ–°çª—å£æ—¶ï¼Œå°±ä»è¿™ä¸ªæ•°ç»„é‡Œå–å‡ºä¸€ä¸ªçª—å£ï¼Œæ‰§è¡Œé¡µå†…è·³è½¬ï¼Œä»éª¨æ¶å±é¡µé¢è·³è½¬åˆ°ä¸šåŠ¡é¡µé¢ï¼Œç„¶åå†æŠŠè¿™ä¸ªçª—å£æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™å°±æ¶ˆè´¹æ‰äº†ä¸€ä¸ªçª—å£ã€‚</p>
<p>å½“åº”ç”¨ç¨‹åºæ¶ˆè´¹æ‰ä¸€ä¸ªçª—å£ä¹‹åï¼Œé©¬ä¸Šå†åˆ›å»ºä¸€ä¸ªæ–°çš„åŠ è½½äº†éª¨æ¶å±é¡µé¢çš„çª—å£æ”¾å…¥æ•°ç»„ï¼Œä¿è¯æœ‰è¶³å¤Ÿçš„å¾…å‘½éšè—çª—å£ã€‚</p>
<p>å½“ç”¨æˆ·å…³é—­æŸä¸ªåŠ è½½äº†ä¸šåŠ¡é¡µé¢çš„çª—å£æ—¶ï¼Œå°±æŠŠå®ƒä»æ•°ç»„ä¸­åˆ é™¤æ‰ã€‚é¿å…æ•°ç»„é‡Œå­˜åœ¨æ— ç”¨çš„çª—å£ã€‚</p>
<p>è¿™ä¸ªæ–¹æ¡ˆä¹‹æ‰€ä»¥è¡Œä¹‹æœ‰æ•ˆæ˜¯å› ä¸ºåœ¨æ²¡æœ‰ä½¿ç”¨çª—å£æ—¶å°±æå‰å‡†å¤‡å¥½äº†çª—å£ï¼Œç­‰çœŸæ­£éœ€è¦ä½¿ç”¨çª—å£æ—¶ï¼Œä»…ä»…æ˜¯å®Œæˆäº†ä¸€æ¬¡é¡µé¢è·³è½¬çš„å·¥ä½œï¼Œè¿™ä¸ªè·³è½¬å·¥ä½œå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å°±å®Œæˆã€‚æ‰€ä»¥ç»™ç”¨æˆ·çš„æ„ŸçŸ¥å°±æ˜¯æ‰“å¼€å­çª—å£ç‰¹åˆ«å¿«ã€‚</p>
<p>webview å’Œ BrowserView åˆ›å»ºæ…¢çš„é—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ¡ˆè§£å†³ã€‚</p>
<p>ç„¶è€Œè¿™ä¸ªæ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸‰ä¸ªç¼ºç‚¹ã€‚</p>
<ul>
<li>æ— æ³•ä¼˜åŒ–æ•´ä¸ªåº”ç”¨çš„ç¬¬ä¸€ä¸ªçª—å£ã€‚</li>
<li>ç³»ç»Ÿå†…éƒ¨å§‹ç»ˆä¼šæœ‰ 1 åˆ° 2 ä¸ªéšè—çª—å£å¤„äºå¾…å‘½çŠ¶æ€ï¼Œè¿™æ— å½¢ä¸­å¢åŠ äº†ç”¨æˆ·çš„å†…å­˜æ¶ˆè€—ã€‚</li>
<li>è™½ç„¶è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¸Šå»é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä½†è¦æ§åˆ¶å¥½æ‰€æœ‰çš„ç»†èŠ‚ï¼ˆæ¯”å¦‚ï¼Œçª—å£é—´çš„é€šä¿¡ã€ç•Œé¢ä»£ç å¦‚ä½•æ§åˆ¶çª—å£çš„å¤–è§‚ã€å¦‚ä½•å®ç°æ¨¡æ€å­çª—å£ç­‰ï¼‰è¿˜æ˜¯éå¸¸ç¹ççš„ã€‚</li>
</ul>
<h4 id="windowopen-è§£å†³æ–¹æ¡ˆ">window.open è§£å†³æ–¹æ¡ˆ</h4>
<p>Electron å…è®¸ä½¿ç”¨ window.open çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªå­çª—å£ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ‰“å¼€çš„å­çª—å£ä¸ä¼šåˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œæ•ˆç‡éå¸¸é«˜ï¼Œå¯ä»¥åœ¨å‡ ç™¾æ¯«ç§’å†…å°±ä¸ºç”¨æˆ·å‘ˆç°çª—å£å†…å®¹ã€‚</p>
<p>ä½†å¯¹äºä¸€äº›å¤æ‚çš„éœ€æ±‚å´éœ€è¦é¢å¤–çš„å¤„ç†æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šç³»ç»Ÿè®¾ç½®å­çª—å£ï¼Œå½“ç”¨æˆ·å®ŒæˆæŸä¸€é¡¹è®¾ç½®ä¹‹åï¼Œè¦é€šçŸ¥çˆ¶çª—å£åšå‡ºç›¸åº”çš„æ”¹å˜ã€‚è¿™æ˜¯å¸¸è§çš„çˆ¶å­çª—å£é€šä¿¡çš„éœ€æ±‚ã€‚</p>
<p>é¦–å…ˆéœ€è¦ä¸ºä¸»çª—å£çš„ webContents æ³¨å†Œ setWindowOpenHandler æ–¹æ³•ã€‚</p>
<p>åœ¨ src/main/CommonWindowEvent.ts ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">mainWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">setWindowOpenHandler</span><span class="p">((</span><span class="nx">param</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">action</span><span class="o">:</span> <span class="s2">&#34;allow&#34;</span><span class="p">,</span> <span class="nx">overrideBrowserWindowOptions</span>: <span class="kt">yourWindowConfig</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ setWindowOpenHandler æ–¹æ³•çš„å›è°ƒå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­ action: &ldquo;allow&rdquo; ä»£è¡¨å…è®¸çª—å£æ‰“å¼€ï¼Œå¦‚æœä½ æƒ³é˜»æ­¢çª—å£æ‰“å¼€ï¼Œé‚£ä¹ˆåªè¦è¿”å› {action: &ldquo;deny&rdquo;} å³å¯ã€‚</p>
<p>è¿”å›å¯¹è±¡çš„ overrideBrowserWindowOptions å±æ€§çš„å€¼æ˜¯è¢«æ‰“å¼€çš„æ–°çª—å£çš„é…ç½®å¯¹è±¡ã€‚</p>
<p>åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ‰“å¼€å­çª—å£çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">window.open(`/WindowSetting/AccountSetting`);
</span></span></code></pre></td></tr></table>
</div>
</div><p>window.open æ‰“å¼€æ–°çª—å£ä¹‹æ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ï¼Œæ˜¯å› ä¸ºç”¨è¿™ç§æ–¹å¼åˆ›å»ºçš„æ–°çª—å£ä¸ä¼šåˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ä¸€ä¸ªçª—å£å´©æºƒä¼šæ‹–ç´¯å…¶ä»–çª—å£è·Ÿç€å´©æºƒï¼ˆä¸»çª—å£ä¸å—å½±å“ï¼‰ã€‚</p>
<p>ä½¿ç”¨ window.open æ‰“å¼€çš„æ–°çª—å£è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç±»çª—å£åœ¨å…³é—­ä¹‹åè™½ç„¶ä¼šé‡Šæ”¾æ‰å¤§éƒ¨åˆ†å†…å­˜ï¼Œä½†æœ‰ä¸€å°éƒ¨åˆ†å†…å­˜æ— æ³•é‡Šæ”¾ï¼ˆæ— è®ºä½ æ‰“å¼€å¤šå°‘ä¸ªå­çª—å£ï¼Œå…¨éƒ¨å…³é—­ä¹‹åæ€»ä¼šæœ‰é‚£ä¹ˆå›ºå®šçš„ä¸€å°å—å†…å­˜æ— æ³•é‡Šæ”¾ï¼‰ï¼Œè¿™ä¸çª—å£æ± æ–¹æ¡ˆçš„å†…å­˜æŸè€—ç›¸å½“ã€‚</p>
<p>æ¥ä¸‹æ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆæ§åˆ¶å­çª—å£ã€‚</p>
<h5 id="å­çª—å£çš„æ ‡é¢˜æ æ¶ˆæ¯">å­çª—å£çš„æ ‡é¢˜æ æ¶ˆæ¯</h5>
<p>è‡ªå®šä¹‰ä¸»çª—å£çš„æ ‡é¢˜æ  BarTop.vueï¼Œæ ‡é¢˜æ ç»„ä»¶éœ€è¦ç›‘å¬ä¸»è¿›ç¨‹å‘æ¥çš„ windowMaximized æ¶ˆæ¯å’Œ windowUnmaximized æ¶ˆæ¯ï¼Œå­çª—å£å½“ç„¶ä¹Ÿå¸Œæœ›å¤ç”¨è¿™ä¸ªç»„ä»¶ï¼Œç„¶è€Œå­çª—å£çš„çª—å£å¯¹è±¡æ˜¯åœ¨ Electron å†…éƒ¨åˆ›å»ºçš„ï¼Œä¸æ˜¯å¼€å‘è€…åˆ›å»ºçš„ï¼Œæ²¡æœ‰å­çª—å£çš„çª—å£å¯¹è±¡ï¼Œè¯¥å¦‚ä½•ä½¿ç”¨ regWinEvent æ–¹æ³•ä¸ºå­çª—å£æ³¨å†Œæœ€å¤§åŒ–å’Œè¿˜åŸäº‹ä»¶å‘¢ï¼Ÿ</p>
<p>è¿™å°±éœ€è¦ç”¨åˆ° app å¯¹è±¡çš„ browser-window-created äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// src/main/mainEntry.ts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;browser-window-created&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nx">CommonWindowEvent</span><span class="p">.</span><span class="nx">regWinEvent</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯å½“æœ‰ä¸€ä¸ªçª—å£è¢«åˆ›å»ºæˆåŠŸåï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œä¸»çª—å£å’Œä½¿ç”¨ window.open åˆ›å»ºçš„å­çª—å£éƒ½ä¸€æ ·ï¼Œè¿™ä¸ªäº‹ä»¶çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯çª—å£å¯¹è±¡ã€‚</p>
<h5 id="åŠ¨æ€è®¾ç½®å­çª—å£çš„é…ç½®">åŠ¨æ€è®¾ç½®å­çª—å£çš„é…ç½®</h5>
<p>è™½ç„¶å¯ä»¥åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ç”¨ window.open æ–¹æ³•æ‰“å¼€ä¸€ä¸ªå­çª—å£ï¼Œä½†è¿™ä¸ªå­çª—å£çš„é…ç½®ä¿¡æ¯ç›®å‰è¿˜æ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­è®¾ç½®çš„ï¼ˆoverrideBrowserWindowOptionsï¼‰ï¼Œå¤§éƒ¨åˆ†æ—¶å€™è¦æ ¹æ®æ¸²æŸ“è¿›ç¨‹çš„è¦æ±‚æ¥æ”¹å˜å­çª—å£çš„é…ç½®ï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯ç”±æ¸²æŸ“è¿›ç¨‹æ¥è®¾ç½®è¿™äº›é…ç½®ä¿¡æ¯ã€‚</p>
<p>åœ¨ CommonWindowEvent ç±»çš„ regWinEvent æ–¹æ³•å¢åŠ ä¸€æ®µé€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// æ³¨å†Œæ‰“å¼€å­çª—å£çš„å›è°ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// @ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">win</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">setWindowOpenHandler</span><span class="p">((</span><span class="nx">param</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// åŸºç¡€çª—å£é…ç½®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">frame</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">parent</span>: <span class="kt">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">nodeIntegration</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">webSecurity</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">allowRunningInsecureContent</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">contextIsolation</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">webviewTag</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">spellcheck</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">disableHtmlFullscreenWindowResize</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">nativeWindowOpen</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å¼€å‘è€…è‡ªå®šä¹‰çª—å£é…ç½®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">let</span> <span class="nx">features</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">features</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">features</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">p</span> <span class="o">===</span> <span class="s2">&#34;webPreferences&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">p2</span> <span class="k">in</span> <span class="nx">features</span><span class="p">.</span><span class="nx">webPreferences</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//@ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">config</span><span class="p">.</span><span class="nx">webPreferences</span><span class="p">[</span><span class="nx">p2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">features</span><span class="p">.</span><span class="nx">webPreferences</span><span class="p">[</span><span class="nx">p2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//@ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">config</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">features</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// @ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">[</span><span class="s2">&#34;modal&#34;</span><span class="p">]</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="nx">config</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">win</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å…è®¸æ‰“å¼€çª—å£ï¼Œå¹¶ä¼ é€’çª—å£é…ç½®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="p">{</span><span class="nx">action</span><span class="o">:</span> <span class="s2">&#34;allow&#34;</span><span class="p">,</span> <span class="nx">overrideBrowserWindowOptions</span>: <span class="kt">config</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>config å¯¹è±¡å’Œä¸»çª—å£çš„ config å¯¹è±¡åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€å¥½æŠŠå®ƒæŠ½è±¡å‡ºæ¥ã€‚</p>
<p>param å‚æ•°çš„ features å±æ€§æ˜¯ç”±æ¸²æŸ“è¿›ç¨‹ä¼ è¿‡æ¥çš„ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™é‡ŒæŠŠå®ƒå½“ä½œä¸€ä¸ª JSON å­—ç¬¦ä¸²ä½¿ç”¨ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²é‡ŒåŒ…å«ç€æ¸²æŸ“è¿›ç¨‹æä¾›çš„çª—å£é…ç½®é¡¹ï¼Œè¿™äº›é…ç½®é¡¹ä¸ config å¯¹è±¡æä¾›çš„åŸºç¡€é…ç½®é¡¹ç»“åˆï¼Œæœ€ç»ˆå½¢æˆäº†å­çª—å£çš„é…ç½®é¡¹ã€‚</p>
<p>å¦‚æœé…ç½®é¡¹ä¸­ modal å±æ€§çš„å€¼ä¸º true çš„è¯ï¼Œè¯´æ˜æ¸²æŸ“è¿›ç¨‹å¸Œæœ›å­çª—å£ä¸ºä¸€ä¸ªæ¨¡æ€çª—å£ï¼Œè¿™æ—¶è¦ä¸ºå­çª—å£æä¾›çˆ¶çª—å£é…ç½®é¡¹ï¼šparentï¼Œè¿™ä¸ªé…ç½®é¡¹çš„å€¼å°±æ˜¯å½“å‰çª—å£ã€‚</p>
<p>ä¹‹æ‰€ä»¥æŠŠè¿™æ®µé€»è¾‘æ”¾ç½®åœ¨ CommonWindowEvent ç±»çš„ regWinEvent æ–¹æ³•ä¸­ï¼Œå°±æ˜¯å¸Œæœ›æ›´æ–¹ä¾¿åœ°ä¸ºåº”ç”¨å†…çš„æ‰€æœ‰çª—å£æä¾›è¿™é¡¹èƒ½åŠ›ï¼Œå¦‚æœä¸å¸Œæœ›è¿™ä¹ˆåšï¼Œä¹Ÿå¯ä»¥æŠŠè¿™æ®µé€»è¾‘æ”¾ç½®åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ä¸­ã€‚</p>
<p>åœ¨ src/renderer/components/BarLeft.vue ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">openSettingWindow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">modal</span>: <span class="kt">true</span><span class="p">,</span> <span class="nx">width</span>: <span class="kt">2002</span><span class="p">,</span> <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span> <span class="nx">webviewTag</span>: <span class="kt">false</span> <span class="p">}</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="sb">`/WindowSetting/AccountSetting`</span><span class="p">,</span> <span class="s2">&#34;_blank&#34;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">config</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>window.open æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°å®˜æ–¹å®šä¹‰ä¸ºä¸€ä¸ªé€—å·åˆ†å‰²çš„ key-value åˆ—è¡¨ï¼Œä½†è¿™é‡ŒæŠŠå®ƒå˜æˆäº†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿åœ°æ§åˆ¶å­çª—å£çš„é…ç½®å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨ window.open æ‰“å¼€æ–°çª—å£é€Ÿåº¦éå¸¸å¿«ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è®©æ–°çª—å£æ˜¾ç¤ºå‡ºæ¥äº† config.show = trueã€‚å¦‚æœä½ éœ€è¦åœ¨æ–°çª—å£åˆå§‹åŒ–æ—¶å®Œæˆå¤æ‚è€—æ—¶çš„ä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¹ˆä½ ä¹Ÿåº”è¯¥æ‰‹åŠ¨æ§åˆ¶æ–°çª—å£çš„æ˜¾ç¤ºæ—¶æœºã€‚</p>
<h5 id="å°è£…å­çª—å£åŠ è½½æˆåŠŸçš„äº‹ä»¶">å°è£…å­çª—å£åŠ è½½æˆåŠŸçš„äº‹ä»¶</h5>
<p>ç°åœ¨é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šä¸çŸ¥é“å­çª—å£ä½•æ—¶åŠ è½½æˆåŠŸäº†ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å•çº¯åœ°ä½¿ç”¨ window å¯¹è±¡çš„ onload äº‹ä»¶æˆ–è€… document å¯¹è±¡çš„ DOMContentLoaded äº‹ä»¶æ¥åˆ¤æ–­å­çª—å£æ˜¯å¦åŠ è½½æˆåŠŸäº†ã€‚å› ä¸ºè¿™ä¸ªæ—¶å€™ä½ çš„ä¸šåŠ¡ä»£ç ï¼ˆæ¯”å¦‚ä»æ•°æ®åº“å¼‚æ­¥è¯»å–æ•°æ®çš„é€»è¾‘ï¼‰å¯èƒ½å°šæœªæ‰§è¡Œå®Œæˆã€‚</p>
<p>æ‰€ä»¥ï¼Œè¦è‡ªå·±å°è£…ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ä¸šåŠ¡ä»£ç çœŸæ­£æ‰§è¡Œå®Œæˆæ—¶ï¼Œæ‰‹åŠ¨å‘å°„è¿™ä¸ªäº‹ä»¶ï¼Œå‘ŠçŸ¥ä¸»çª—å£ï¼šâ€œç°åœ¨å­çª—å£å·²ç»åŠ è½½æˆåŠŸå•¦ï¼Œä½ å¯ä»¥ç»™æˆ‘å‘é€æ¶ˆæ¯äº†ï¼â€</p>
<p>åœ¨å°è£…è¿™ä¸ªäº‹ä»¶å‰ï¼Œå…ˆæ¥æŠŠ window.open æ‰“å¼€å­çª—å£çš„é€»è¾‘å°è£…åˆ°ä¸€ä¸ª Promise å¯¹è±¡ä¸­ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<p>src/renderer/common/Dialog.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">createDialog</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">config</span>: <span class="kt">any</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">Window</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">windowProxy</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="s1">&#39;_blank&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">config</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">readyHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">[</span><span class="s1">&#39;msgName&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;__dialogReady&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">readyHandler</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">resolve</span><span class="p">(</span><span class="nx">windowProxy</span> <span class="kr">as</span> <span class="nx">Window</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">readyHandler</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æ¸²æŸ“è¿›ç¨‹çš„æŸä¸ªç»„ä»¶éœ€è¦æ‰“å¼€å­çª—å£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Dialog.ts æä¾›çš„ createDialog æ–¹æ³•ã€‚</p>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒæŠŠ window.open çš„é€»è¾‘å°è£…åˆ°ä¸€ä¸ª Promise å¯¹è±¡ä¸­ï¼Œé€šè¿‡ window.open æ‰“å¼€å­çª—å£åï¼Œå½“å‰çª—å£é©¬ä¸Šç›‘å¬ message äº‹ä»¶ï¼Œå­çª—å£æœ‰æ¶ˆæ¯å‘é€ç»™å½“å‰çª—å£æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°†è¢«è§¦å‘ã€‚</p>
<p>åœ¨messageäº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­å®Œæˆäº†ä¸‹é¢ä¸‰ä¸ªå·¥ä½œ:</p>
<ul>
<li>e.data é‡Œå­˜æ”¾ç€å…·ä½“çš„æ¶ˆæ¯å†…å®¹ï¼ŒæŠŠå®ƒæ ¼å¼åŒ–æˆä¸€ä¸ª JSON å¯¹è±¡ã€‚</li>
<li>å¦‚æœè¿™ä¸ª JSON å¯¹è±¡çš„ msgName å±æ€§ä¸º __dialogReady å­—ç¬¦ä¸²ï¼Œå°±æˆåŠŸ resolveã€‚</li>
<li>Promise å¯¹è±¡æˆåŠŸ resolve ä¹‹å‰è¦ç§»é™¤æ‰ message äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼ˆå¦‚æœä¸è¿™ä¹ˆåšï¼Œç”¨æˆ·æ¯æ‰“å¼€ä¸€ä¸ªå­çª—å£ï¼Œå°±ä¼šæ³¨å†Œä¸€æ¬¡messageäº‹ä»¶ï¼‰ã€‚</li>
</ul>
<p>window.openæ–¹æ³•è¿”å›çš„æ˜¯ç›®æ ‡çª—å£çš„å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•ç”¨å¯¹è±¡å‘ç›®æ ‡çª—å£å‘é€æ¶ˆæ¯ï¼Œæˆ–æ‰§è¡Œå…¶ä»–ç›¸å…³æ“ä½œã€‚</p>
<p>Dialog.ts å¹¶éåªå¯¼å‡ºäº† createDialog è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒè¿˜å¯¼å‡ºäº† dialogReady æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">dialogReady</span> <span class="o">=</span> <span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">msgName</span><span class="o">:</span>  <span class="s1">&#39;__dialogReady&#39;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºå­çª—å£æœåŠ¡çš„ï¼Œå½“å­çª—å£å®Œæˆäº†å¿…è¦çš„ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œé€šçŸ¥çˆ¶çª—å£è‡ªå·±å·²ç»åŠ è½½æˆåŠŸã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•é€šè¿‡ window.opener å¯¹è±¡çš„ postMessage æ–¹æ³•å‘çˆ¶çª—å£å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯çš„å†…å®¹æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œè¿™ä¸ª JSON å¯¹è±¡çš„msgNameå±æ€§ä¸º __dialogReady å­—ç¬¦ä¸²ã€‚</p>
<p>çˆ¶çª—å£æ”¶åˆ°å­çª—å£å‘æ¥çš„è¿™ä¸ªæ¶ˆæ¯åï¼Œå°†è§¦å‘ message äº‹ä»¶ï¼Œä¹Ÿå°±ä¼šæ‰§è¡Œåœ¨ createDialog æ–¹æ³•ä¸­æ’°å†™çš„é€»è¾‘äº†ã€‚</p>
<h5 id="çˆ¶å­çª—å£äº’ç›¸é€šä¿¡">çˆ¶å­çª—å£äº’ç›¸é€šä¿¡</h5>
<p>ä½¿ç”¨ createDialog æ–¹æ³•è¿”å›çš„å¯¹è±¡å‘å­çª—å£å‘é€æ¶ˆæ¯ï¼Œæƒ³è¦æ¥æ”¶å­çª—å£å‘æ¥çš„æ¶ˆæ¯ï¼Œåªè¦ç›‘å¬ window å¯¹è±¡çš„ message äº‹ä»¶å³å¯ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/components/BarLeft.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">openSettingWindow</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span><span class="nx">modal</span>: <span class="kt">false</span><span class="p">,</span> <span class="nx">width</span>: <span class="kt">2002</span><span class="p">,</span> <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span><span class="nx">webviewTag</span>: <span class="kt">false</span><span class="p">}};</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">dialog</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createDialog</span><span class="p">(</span><span class="s1">&#39;/WindowSetting/AccountSetting&#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">msgName</span><span class="o">:</span> <span class="s2">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;msg from your parent&#34;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dialog</span><span class="o">?</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å­çª—å£å‘é€æ¶ˆæ¯ç»™çˆ¶çª—å£çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowSetting.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">onMounted</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;vue&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">dialogReady</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;../common/Dialog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">onMounted</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;ready&#34;</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span> <span class="nx">msgName</span><span class="o">:</span> <span class="s2">&#34;hello&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;I am your son.&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dialogReady</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›¸å¯¹äºä½¿ç”¨ ipcRender å’Œ ipcMain çš„æ–¹å¼å®Œæˆçª—å£é—´é€šä¿¡æ¥è¯´ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼å®Œæˆè·¨çª—å£é€šä¿¡æœ‰ä»¥ä¸‹å‡ é¡¹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ¶ˆæ¯ä¼ é€’ä¸æ¥æ”¶æ•ˆç‡éƒ½éå¸¸é«˜ï¼Œå‡ä¸ºæ¯«ç§’çº§ã€‚</li>
<li>å¼€å‘æ›´åŠ ç®€å•ï¼Œä»£ç é€»è¾‘æ¸…æ™°ï¼Œæ— éœ€è·¨è¿›ç¨‹ä¸­è½¬æ¶ˆæ¯ã€‚</li>
</ul>
<h2 id="pinia-ç®¡ç†åº”ç”¨çŠ¶æ€">Pinia ç®¡ç†åº”ç”¨çŠ¶æ€</h2>
<p>ç›¸æ¯” Vuexï¼ŒPinia çš„ä¼˜åŠ¿ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>æ²¡æœ‰ mutationsï¼Œç›¸åº”çš„å·¥ä½œéƒ½åœ¨ actions ä¸­å®Œæˆï¼Œactions ç›´æ¥æ”¯æŒå¼‚æ­¥å‡½æ•°ã€‚</li>
<li>å®Œç¾æ”¯æŒ TypeScriptï¼ŒVuex åœ¨è¿™æ–¹é¢åšå¾—ä¸æ˜¯å¾ˆå¥½ã€‚</li>
<li>å¯¹å¼€å‘å·¥å…·æ”¯æŒå‹å¥½ï¼Œï¼ŒPinia å¯¹è°ƒè¯•å·¥å…·ï¼ˆvue-devtoolsï¼‰ä¹Ÿæ”¯æŒå‹å¥½ã€‚</li>
<li>ä¸éœ€è¦å†ä½¿ç”¨åç§°ç©ºé—´æ¥æ§åˆ¶ storeï¼Œä¹Ÿä¸éœ€è¦å†è€ƒè™‘ store çš„åµŒå¥—é—®é¢˜ã€‚</li>
<li>æ€§èƒ½ä¼˜äº Vuexã€‚</li>
</ul>
<h3 id="å®‰è£…-pinia">å®‰è£… Pinia</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i pinia -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹æ¸²æŸ“è¿›ç¨‹å…¥å£æ–‡ä»¶ï¼ŒåŠ è½½ Pinia æ’ä»¶ï¼š</p>
<p>src/renderer/main.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">createApp</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">router</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./router&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createPinia</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;pinia&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">App</span> <span class="kr">from</span> <span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">&#39;./style.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;./assets/icon/iconfont.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createApp</span><span class="p">(</span><span class="nx">App</span><span class="p">).</span><span class="nx">use</span><span class="p">(</span><span class="nx">createPinia</span><span class="p">()).</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">).</span><span class="nx">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»º-store">åˆ›å»º Store</h3>
<p>åœ¨ src/renderer/store ç›®å½•ä¸‹æ–°å»º index.tsï¼Œåˆ›å»ºç¬¬ä¸€ä¸ª Store ç¨‹åºï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineStore</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Ref</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelChat</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../../model/ModelChat&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// mock data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">prepareData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelChat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s1">&#39;èŠå¤©å¯¹è±¡&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">sendTime</span> <span class="o">=</span> <span class="s1">&#39;æ˜¨å¤©&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="o">=</span> <span class="s1">&#39;è¿™æ˜¯æ­¤ä¼šè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="s1">&#39;https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">useChatStore</span> <span class="o">=</span> <span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">ModelChat</span><span class="err">[]</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="nx">prepareData</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">selectItem</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span>: <span class="kt">ModelChat</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">isSelected</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">item</span><span class="p">.</span><span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">selectItem</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ export æš´éœ² useChatStore æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é€šè¿‡ Pinia çš„ defineStore æ–¹æ³•åˆ›å»ºï¼Œåœ¨ Vue ä¸šåŠ¡ç»„ä»¶ä¸­æ‰§è¡Œè¿™ä¸ªå‡½æ•°å®ä¾‹æ‰ä¼šå¾—åˆ°çœŸæ­£çš„ Storeã€‚</p>
<p>ä½¿ç”¨ defineStore(name, callback) çš„å½¢å¼åˆ›å»º Storeï¼Œè¿™ç§å½¢å¼çš„ Store å«ä½œ Setup Storesã€‚Pinia è¿˜æä¾›äº†å¦ä¸€ç§å½¢å¼çš„ Store ï¼šOption Storesï¼Œå…·ä½“å¯ä»¥å‚é˜… Pinia çš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>è¿™ä¸ª Store çš„çŠ¶æ€æ•°æ®å­˜å‚¨åœ¨ï¼šdata å±æ€§ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªè¢« Ref å¯¹è±¡åŒ…è£¹ç€çš„æ•°ç»„ï¼Œæ•°ç»„é‡Œçš„å†…å®¹æ˜¯é€šè¿‡ prepareData æ–¹æ³•æ¨¡æ‹Ÿçš„ï¼ˆæ¨¡æ‹Ÿäº†åä¸ªèŠå¤©ä¼šè¯å¯¹è±¡ï¼‰ã€‚</p>
<p>è¿™ä¸ª Store è¿˜æä¾›äº†ä¸€ä¸ª actions æ–¹æ³•ï¼šselectItemï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºé€‰ä¸­æŸä¸ªå…·ä½“çš„èŠå¤©ä¼šè¯ã€‚</p>
<h3 id="æ•°æ®æ¨¡å‹--model">æ•°æ®æ¨¡å‹  Model</h3>
<p>èŠå¤©ä¼šè¯çš„æ•°æ®æ¨¡å‹æ˜¯åœ¨ src/model ç›®å½•ä¸‹å®šä¹‰çš„ï¼Œå› ä¸ºåº”ç”¨çš„ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½å¯èƒ½ä¼šç”¨åˆ°æ•°æ®æ¨¡å‹ï¼Œæ‰€ä»¥æŠŠå®ƒæ”¾ç½®åœ¨ renderer å’Œ main çš„åŒçº§ç›®å½•ä¸‹ã€‚</p>
<p>æ–°å»º src/model/ModelChat.tsï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModalBase</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./ModalBase&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">ModelChat</span> <span class="kr">extends</span> <span class="nx">ModalBase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fromName?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sendTime?</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastMsg?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">avatar?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 0 å•èŠï¼Œ1 ç¾¤èŠï¼Œ2 å…¬ä¼—å·ï¼Œ3 æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">chatType?</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡å‹ä¸»è¦ç”¨äºæè¿°å¯¹è±¡æºå¸¦çš„ä¿¡æ¯ï¼Œç”±äºæ‰€æœ‰çš„æ¨¡å‹éƒ½ä¼šæ‹¥æœ‰ä¸€äº›å…±åŒçš„å­—æ®µï¼Œæ‰€ä»¥æŠŠè¿™äº›å­—æ®µæ”¾ç½®åœ¨æ¨¡å‹çš„åŸºç±» ModelBase ä¸­ã€‚</p>
<p>æ–°å»º src/model/ModelBase.tsï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">crypto</span> <span class="kr">from</span> <span class="s1">&#39;crypto&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">ModalBase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomUUID</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æš‚æ—¶åªæä¾›äº†ä¸€ä¸ªå…¬å…±å­—æ®µï¼šidï¼Œå‡¡ç»§æ‰¿äº ModelBase çš„å­ç±»éƒ½å°†æ‹¥æœ‰è¿™ä¸ªå­—æ®µï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µæ˜¯éšæ¨¡å‹å®ä¾‹åŒ–çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ã€‚</p>
<p>åªæœ‰ new ModelXXXX æ—¶æ‰ä¼šåˆ›å»ºè¿™ä¸ªå­—æ®µï¼Œlet model = obj as ModelXXXX æ—¶ä¸ä¼šåˆ›å»ºè¿™ä¸ªå­—æ®µã€‚</p>
<p>ä½¿ç”¨ Node.js crypto æ¨¡å—çš„ randomUUID æ–¹æ³•æ¥ç”Ÿæˆæ¯ä¸ªèŠå¤©ä¼šè¯çš„ IDã€‚</p>
<h3 id="ä½¿ç”¨-store">ä½¿ç”¨ Store</h3>
<p>é¦–å…ˆæŠŠæ¨¡å‹ä¸­æ¨¡æ‹Ÿçš„ 10 ä¸ªèŠå¤©ä¼šè¯æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowMain/chat/components/ChatBoard.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ChatList&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ChatSearch</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ListBox&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ChatItem</span> <span class="nt">:data</span><span class="s">=&#34;item&#34;</span> <span class="nt">v-for</span><span class="s">=&#34;item in store.data&#34; :key=&#34;item.id&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">  &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/template&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;script setup lang=&#34;ts&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">import ChatItem from &#39;./ChatItem.vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import ChatSearch from &#39;./ChatSearch.vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { onMounted } from &#39;vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { useChatStore } from &#39;../../../../store/useChatStore&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">const store = useChatStore();
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">onMounted(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="s">  store.selectItem(store.data[6]);
</span></span></span><span class="line"><span class="cl"><span class="s">});
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;style scoped lang=&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">.ChatList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">width</span><span class="o">:</span> <span class="na">250px</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">display</span><span class="o">:</span> <span class="na">flex</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="nt">-direction</span><span class="o">:</span> <span class="na">column</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="na">100</span><span class="err">%;</span>
</span></span><span class="line"><span class="cl">  <span class="na">box</span><span class="nt">-sizing</span><span class="o">:</span> <span class="na">border</span><span class="nt">-box</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.ListBox</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">background</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">230</span><span class="err">,</span> <span class="na">229</span><span class="err">,</span> <span class="na">229</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">  <span class="na">background</span><span class="nt">-image</span><span class="o">:</span> <span class="na">linear</span><span class="nt">-gradient</span><span class="err">(</span><span class="na">to</span> <span class="na">bottom</span> <span class="na">right</span><span class="err">,</span> <span class="na">rgb</span><span class="err">(</span><span class="na">235</span><span class="err">,</span> <span class="na">234</span><span class="err">,</span> <span class="na">233</span><span class="err">),</span> <span class="na">rgb</span><span class="err">(</span><span class="na">240</span><span class="err">,</span> <span class="na">240</span><span class="err">,</span> <span class="na">240</span><span class="err">));</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="o">:</span> <span class="na">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">overflow</span><span class="nt">-y</span><span class="o">:</span> <span class="na">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">box</span><span class="nt">-sizing</span><span class="o">:</span> <span class="na">border</span><span class="nt">-box</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="na">border</span><span class="nt">-right</span><span class="o">:</span> <span class="na">1px</span> <span class="na">solid</span> <span class="na">rgb</span><span class="err">(</span><span class="na">214</span><span class="err">,</span> <span class="na">214</span><span class="err">,</span> <span class="na">214</span><span class="err">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ Vue çš„ v-for æŒ‡ä»¤æ¸²æŸ“äº†ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶åˆ—è¡¨ï¼ˆChatItemï¼‰ã€‚</p>
<p>store å¯¹è±¡æ˜¯é€šè¿‡ useChatStore æ–¹æ³•è·å–çš„ï¼ŒuseChatStore æ–¹æ³•å°±æ˜¯å‰é¢ä»‹ç»çš„ useChatStore.ts å¯¼å‡ºçš„æ–¹æ³•ã€‚å¾—åˆ° store å¯¹è±¡ä¹‹åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ store.data è·å– Store å¯¹è±¡é‡Œçš„æ•°æ®ã€‚</p>
<p>åœ¨å½“å‰ç»„ä»¶ ChatBoard æ¸²æŸ“å®Œæˆåï¼Œè°ƒç”¨äº† store å¯¹è±¡çš„ selectItem æ–¹æ³•ï¼Œé€‰ä¸­äº†ç¬¬ 7 ä¸ªä¼šè¯ã€‚</p>
<p>å…·ä½“æ¯ä¸€ä¸ªèŠå¤©ä¼šè¯å¯¹è±¡æ˜¯é€šè¿‡è‡ªå®šä¹‰ç»„ä»¶çš„ data å±æ€§ä¼ é€’åˆ°ç»„ä»¶å†…éƒ¨çš„ã€‚</p>
<p>ChatItem è‡ªå®šä¹‰ç»„ä»¶çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowMain/chat/components/ChatItem.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="nt">@click</span><span class="s">=&#34;itemClick(data)&#34;</span> <span class="o">:</span><span class="na">class</span><span class="o">=</span><span class="s">&#34;[&#39;ChatItem&#39;, { &#39;ChatItemSelected&#39;: data.isSelected}]&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;avatar&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">img</span> <span class="nt">:src</span><span class="s">=&#34;data.avatar&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ChatInfo&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;FromName&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">fromName</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;TimeName&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">sendTime</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;LastMsg&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;subscribe&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span> <span class="na">setup</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelChat</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../../../../model/ModelChat&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useChatStore</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../../../store/useChatStore&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">defineProps</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="nx">ModelChat</span><span class="p">}</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">useChatStore</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">itemClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span><span class="o">:</span> <span class="nx">ModelChat</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">store</span><span class="p">.</span><span class="nx">selectItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">ChatItem</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">66</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">box</span><span class="o">-</span><span class="nx">sizing</span><span class="o">:</span> <span class="nx">border</span><span class="o">-</span><span class="nx">box</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cursor</span><span class="o">:</span> <span class="nx">pointer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&amp;:</span><span class="nx">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">background</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">221</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">218</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">ChatItemSelected</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">background</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">196</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">&amp;:</span><span class="nx">hover</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">background</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">196</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">avatar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">width</span><span class="o">:</span> <span class="mi">66</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">align</span><span class="o">-</span><span class="nx">items</span><span class="o">:</span> <span class="nx">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">justify</span><span class="o">-</span><span class="nx">content</span><span class="o">:</span> <span class="nx">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span><span class="o">:</span> <span class="mi">46</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span><span class="o">:</span> <span class="mi">46</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">ChatInfo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">66</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">-</span><span class="nx">direction</span><span class="o">:</span> <span class="nx">column</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">justify</span><span class="o">-</span><span class="nx">content</span><span class="o">:</span> <span class="nx">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">row</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">box</span><span class="o">-</span><span class="nx">sizing</span><span class="o">:</span> <span class="nx">border</span><span class="o">-</span><span class="nx">box</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">28</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">line</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">28</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">FromName</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">TimeName</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">right</span><span class="o">:</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">LastMsg</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ defineProps æ–¹æ³•æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„æ•°æ®ã€‚</p>
<p>èŠå¤©ä¼šè¯å¯¹è±¡é‡Œçš„æ•°æ®åœ¨è¿™ä¸ªè‡ªå®šä¹‰ç»„ä»¶ä¸­è¢«å±•å¼€ï¼Œæ¸²æŸ“ç»™ç”¨æˆ·ã€‚</p>
<p>å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªè‡ªå®šä¹‰ç»„ä»¶çš„æ—¶å€™ï¼Œç¨‹åºæ‰§è¡Œäº† Store å¯¹è±¡çš„ selectItem æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£é€‰ä¸­ç”¨æˆ·ç‚¹å‡»çš„ç»„ä»¶ï¼Œæ”¹å˜äº†ç”¨æˆ·ç‚¹å‡»ç»„ä»¶çš„æ ·å¼ï¼ŒåŒæ—¶è¿˜å–æ¶ˆäº†åŸæ¥é€‰ä¸­çš„ç»„ä»¶ã€‚</p>
<h3 id="è®¢é˜…-store">è®¢é˜… Store</h3>
<p>æ— è®ºæ˜¯ç”¨æˆ·ç‚¹å‡» ChatItem ç»„ä»¶é€‰ä¸­ä¸€ä¸ªèŠå¤©ä¼šè¯ï¼Œè¿˜æ˜¯ ChatBoard æ¸²æŸ“å®Œæˆåé€‰ä¸­ä¸€ä¸ªèŠå¤©ä¼šè¯ï¼Œéƒ½åº”è¯¥é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼Œé€‰ä¸­çš„èŠå¤©ä¼šè¯å˜æ›´äº†ã€‚</p>
<p>åœ¨ MessageBoard ç»„ä»¶ä¸­æ¼”ç¤ºè¿™ä¸ªåŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowMain/chat/components/MessageBoard.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageBord&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">BarTop</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageList&#34;</span><span class="p">&gt;{{</span> <span class="nx">logInfo</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span> <span class="na">setup</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ref</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">BarTop</span> <span class="nx">from</span> <span class="s1">&#39;../../../../components/BarTop.vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useChatStore</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../../../store/useChatStore&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">useChatStore</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">logInfo</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">curId</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//è®¢é˜…Storeå†…æ•°æ®çš„å˜åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">store</span><span class="p">.</span><span class="nx">$subscribe</span><span class="p">((</span><span class="nx">mutations</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">isSelected</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">item</span><span class="o">?</span><span class="p">.</span><span class="nx">id</span> <span class="nx">as</span> <span class="nx">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">!=</span> <span class="nx">curId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">logInfo</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="sb">`ç°åœ¨åº”è¯¥åŠ è½½IDä¸º</span><span class="si">${</span><span class="nx">item</span><span class="o">?</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">çš„èŠå¤©è®°å½•`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">curId</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">scoped</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">MessageBord</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">height</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">-</span><span class="nx">direction</span><span class="o">:</span> <span class="nx">column</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">MessageList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">overflow</span><span class="o">-</span><span class="nx">y</span><span class="o">:</span> <span class="nx">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">overflow</span><span class="o">-</span><span class="nx">x</span><span class="o">:</span> <span class="nx">hidden</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">background</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">245</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ store å¯¹è±¡çš„ $subscribe æ–¹æ³•è®¢é˜…äº†æ•°æ®å˜æ›´äº‹ä»¶ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ store å†…çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œéƒ½ä¼šæ‰§è¡Œ $subscribe æ–¹æ³•æä¾›çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>åœ¨è®¢é˜…å›è°ƒä¸­ï¼ŒéªŒè¯é€‰ä¸­çš„ä¼šè¯æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼ˆæœ‰å¯èƒ½æ˜¯å½“å‰ store å…¶ä»–æ•°æ®å¯¹è±¡çš„å˜åŒ–è§¦å‘äº†è®¢é˜…å›è°ƒï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå°±ç»™å‡ºæç¤ºã€‚</p>
<p>è®¢é˜…å›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•° ï¼Œç¬¬ä¸€ä¸ªæ˜¯ mutations å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ events å±æ€§æºå¸¦ç€å˜æ›´å‰çš„å€¼å’Œå˜æ›´åçš„å€¼ï¼Œä½†è¿™ä¸ªå±æ€§åªæœ‰åœ¨å¼€å‘ç¯å¢ƒä¸‹å­˜åœ¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ä¸å­˜åœ¨ã€‚è®¢é˜…çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ stateï¼Œè¿™ä¸ªå‚æ•°åŒ…å« store ä¸­çš„æ•°æ®ã€‚</p>
<p>ä»¥è¿™ç§æ–¹å¼æ›´æ–° store é‡Œçš„æ•°æ®ï¼Œä¸åˆ©äºå¤ç”¨æ•°æ®æ›´æ–°çš„é€»è¾‘ï¼Œæ”¹ç”¨å¯ä»¥å¤ç”¨æ•°æ®æ›´æ–°é€»è¾‘çš„æ–¹æ¡ˆã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_8.png" alt="" width="700" />  
<h3 id="äº’è®¿-store">äº’è®¿ Store</h3>
<p>æ–°å»ºä¸€ä¸ªæ¨¡å‹ç±»ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/model/ModelMessage.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModalBase</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./ModalBase&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">ModelMessage</span> <span class="kr">extends</span> <span class="nx">ModalBase</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">createTime?</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">receiveTime?</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messageContent?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">chatId?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fromName?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">avatar?</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ˜¯å¦ä¸ºä¼ å…¥æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">isInMsg?</span>: <span class="kt">boolean</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»º useMessageStoreï¼Œç”¨äºç®¡ç†æ¶ˆæ¯çš„çŠ¶æ€æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<p>src/renderer/store/useMessageStore.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelChat</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../../model/ModelChat&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelMessage</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../../model/ModelMessage&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineStore</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">Ref</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">useMessageStore</span> <span class="o">=</span> <span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">ModelMessage</span><span class="err">[]</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">([]);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">msg1</span> <span class="o">=</span> <span class="sb">`é†‰é‡ŒæŒ‘ç¯çœ‹å‰‘ï¼Œæ¢¦å›å¹è§’è¿è¥ã€‚å…«ç™¾é‡Œåˆ†éº¾ä¸‹ç¸ï¼Œäº”åå¼¦ç¿»å¡å¤–å£°ã€‚æ²™åœºç§‹ç‚¹å…µã€‚é©¬ä½œçš„å¢é£å¿«ï¼Œå¼“å¦‚éœ¹é›³å¼¦æƒŠã€‚äº†å´å›ç‹å¤©ä¸‹äº‹ï¼Œå¬´å¾—ç”Ÿå‰èº«ååã€‚å¯æ€œç™½å‘ç”Ÿ`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">msg2</span> <span class="o">=</span> <span class="sb">`æ€’å‘å†²å† ï¼Œå‡­æ å¤„ï¼Œæ½‡æ½‡é›¨æ­‡ã€‚æŠ¬æœ›çœ¼ï¼Œä»°å¤©é•¿å•¸ï¼Œå£®æ€€æ¿€çƒˆã€‚ ä¸‰ååŠŸåå°˜ä¸åœŸï¼Œå…«åƒé‡Œè·¯äº‘å’Œæœˆã€‚è«ç­‰é—²ï¼Œç™½äº†å°‘å¹´å¤´ï¼Œç©ºæ‚²åˆ‡ï¼ é–åº·è€»ï¼ŒçŠ¹æœªé›ªï¼›è‡£å­æ¨ï¼Œä½•æ—¶ç­?é©¾é•¿è½¦ï¼Œè¸ç ´è´ºå…°å±±ç¼ºï¼ å£®å¿—é¥¥é¤èƒ¡è™è‚‰ï¼Œç¬‘è°ˆæ¸´é¥®åŒˆå¥´è¡€ã€‚å¾…ä»å¤´ï¼Œæ”¶æ‹¾æ—§å±±æ²³ï¼Œæœå¤©é˜™ï¼`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">initData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chat</span>: <span class="kt">ModelChat</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelMessage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">createTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">isInMsg</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">messageContent</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">isInMsg</span> <span class="o">?</span> <span class="nx">msg1</span> : <span class="kt">msg2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">isInMsg</span> <span class="o">?</span> <span class="nx">chat</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">:</span> <span class="s2">&#34;æˆ‘&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="nx">chat</span><span class="p">.</span><span class="nx">avatar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">model</span><span class="p">.</span><span class="nx">chatId</span> <span class="o">=</span> <span class="nx">chat</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">initData</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¶ˆæ¯æ•°æ®æ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„ï¼Œè¿™é‡Œæ¨¡æ‹Ÿäº† 10 æ¡æ¶ˆæ¯ï¼Œé¢„æœŸç”¨æˆ·åˆ‡æ¢ä¼šè¯çš„æ—¶å€™ï¼Œæ‰§è¡Œ initData æ–¹æ³•ï¼Œåˆå§‹åŒ–å½“å‰ä¼šè¯çš„æ¶ˆæ¯ã€‚</p>
<p>ä¿®æ”¹ä¸€ä¸‹ MessageBoard ç»„ä»¶çš„çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowMain/chat/components/MessageBoard.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageBord&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">BarTop</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageList&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">MessageItem</span> <span class="nt">:data</span><span class="s">=&#34;item&#34;</span> <span class="nt">v-for</span><span class="s">=&#34;item in messageStore.data&#34; :key=&#34;item.id&#34;&gt;&lt;/MessageItem&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">  &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/template&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;script lang=&#34;ts&#34; setup&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">import BarTop from &#39;../../../../components/BarTop.vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { ModelChat } from &#39;../../../../../model/ModelChat&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { useMessageStore } from &#39;../../../../store/useMessageStore&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { useChatStore } from &#39;../../../../store/useChatStore&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import MessageItem from &#39;./MessageItem.vue&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">const chatStore = useChatStore();
</span></span></span><span class="line"><span class="cl"><span class="s">const messageStore = useMessageStore();
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">let curId = &#39;&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">chatStore.$subscribe((mutations, state) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="s">  const item = state.data.find(v =&gt; v.isSelected) as ModelChat;
</span></span></span><span class="line"><span class="cl"><span class="s">  if (item?.id !== curId) {
</span></span></span><span class="line"><span class="cl"><span class="s">    messageStore.initData(item);
</span></span></span><span class="line"><span class="cl"><span class="s">    curId = item?.id;
</span></span></span><span class="line"><span class="cl"><span class="s">  }
</span></span></span><span class="line"><span class="cl"><span class="s">})
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;/script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">&lt;style scoped lang=&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">.MessageBord</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">:</span> <span class="na">100</span><span class="err">%;</span>
</span></span><span class="line"><span class="cl">  <span class="na">display</span><span class="o">:</span> <span class="na">flex</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="o">:</span> <span class="na">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="nt">-direction</span><span class="o">:</span> <span class="na">column</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.MessageList</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">flex</span><span class="o">:</span> <span class="na">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">overflow</span><span class="nt">-y</span><span class="o">:</span> <span class="na">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">overflow</span><span class="nt">-x</span><span class="o">:</span> <span class="na">hidden</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">background</span><span class="o">:</span> <span class="na">rgb</span><span class="err">(</span><span class="na">245</span><span class="err">,</span> <span class="na">245</span><span class="err">,</span> <span class="na">245</span><span class="err">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“é€‰ä¸­çš„èŠå¤©ä¼šè¯åˆ‡æ¢æ—¶ï¼Œæ‰§è¡Œ messageStore å¯¹è±¡çš„ initData æ–¹æ³•ï¼Œè¿™æ ·å°±åˆå§‹åŒ–äº† messageStore å†…éƒ¨çš„çŠ¶æ€æ•°æ®ã€‚</p>
<p>MessageItem æ˜¯æ–°åˆ›å»ºçš„ä¸€ä¸ª Vue ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ç”¨äºæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯çš„å…·ä½“ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/window/WindowMain/chat/components/MessageItem.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">template</span> <span class="nt">v-if</span><span class="s">=&#34;data.isInMsg&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageItem left&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;avatar&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">img</span> <span class="nt">:src</span><span class="s">=&#34;data.avatar&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageBox&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;FromName&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">fromName</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MsgContent&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">messageContent</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">template</span> <span class="nt">v-else</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageItem right&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageBox&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;MessageContent&#34;</span><span class="p">&gt;{{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">messageContent</span> <span class="p">}}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;avatar&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">img</span> <span class="nt">:src</span><span class="s">=&#34;data.avatar&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">setup</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelMessage</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../../../../model/ModelMessage&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">defineProps</span><span class="o">&lt;</span><span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">ModelMessage</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">MessageItem</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">display</span><span class="o">:</span> <span class="nx">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">position</span><span class="o">:</span> <span class="nx">relative</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">left</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">right</span><span class="o">:</span> <span class="mi">30</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&amp;::</span><span class="nx">after</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">right</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="err">#</span><span class="nx">fff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">left</span><span class="o">:</span> <span class="mi">60</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">top</span><span class="o">:</span> <span class="mi">38</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="mi">30</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&amp;::</span><span class="nx">after</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">border</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">149</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">105</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">right</span><span class="o">:</span> <span class="mi">60</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">top</span><span class="o">:</span> <span class="mi">18</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span><span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">MessageContent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">background</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">149</span><span class="p">,</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span> <span class="o">!</span><span class="nx">important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">avatar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">width</span><span class="o">:</span> <span class="mi">66</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">text</span><span class="o">-</span><span class="nx">align</span><span class="o">:</span> <span class="nx">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span><span class="o">:</span> <span class="mi">46</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span><span class="o">:</span> <span class="mi">46</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">MessageBox</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">FromName</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span><span class="o">:</span> <span class="nx">rgb</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">178</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">6</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">MessageContent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">background</span><span class="o">:</span> <span class="err">#</span><span class="nx">fff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">border</span><span class="o">-</span><span class="nx">radius</span><span class="o">:</span> <span class="mi">3</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">padding</span><span class="o">:</span> <span class="mi">8</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">line</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">22</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åˆ‡æ¢é€‰ä¸­çš„èŠå¤©ä¼šè¯æ—¶ï¼Œç›´æ¥åˆå§‹åŒ– messageStore é‡Œçš„æ•°æ®ï¼Œå°±å®Œå…¨ä¸éœ€è¦åœ¨ MessageBord ç»„ä»¶é‡Œè®¢é˜… chatStore çš„æ•°æ®å˜æ›´äº†ã€‚</p>
<p>pinia æ˜¯æ”¯æŒè¿™ç§æ“ä½œçš„ï¼Œç°åœ¨ä¿®æ”¹ä¸€ä¸‹useChatStoreçš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineStore</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;pinia&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Ref</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ModelChat</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;../../model/ModelChat&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useMessageStore</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./useMessageStore&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// mock data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">prepareData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelChat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s1">&#39;èŠå¤©å¯¹è±¡&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">sendTime</span> <span class="o">=</span> <span class="s1">&#39;æ˜¨å¤©&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="o">=</span> <span class="s1">&#39;è¿™æ˜¯æ­¤ä¼šè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="s1">&#39;https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">useChatStore</span> <span class="o">=</span> <span class="nx">defineStore</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">ModelChat</span><span class="err">[]</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="nx">prepareData</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">selectItem</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span>: <span class="kt">ModelChat</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">isSelected</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">item</span><span class="p">.</span><span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">messageStore</span> <span class="o">=</span> <span class="nx">useMessageStore</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">messageStore</span><span class="p">.</span><span class="nx">initData</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">selectItem</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ selectItem æ–¹æ³•å†…ä½¿ç”¨ messageStore æä¾›çš„æ–¹æ³•ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_9.png" alt="" width="700" />  
<h2 id="å®¢æˆ·ç«¯æ•°æ®åº“">å®¢æˆ·ç«¯æ•°æ®åº“</h2>
<p>å¦‚ä½•æŠŠåº”ç”¨å†…çš„ä¸šåŠ¡æ•°æ®æŒä¹…åŒ–åˆ°ç”¨æˆ·æœ¬åœ°ç£ç›˜ä¸Šã€‚</p>
<p>å¯¹äºç®€å•çš„æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥æŠŠå®ƒä»¬å­˜å‚¨åœ¨ localStorage ä¸­ï¼Œè¿™äº›æ•°æ®æ˜¯æŒä¹…åŒ–åœ¨ç”¨æˆ·ç£ç›˜ä¸Šçš„ï¼Œä¸ä¼šå› ä¸ºç”¨æˆ·é‡å¯åº”ç”¨æˆ–è€…é‡è£…åº”ç”¨è€Œä¸¢å¤±ã€‚</p>
<p>å¯¹äºç¨å¾®å¤æ‚çš„æ•°æ®ç±»å‹æ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œå…¶ä¸€æ˜¯æŠŠè¿™ç±»æ•°æ®å­˜å‚¨åœ¨ IndexedDB ä¸­ï¼Œä¸ localStorage ç±»ä¼¼ï¼Œè¿™ä¹Ÿæ˜¯è°·æ­Œæµè§ˆå™¨æ ¸å¿ƒæä¾›çš„æ•°æ®æŒä¹…åŒ–å·¥å…·ï¼Œå®ƒä»¥ JSON å¯¹è±¡çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ•°æ®è¾ƒå¤šæ—¶ï¼Œå¤æ‚çš„æ¡ä»¶æŸ¥è¯¢æ•ˆç‡ä¸ä½³ã€‚</p>
<p>ç¬¬äºŒä¸ªé€‰æ‹©å°±æ˜¯æŠŠæ•°æ®å­˜å‚¨åœ¨ SQLite ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œå¤©ç”Ÿå¯¹å¤æ‚æ¡ä»¶æŸ¥è¯¢æ”¯æŒè‰¯å¥½ã€‚</p>
<h3 id="å®‰è£…-sqlite">å®‰è£… SQLite</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install better-sqlite3 -D  
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæ¨¡å—å®‰è£…å®Œæˆåï¼Œå¤§æ¦‚ç‡æ˜¯æ— æ³•ä½¿ç”¨è¿™ä¸ªæ¨¡å—çš„ï¼Œå¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Error: The module <span class="s1">&#39;...node_modules\better-sqlite3\build\Release\better_sqlite3.node&#39;</span>
</span></span><span class="line"><span class="cl">was compiled against a different Node.js version using
</span></span><span class="line"><span class="cl">NODE_MODULE_VERSION <span class="nv">$XYZ</span>. This version of Node.js requires
</span></span><span class="line"><span class="cl">NODE_MODULE_VERSION <span class="nv">$ABC</span>. Please try re-compiling or re-installing
</span></span><span class="line"><span class="cl">the module <span class="o">(</span><span class="k">for</span> instance, using <span class="sb">`</span>npm rebuild<span class="sb">`</span> or <span class="sb">`</span>npm install<span class="sb">`</span><span class="o">)</span>.
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯å› ä¸º Electron å†…ç½®çš„ Node.js çš„ç‰ˆæœ¬å¯èƒ½ä¸ä½ ç¼–è¯‘åŸç”Ÿæ¨¡å—ä½¿ç”¨çš„ Node.js çš„ç‰ˆæœ¬ä¸åŒå¯¼è‡´çš„ã€‚</p>
<p>å»ºè®®å¼€å‘è€…ä½¿ç”¨ Electron å›¢é˜Ÿæä¾›çš„ electron-rebuild å·¥å…·æ¥å®Œæˆæ­¤å·¥ä½œï¼Œå› ä¸º electron-rebuild ä¼šç¡®å®š Electron çš„ç‰ˆæœ¬å·ã€Electron å†…ç½®çš„ Node.js çš„ç‰ˆæœ¬å·ã€ä»¥åŠ Node.js ä½¿ç”¨çš„ ABI çš„ç‰ˆæœ¬å·ï¼Œå¹¶æ ¹æ®è¿™äº›ç‰ˆæœ¬å·ä¸‹è½½ä¸åŒçš„å¤´æ–‡ä»¶å’Œç±»åº“ã€‚</p>
<p>å®‰è£… electron-rebuildï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install electron-rebuild -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ package.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®èŠ‚ï¼ˆscriptsé…ç½®èŠ‚ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;rebuild&#34;: &#34;electron-rebuild -f -w better-sqlite3&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm run rebuild
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ä½ çš„å·¥ç¨‹ä¸‹å‡ºç°äº†è¿™ä¸ªæ–‡ä»¶ node_modules/better-sqlite3/build/Release/better_sqlite3.nodeï¼Œæ‰è¯æ˜ better_sqlite3 æ¨¡å—ç¼–è¯‘æˆåŠŸäº†ï¼Œå¦‚æœä¸Šè¿°æŒ‡ä»¤æ²¡æœ‰å¸®ä½ å®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½ å¯ä»¥æŠŠæŒ‡ä»¤é…ç½®åˆ° node_modules/better-sqlite3 æ¨¡å—å†…éƒ¨å†æ‰§è¡Œä¸€æ¬¡ï¼Œä¸€èˆ¬å°±å¯ä»¥ç¼–è¯‘æˆåŠŸäº†ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_10.png" alt="" width="700" />  
<p>è¿™æ ·å°±ä¸º Electron é‡æ–°ç¼–è¯‘äº†ä¸€é better-sqlite3ï¼Œç°åœ¨å°±å¯ä»¥åœ¨ Electron åº”ç”¨å†…ä½¿ç”¨ better-sqlite3 æä¾›çš„ API äº†ã€‚</p>
<p>åœ¨åº”ç”¨ä¸­è¯•è¯•å¦‚ä¸‹ä»£ç ï¼ˆæ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹å‡å¯ï¼Œç”šè‡³åœ¨æ¸²æŸ“è¿›ç¨‹çš„å¼€å‘è€…è°ƒè¯•å·¥å…·ä¸­ä¹Ÿæ²¡é—®é¢˜ï¼‰ï¼Œçœ‹æ˜¯ä¸æ˜¯å¯ä»¥æ­£ç¡®åˆ›å»º SQLite çš„æ•°æ®åº“ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">const Database = require(&#34;better-sqlite3&#34;);
</span></span><span class="line"><span class="cl">const db = new Database(&#34;db.db&#34;, { verbose: console.log, nativeBinding: &#34;./node_modules/better-sqlite3/build/Release/better_sqlite3.node&#34; });
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œå·¥ç¨‹æ ¹ç›®å½•ä¸‹å°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º db.db çš„ SQLite æ•°æ®åº“æ–‡ä»¶ï¼Œè¯´æ˜ better-sqlite3 åº“å·²ç»ç”Ÿæ•ˆäº†ã€‚</p>
<h3 id="å‹ç¼©å®‰è£…åŒ…ä½“ç§¯">å‹ç¼©å®‰è£…åŒ…ä½“ç§¯</h3>
<p>better-sqlite3 æ˜¯ä¸€ä¸ªåŸç”Ÿæ¨¡å—ï¼ŒåŸç”Ÿæ¨¡å—æ˜¯æ— æ³•è¢« vite ç¼–è¯‘åˆ° JavaScript çš„ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦æŠŠå®ƒå®‰è£…æˆå¼€å‘ä¾èµ–å‘¢ï¼Ÿ</p>
<p>æŠŠ better-sqlite3 å®‰è£…æˆå¼€å‘ä¾èµ–ï¼Œåœ¨åŠŸèƒ½ä¸Šæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œelectron-builder åœ¨åˆ¶ä½œå®‰è£…åŒ…æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸ºå®‰è£…åŒ…é™„åŠ è¿™ä¸ªä¾èµ–ï¼ˆbetter-sqlite3 è¿™ä¸ªåº“è‡ªå·±çš„ä¾èµ–ä¹Ÿä¼šè¢«æ­£ç¡®é™„åŠ åˆ°å®‰è£…åŒ…å†…ï¼‰ã€‚</p>
<p>ä½†electron-builder ä¼šæŠŠå¾ˆå¤šæ— ç”¨çš„æ–‡ä»¶ï¼ˆå¾ˆå¤šç¼–è¯‘åŸç”Ÿæ¨¡å—æ—¶çš„ä¸­é—´äº§ç‰©ï¼‰ä¹Ÿé™„åŠ åˆ°å®‰è£…åŒ…å†…ã€‚æ— å½¢ä¸­å¢åŠ äº†å®‰è£…åŒ…çš„ä½“ç§¯ï¼ˆå¤§æ¦‚ 10Mï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_11.png" alt="" width="700" />  
<p>åœ¨ plugins/buildPlugin.ts ä¸­å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">prepareSqlite() {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ‹·è´ better-sqlite3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">srcDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;node_modules/better-sqlite3&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">destDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/better-sqlite3&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">ensureDirSync</span><span class="p">(</span><span class="nx">destDir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">copySync</span><span class="p">(</span><span class="nx">srcDir</span><span class="p">,</span> <span class="nx">destDir</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filter</span><span class="o">:</span> <span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;better-sqlite3&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">src</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">src</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;Release&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">src</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">&#39;better_sqlite3.node&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;node_modules\\better-sqlite3\\lib&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">pkgJson</span> <span class="o">=</span> <span class="s1">&#39;{&#34;name&#34;: &#34;better-sqlite3&#34;,&#34;main&#34;: &#34;lib/index.js&#34;}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">pkgJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/better-sqlite3/package.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">pkgJsonPath</span><span class="p">,</span> <span class="nx">pkgJson</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ¶ä½œbindingsæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">bindingPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/bindings/index.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">ensureDirSync</span><span class="p">(</span><span class="nx">bindingPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">bindingsContent</span> <span class="o">=</span> <span class="sb">`module.exports = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="sb">      let addonPath = require(&#34;path&#34;).join(__dirname, &#39;../better-sqlite3/build/Release/better_sqlite3.node&#39;);
</span></span></span><span class="line"><span class="cl"><span class="sb">      return require(addonPath);
</span></span></span><span class="line"><span class="cl"><span class="sb">    };`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">bindingPath</span><span class="p">,</span> <span class="nx">bindingsContent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pkgJson</span> <span class="o">=</span> <span class="s1">&#39;{&#34;name&#34;: &#34;bindings&#34;,&#34;main&#34;: &#34;index.js&#34;}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pkgJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/bindings/package.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">pkgJsonPath</span><span class="p">,</span> <span class="nx">pkgJson</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µä»£ç ä¸»è¦åšäº†ä¸¤ä¸ªå·¥ä½œï¼š</p>
<ul>
<li>æŠŠå¼€å‘ç¯å¢ƒçš„ node_modules/better-sqlite3 ç›®å½•ä¸‹æœ‰ç”¨çš„æ–‡ä»¶æ‹·è´åˆ° dist/node_modules/better-sqlite3 ç›®å½•ä¸‹ï¼Œå¹¶ä¸ºè¿™ä¸ªæ¨¡å—è‡ªåˆ¶äº†ä¸€ä¸ªç®€å•çš„ package.jsonã€‚</li>
<li>å®Œå…¨è‡ªå·±åˆ¶ä½œäº†ä¸€ä¸ª bindings æ¨¡å—ï¼ŒæŠŠè¿™ä¸ªæ¨¡å—æ”¾ç½®åœ¨ dist/node_modules/bindings ç›®å½•ä¸‹ã€‚</li>
<li>closeBundle é’©å­å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼šbuildObj.prepareSqlite()ã€‚</li>
</ul>
<p>è¿™é‡Œ bindings æ¨¡å—æ˜¯ better-sqlite3 æ¨¡å—ä¾èµ–çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒçš„ä½œç”¨ä»…ä»…æ˜¯ç¡®å®šåŸç”Ÿæ¨¡å—æ–‡ä»¶ better_sqlite3.node çš„è·¯å¾„ã€‚</p>
<p>æ¥ä¸‹æ¥å†ä¿®æ”¹ä¸€ä¸‹ BuildObjçš„preparePackageJson æ–¹æ³•ï¼Œåœ¨ç”Ÿæˆ package.json æ–‡ä»¶ä¹‹å‰ï¼Œä¸ºå…¶é™„åŠ ä¸¤ä¸ªç”Ÿäº§ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">dependencies</span><span class="p">[</span><span class="s1">&#39;better-sqlite3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">dependencies</span><span class="p">[</span><span class="s1">&#39;bindings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™ä¸¤ä¸ªé…ç½®ï¼Œelectron-builder å°±ä¸ä¼šè‡ªåŠ¨å®‰è£…è¿™äº›æ¨¡å—äº†ã€‚</p>
<p>å®Œæˆè¿™äº›å·¥ä½œåï¼Œåœ¨ closeBundle é’©å­å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š buildObj.prepareSqlite()ï¼Œå†æ‰“åŒ…çœ‹çœ‹ï¼Œå®‰è£…åŒ…çš„ä½“ç§¯æ˜¯å¦å˜å°äº†å‘¢ï¼Ÿ</p>
<h3 id="å®‰è£…-knexjs">å®‰è£… Knex.js</h3>
<p>æˆåŠŸå¼•å…¥ better-sqlite3 å¹¶ä¸”å‹ç¼©äº† better-sqlite3 æ¨¡å—åœ¨å®‰è£…åŒ…çš„ä½“ç§¯åï¼Œé¢ä¸´ç€å¦ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚</p>
<p>ä½¿ç”¨ better-sqlite3 è¯»å†™æ•°æ®åº“ä¸­çš„æ•°æ®æ—¶ï¼Œè¦ä¹¦å†™ SQL è¯­å¥ï¼Œè¿™ç§è¯­å¥æ˜¯ä¸“é—¨ä¸ºæ•°æ®åº“å‡†å¤‡çš„æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯ä¸º sqlite æ•°æ®åº“å»ºè¡¨å’Œåœ¨å¯¹åº”è¡¨ä¸­å®Œæˆå¢åˆ æ”¹æŸ¥çš„ SQL è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">create table admin(username text,age integer);
</span></span><span class="line"><span class="cl">insert into admin values(&#39;allen&#39;,18);
</span></span><span class="line"><span class="cl">select * from admin;
</span></span><span class="line"><span class="cl">update admin set username=&#39;allen001&#39;,age=88 where username=&#39;allen&#39; and age=18;
</span></span><span class="line"><span class="cl">delete from admin where username=&#39;allen001&#39;;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ Knex.js å¯ä»¥æ¥å®Œæˆå¯¹åº”çš„æ“ä½œï¼ŒKnex.js å…è®¸ä½¿ç”¨ JavaScript ä»£ç æ¥æ“ä½œæ•°æ®åº“é‡Œçš„æ•°æ®å’Œè¡¨ç»“æ„ï¼Œå®ƒä¼šæŠŠ JavaScript ä»£ç è½¬ä¹‰æˆå…·ä½“çš„ SQL è¯­å¥ï¼Œå†æŠŠ SQL è¯­å¥äº¤ç»™æ•°æ®åº“å¤„ç†ï¼Œå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ç§ SQL Builderã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install knex -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…ä¹‹å‰ç¼–è¯‘è¿™ä¸ªåº“ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>plugins/buildPlugin.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">prepareKnex() {</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">pkgJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/knex&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">ensureDirSync</span><span class="p">(</span><span class="nx">pkgJsonPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;esbuild&#39;</span><span class="p">).</span><span class="nx">buildSync</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">entryPoints</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./node_modules/knex/knex.js&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bundle</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">platform</span><span class="o">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;cjs&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">minify</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">outfile</span><span class="o">:</span> <span class="s1">&#39;./dist/node_modules/knex/index.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">external</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;oracledb&#39;</span><span class="p">,</span> <span class="s1">&#39;pg-query-stream&#39;</span><span class="p">,</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;tedious&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql2&#39;</span><span class="p">,</span> <span class="s1">&#39;better-sqlite3&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">pkgJson</span> <span class="o">=</span> <span class="sb">`{&#34;name&#34;: &#34;bindings&#34;,&#34;main&#34;: &#34;index.js&#34;}`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pkgJsonPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;node_modules/knex/package.json&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">pkgJsonPath</span><span class="p">,</span> <span class="nx">pkgJson</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›¸å¯¹äºå‹ç¼© better-sqlite3 çš„ä½“ç§¯æ¥è¯´ï¼Œå‹ç¼© Knex.js åŒ…çš„ä½“ç§¯å°±ç®€å•å¤šäº†ï¼Œä»…ä»…æ˜¯é€šè¿‡ esbuild å·¥å…·ç¼–è¯‘äº†ä¸€ä¸‹è¿™ä¸ªåŒ…çš„ä»£ç å°±å®Œæˆäº†å·¥ä½œã€‚</p>
<p>è¿™æ®µä»£ç æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ã€‚</p>
<ul>
<li>é…ç½®é¡¹ external æ˜¯ä¸ºäº†é¿å…ç¼–è¯‘è¿‡ç¨‹ä¸­ esbuild å»å¯»æ‰¾è¿™äº›æ¨¡å—è€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¯´ Knex.js ä¸­è¿™æ ·çš„ä»£ç ä¼šä¿æŒåŸæ ·è¾“å‡ºåˆ°ç¼–è¯‘äº§ç‰©ä¸­ï¼š require(&lsquo;better-sqlite3&rsquo;)ã€‚</li>
<li>package.json å¢åŠ ä¸€ä¸ªç”Ÿäº§ä¾èµ–ï¼šlocalPkgJson.dependencies[&lsquo;knex&rsquo;] = &lsquo;*&rsquo;;ï¼Œä»¥é¿å… electron-builder å®‰è£… Knex.js æ¨¡å—ã€‚</li>
<li>closeBundle é’©å­å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼šbuildObj.prepareKnex()ã€‚</li>
</ul>
<h3 id="è®¿é—®æ•°æ®åº“">è®¿é—®æ•°æ®åº“</h3>
<p>æ–°å»ºæ•°æ®åº“ dbï¼Œæ•°æ®åº“ä¸­æœ‰ä¸¤å¼ è¡¨ Message å’Œ Chatï¼Œæˆªå›¾æ˜¯ Chat è¡¨çš„åˆ—ï¼š</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_12.png" alt="" width="700" />  
<p>æ•°æ®åº“è®¾è®¡å¥½ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è®¿é—®ç±»ï¼Œç”±äºä¸»è¿›ç¨‹çš„é€»è¾‘å’Œæ¸²æŸ“è¿›ç¨‹çš„é€»è¾‘éƒ½æœ‰å¯èƒ½ä¼šè®¿é—®æ•°æ®åº“ï¼Œæ‰€ä»¥æŠŠæ•°æ®åº“è®¿é—®ç±»æ”¾ç½®åœ¨ src/common ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä¸¤ä¸ªè¿›ç¨‹çš„é€»è¾‘ä»£ç ä½¿ç”¨è¿™ä¸ªç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<p>src/common/db.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">knex</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Knex</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;knex&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">fs</span> <span class="kr">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">dbInstance</span>: <span class="kt">Knex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// @ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dbInstance</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">dbPath</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APPDATA</span> <span class="o">||</span> <span class="sb">`</span><span class="si">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="si">}${</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s1">&#39;darwin&#39;</span> <span class="o">?</span> <span class="s1">&#39;/Library/Preferences&#39;</span> <span class="o">:</span> <span class="s1">&#39;/.local/share&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dbPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">,</span> <span class="s1">&#39;Electron&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">dbIsExist</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dbIsExist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">resourceDbPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span><span class="p">,</span> <span class="s1">&#39;../resources/db.db&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">copyFileSync</span><span class="p">(</span><span class="nx">resourceDbPath</span><span class="p">,</span> <span class="nx">dbPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dbInstance</span> <span class="o">=</span> <span class="nx">knex</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">client</span><span class="o">:</span> <span class="s1">&#39;better-sqlite3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">connection</span><span class="o">:</span> <span class="p">{</span> <span class="nx">filename</span>: <span class="kt">dbPath</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useNullAsDefault</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">let</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">dbInstance</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“è®¿é—®å¯¹è±¡ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡å¼•å…¥è¿™ä¸ªæ•°æ®åº“è®¿é—®å¯¹è±¡çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ­¤å¯¹è±¡çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæ— è®ºåœ¨å¤šå°‘ä¸ªç»„ä»¶ä¸­å¼•å…¥è¿™ä¸ªæ•°æ®åº“è®¿é—®å¯¹è±¡ï¼Œå®ƒåªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä½†è¿™ä¸ªçº¦æŸåªå±€é™åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ•´ä¸ªåº”ç”¨è€Œè¨€ï¼Œä¸»è¿›ç¨‹æœ‰ä¸€ä¸ª db å®ä¾‹ï¼Œæ¸²æŸ“è¿›ç¨‹ä¹Ÿæœ‰ä¸€ä¸ª db å®ä¾‹ï¼Œä¸¤ä¸ªå®ä¾‹æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>
<p>ç”±äºæ¸²æŸ“è¿›ç¨‹å†…çš„æ•°æ®åº“è®¿é—®å¯¹è±¡å’Œä¸»è¿›ç¨‹å†…çš„æ•°æ®åº“è®¿é—®å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¼šæœ‰å¹¶å‘å†™å…¥æ•°æ®çš„é—®é¢˜ï¼Œéœ€è¦æ§åˆ¶å¥½ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼Œé¿å…ä¸¤ä¸ªè¿›ç¨‹åœ¨åŒä¸€æ—¶é—´å†™å…¥ç›¸åŒçš„ä¸šåŠ¡æ•°æ®ã€‚</p>
<p>SQLite ä¸æ”¯æŒå¹¶å‘å†™å…¥æ•°æ®ï¼Œä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å†™å…¥æ“ä½œåŒæ—¶æ‰§è¡Œæ—¶ï¼Œåªæœ‰ä¸€ä¸ªå†™æ“ä½œå¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œå…¶ä»–å†™æ“ä½œä¼šå¤±è´¥ã€‚å¹¶å‘è¯»å–æ•°æ®æ²¡æœ‰é—®é¢˜ã€‚</p>
<p>ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ•°æ®åº“é“¾æ¥å¯¹è±¡æ—¶ï¼Œä¼šæ£€æŸ¥ MacintoshHD/ç”¨æˆ·/[yourOsUserName]/èµ„æºåº“/ApplicationSupport/[yourAppName]/db.db æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä»åº”ç”¨ç¨‹åºå®‰è£…ç›®å½• MacintoshHD/ç”¨æˆ·/[yourOsUserName]/èµ„æºåº“/ApplicationSupport/[yourAppName]/resources/db.db æ‹·è´ä¸€ä»½åˆ°è¯¥è·¯å¾„ä¸‹ï¼Œæ‰€ä»¥è¦æå‰æŠŠæ•°æ®åº“è®¾è®¡å¥½ï¼ŒåŸºç¡€æ•°æ®ä¹Ÿè¦åˆå§‹åŒ–å¥½ï¼Œåˆ¶ä½œå®‰è£…åŒ…çš„æ—¶å€™ï¼ŒæŠŠæ•°æ®åº“æ–‡ä»¶æ‰“åŒ…åˆ°å®‰è£…åŒ…é‡Œã€‚</p>
<p>é€šè¿‡ä¸º plugins/buildPlugin.ts å¢åŠ é…ç½®æ¥æŠŠæ•°æ®åº“æ–‡ä»¶æ‰“åŒ…åˆ°å®‰è£…åŒ…å†…çš„ï¼Œå…¶ä¸­å…³é”®çš„é…ç½®ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// buildInstaller æ–¹æ³•å†… option.config çš„ä¸€ä¸ªå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">extraResources</span><span class="o">:</span> <span class="p">[{</span> <span class="kr">from</span><span class="o">:</span> <span class="sb">`./src/common/db.db`</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="sb">`./`</span> <span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>extraResources å¯ä»¥è®©å¼€å‘è€…ä¸ºå®‰è£…åŒ…æŒ‡å®šé¢å¤–çš„èµ„æºæ–‡ä»¶ï¼Œelectron-builder æ‰“åŒ…åº”ç”¨æ—¶ä¼šæŠŠè¿™äº›èµ„æºæ–‡ä»¶é™„åŠ åˆ°å®‰è£…åŒ…å†…ï¼Œå½“ç”¨æˆ·å®‰è£…åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿™äº›èµ„æºä¼šé‡Šæ”¾åœ¨å®‰è£…ç›®å½•çš„ resources/å­ç›®å½•ä¸‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦æŠŠæ•°æ®åº“æ–‡ä»¶æ‹·è´å†è®¿é—®ï¼Œä¸ç›´æ¥è®¿é—®å®‰è£…ç›®å½•ä¸‹çš„æ•°æ®åº“æ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>å› ä¸ºå½“ç”¨æˆ·å‡çº§åº”ç”¨ç¨‹åºæ—¶å®‰è£…ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºå¯èƒ½ä¼šåœ¨æ•°æ®åº“ä¸­æ”¾ç½®å¾ˆå¤šç”¨æˆ·æ•°æ®ï¼Œè¿™æ ·çš„è¯æ¯æ¬¡å‡çº§åº”ç”¨ç”¨æˆ·è¿™äº›æ•°æ®å°±éƒ½æ²¡äº†ã€‚</p>
<p>å‡å®šæ•°æ®åº“æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ²¡æœ‰å®ƒï¼Œæ•°æ®åº“åº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥åˆå§‹åŒ–æ•°æ®åº“çš„é€»è¾‘éƒ½æ˜¯åŒæ­¥æ“ä½œï¼ˆfs.copyFileSyncï¼‰ï¼Œæ³¨æ„è¿™ç±»ä»¥ Sync ç»“å°¾çš„æ–¹æ³•éƒ½æ˜¯åŒæ­¥æ“ä½œï¼Œå®ƒä»¬æ˜¯ä¼šé˜»å¡ JavaScript çš„æ‰§è¡Œçº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®ƒä»¬æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–ä»»ä½•æ“ä½œéƒ½ä¼šå¤„äºé˜»å¡çŠ¶æ€ã€‚</p>
<p>åœ¨åº”ç”¨ç¨‹åºå¼€å‘è°ƒè¯•é˜¶æ®µï¼Œå¼€å‘è€…å¯ä»¥å…ˆæŠŠè®¾è®¡å¥½çš„æ•°æ®åº“æ–‡ä»¶æ”¾ç½®åœ¨ç›®æ ‡è·¯å¾„ MacintoshHD/ç”¨æˆ·/[yourOsUserName]/èµ„æºåº“/ApplicationSupport/[yourAppName] ä¸‹ã€‚</p>
<p>db.ts æ–‡ä»¶å¯¼å‡ºçš„æ˜¯ä¸€ä¸ª Knex ç±»å‹çš„å¯¹è±¡ï¼Œåˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œé…ç½®å¯¹è±¡çš„ client å±æ€§ä»£è¡¨ç€ä½¿ç”¨ä»€ä¹ˆæ¨¡å—è®¿é—®æ•°æ®åº“ï¼Œè¿™é‡Œè¦æ±‚ Knex ä½¿ç”¨ better-sqlite3 è®¿é—®æ•°æ®åº“ï¼ŒKnex æ”¯æŒå¾ˆå¤šæ•°æ®åº“ï¼Œæ¯”å¦‚ MySqlã€Oracleã€SqlServer ç­‰ï¼Œéƒ½æœ‰å¯¹åº”çš„æ•°æ®åº“è®¿é—®æ¨¡å—ã€‚</p>
<p>ç”±äº SQLite æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯æ•°æ®åº“ï¼Œæ‰€ä»¥åªè¦æŠŠæ•°æ®åº“çš„æœ¬åœ°è·¯å¾„å‘ŠçŸ¥ Knex å³å¯ï¼Œè¿™ä¸ªå±æ€§æ˜¯é€šè¿‡é…ç½®å¯¹è±¡çš„ connection å±æ€§æä¾›çš„ã€‚é…ç½®å¯¹è±¡çš„ useNullAsDefault å±æ€§å‘ŠçŸ¥ Knex æŠŠå¼€å‘è€…æœªæ˜ç¡®æä¾›çš„æ•°æ®é…ç½®ä¸º Nullã€‚</p>
<p>æ¥ä¸‹æ¥å°è¯•ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“è®¿é—®å¯¹è±¡æŠŠ Chat è¡¨çš„æ•°æ®æ£€ç´¢å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>src/renderer/main.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">db</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;../common/db&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">first</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">obj</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ dbï¼Œæ¥ç€ä½¿ç”¨è¿™ä¸ªå¯¹è±¡è¯»å– Chat è¡¨é‡Œçš„ç¬¬ä¸€è¡Œè®°å½•ï¼Œæ•°æ®è¯»å–æˆåŠŸåæŠŠè¿™è¡Œæ•°æ®æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<h3 id="æ•°æ®åº“åŸºæœ¬æ“ä½œ">æ•°æ®åº“åŸºæœ¬æ“ä½œ</h3>
<h4 id="å¢åŠ æ•°æ®">å¢åŠ æ•°æ®</h4>
<p>å¢åŠ ä¸€æ¡æ•°æ®ï¼š</p>
<p>src/renderer/window/WindowMain/Contact.vue</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">insertData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelChat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s2">&#34;èŠå¤©å¯¹è±¡&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="p">.</span><span class="nx">sendTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="o">=</span> <span class="s2">&#34;è¿™æ˜¯æ­¤ä¼šè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="sb">`https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">insert</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦åœ¨åŒä¸€å¼ è¡¨ä¸­å¢åŠ å¤šè¡Œæ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªæ•°ç»„æäº¤ç»™æ•°æ®åº“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">insertMultiData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelChat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s2">&#34;èŠå¤©å¯¹è±¡&#34;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">sendTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="o">=</span> <span class="s2">&#34;è¿™æ˜¯æ­¤ä¼šè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯&#34;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">model</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="sb">`https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">result</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="nx">isSelected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">insert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">selectData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">where</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="sb">`256d6532-fcfe-4b81-a3f8-ee940f2de3e3`</span> <span class="p">}).</span><span class="nx">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¿®æ”¹æ•°æ®">ä¿®æ”¹æ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">updateData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">update</span><span class="p">({</span> <span class="nx">fromName</span><span class="o">:</span> <span class="s2">&#34;ä¸‰å²›ç”±çºªå¤«&#34;</span><span class="p">,</span> <span class="nx">lastMsg</span><span class="o">:</span> <span class="s2">&#34;å°±åœ¨åˆ€åˆƒçŒ›ç„¶åˆºå…¥è…¹éƒ¨çš„ç¬é—´ï¼Œä¸€è½®çº¢æ—¥åœ¨çœ¼ç‘èƒŒé¢ç²²ç„¶å‡äº†ä¸Šæ¥ã€‚&#34;</span> <span class="p">}).</span><span class="nx">where</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="sb">`256d6532-fcfe-4b81-a3f8-ee940f2de3e3`</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦ä½¿ç”¨ where æ–¹æ³•ç¡®å®šæ›´æ–°èŒƒå›´ï¼Œä¸ç„¶æ•´ä¸ªè¡¨çš„æ•°æ®éƒ½å°†è¢«ä¿®æ”¹ (æ•°æ®åº“æ“ä½œè¿”å›çš„å€¼ data ä¸ºå—å½±å“çš„è¡Œæ•°)  ã€‚</p>
<h4 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">deleteData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">where</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="sb">`256d6532-fcfe-4b81-a3f8-ee940f2de3e3`</span> <span class="p">}).</span><span class="k">delete</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦ä½¿ç”¨ where æ–¹æ³•ç¡®å®šåˆ é™¤èŒƒå›´ï¼Œä¸ç„¶æ•´ä¸ªè¡¨çš„æ•°æ®éƒ½å°†è¢«åˆ é™¤ï¼ˆæ•°æ®åº“æ“ä½œè¿”å›çš„å€¼ data ä¸ºå—å½±å“çš„è¡Œæ•°ï¼‰ã€‚</p>
<h4 id="äº‹åŠ¡">äº‹åŠ¡</h4>
<p>æ•°æ®åº“çš„äº‹åŠ¡æ˜¯ä¸€ä¸ªæ“ä½œåºåˆ—ï¼ŒåŒ…å«äº†ä¸€ç»„æ•°æ®åº“æ“ä½œæŒ‡ä»¤ã€‚</p>
<p>äº‹åŠ¡æŠŠè¿™ç»„æŒ‡ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“å‘æ•°æ®åº“æäº¤æ“ä½œè¯·æ±‚ï¼Œè¿™ä¸€ç»„æ•°æ®åº“å‘½ä»¤è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œé€»è¾‘å•å…ƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kr">async</span> <span class="p">(</span><span class="nx">trx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">chat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelChat</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chat</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s2">&#34;èŠå¤©å¯¹è±¡aaa&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chat</span><span class="p">.</span><span class="nx">sendTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chat</span><span class="p">.</span><span class="nx">lastMsg</span> <span class="o">=</span> <span class="s2">&#34;è¿™æ˜¯æ­¤ä¼šè¯çš„æœ€åä¸€æ¡æ¶ˆæ¯&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chat</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="sb">`https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">trx</span><span class="p">(</span><span class="s2">&#34;Chat&#34;</span><span class="p">).</span><span class="nx">insert</span><span class="p">(</span><span class="nx">chat</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// throw &#34;throw a error&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">let</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ModelMessage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">fromName</span> <span class="o">=</span> <span class="s2">&#34;èŠå¤©å¯¹è±¡&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">chatId</span> <span class="o">=</span> <span class="nx">chat</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">createTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">isInMsg</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">messageContent</span> <span class="o">=</span> <span class="s2">&#34;è¿™æ˜¯æˆ‘å‘ç»™ä½ çš„æ¶ˆæ¯&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">receiveTime</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">avatar</span> <span class="o">=</span> <span class="sb">`https://pic3.zhimg.com/v2-306cd8f07a20cba46873209739c6395d_im.jpg?source=32738c0c`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">trx</span><span class="p">(</span><span class="s2">&#34;Message&#34;</span><span class="p">).</span><span class="nx">insert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠä¸¤ä¸ªæ’å…¥æ“ä½œå°è£…åˆ°äº†ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸¤ä¸ªæ’å…¥æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸæ‰§è¡Œï¼Œè¦ä¹ˆä¸€ä¸ªä¹Ÿä¸æ‰§è¡Œï¼Œå¯ä»¥æŠŠ throw &ldquo;throw a error&rdquo; è¯­å¥å–æ¶ˆæ³¨é‡Šï¼Œè§‚å¯Ÿä¸€ä¸‹æ•°æ®åº“çš„æ•°æ®æ›´æ–°æƒ…å†µã€‚</p>
<p>db.transaction æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸­ trx å°±æ˜¯ Knex å°è£…çš„æ•°æ®åº“äº‹åŠ¡å¯¹è±¡ã€‚</p>
<h4 id="åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</h4>
<p>åˆ†é¡µä»æ•°æ®åº“ä¸­è·å–æ•°æ®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">Ref</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å½“å‰æ˜¯ç¬¬å‡ é¡µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">currentPageIndex</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ¯é¡µæ•°æ®è¡Œæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">rowCountPerPage</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ€»é¡µæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">pageCount</span>: <span class="kt">Ref</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–æŸä¸€é¡µæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getOnePageData</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s1">&#39;Chat&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">&#39;sendTime&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">offset</span><span class="p">(</span><span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">*</span> <span class="nx">rowCountPerPage</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="nx">rowCountPerPage</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–ç¬¬ä¸€é¡µæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getFirstPage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">pageCount</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// @ts-ignore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="p">{</span> <span class="nx">count</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">(</span><span class="s1">&#39;Chat&#39;</span><span class="p">).</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;id as count&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">count</span> <span class="o">=</span> <span class="nx">count</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pageCount</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">/</span> <span class="nx">rowCountPerPage</span><span class="p">.</span><span class="nx">value</span> <span class="kr">as</span> <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">getOnePageData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–ä¸‹ä¸€é¡µæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getNextPage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nx">pageCount</span><span class="p">.</span><span class="nx">value</span> <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">pageCount</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="nx">1</span> : <span class="kt">currentPageIndex.value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">getOnePageData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–ä¸Šä¸€é¡µæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getPrevPage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">0</span> : <span class="kt">currentPageIndex.value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">getOnePageData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–æœ€åä¸€é¡µæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getLastPage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentPageIndex</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">pageCount</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">await</span> <span class="nx">getOnePageData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è·å–ç¬¬ä¸€é¡µæ•°æ®æ—¶ï¼Œåˆå§‹åŒ–æ€»é¡µæ•°å’Œå½“å‰é¡µç æ•°ï¼Œæ€»é¡µæ•°æ˜¯é€šè¿‡æ•°æ®åº“ä¸­çš„æ€»è¡Œæ•°é™¤ä»¥æ¯é¡µè¡Œæ•°å¾—åˆ°çš„ï¼Œè¿™ä¸ªå€¼æœ‰å¯èƒ½åŒ…å«å°æ•°éƒ¨åˆ†ã€‚å½“å‰é¡µç æ•°æ˜¯ä»é›¶å¼€å§‹çš„æ•´æ•°ã€‚ç¬¬ä¸€é¡µæ—¶ï¼Œå®ƒçš„å€¼ä¸º 0ã€‚</p>
</li>
<li>
<p>è·å–ä¸‹ä¸€é¡µæ•°æ®æ—¶ï¼Œåˆ¤æ–­å½“å‰é¡µç æ•°æ˜¯ä¸æ˜¯åˆ°è¾¾äº†æœ€åä¸€é¡µï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±æŠŠå½“å‰é¡µç æ•°åŠ  1ï¼Œè€ƒè™‘åˆ°æ€»é¡µæ•°å­˜åœ¨å°æ•°çš„å¯èƒ½ï¼Œæ‰€ä»¥æœ€åä¸€é¡µçš„å½“å‰é¡µç æ•°åº”ä¸ºï¼šMath.ceil(pageCount) - 1ã€‚Math.ceil() å‡½æ•°è¿”å›å¤§äºæˆ–ç­‰äºä¸€ä¸ªç»™å®šæ•°å­—çš„æœ€å°æ•´æ•°ã€‚ Math.ceil(6.11) çš„ç»“æœä¸º 7ï¼ŒMath.ceil(6) çš„ç»“æœä¸º 6ã€‚</p>
</li>
<li>
<p>è·å–ä¸Šä¸€é¡µæ•°æ®æ—¶ï¼Œåˆ¤æ–­å½“å‰é¡µç æ•°æ˜¯ä¸æ˜¯å°äº 0ï¼Œå¦‚æœæ˜¯ï¼Œå°±æŠŠå½“å‰é¡µç æ•°ç½®ä¸º 0ï¼Œå¦‚æœä¸æ˜¯å°±æŠŠå½“å‰é¡µç æ•°å‡ä¸€ã€‚</p>
</li>
<li>
<p>è·å–æœ€åä¸€é¡µæ•°æ®æ—¶ï¼ŒæŠŠå½“å‰é¡µç æ•°ç½®ä¸º Math.ceil(pageCount) - 1 å³å¯ã€‚</p>
</li>
<li>
<p>æ¯æ¬¡è·å–æ•°æ®éƒ½è°ƒç”¨ getOnePageData æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸­éœ€è¦æ³¨æ„ offset å’Œ limit æ–¹æ³•çš„ä½¿ç”¨ï¼Œoffset æ–¹æ³•æ˜¯è·³è¿‡ n è¡Œçš„æ„æ€ï¼Œlimit æ–¹æ³•æ˜¯ç¡®ä¿è¿”å›çš„ç»“æœä¸­ä¸å¤šäº n è¡Œçš„æ„æ€ã€‚å½“æœ€åä¸€é¡µæ•°æ®ä¸è¶³ rowCountPerPageï¼ˆå€¼ä¸º 6ï¼‰æ—¶ï¼Œå°±è¿”å›æ•°æ®åº“è¡¨ä¸­å‰©ä½™çš„æ‰€æœ‰æ•°æ®ã€‚</p>
</li>
<li>
<p>åˆ†é¡µè·å–æ•°æ®æœ€å¥½æä¾›æ˜ç¡®çš„æ’åºè§„åˆ™ï¼šæ³¨æ„ orderBy çš„ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>åœ¨å®é™…çš„æ¡Œé¢åº”ç”¨ä¸­ä¸€èˆ¬ä¸ä¼šè¦æ±‚ç”¨æˆ·ç‚¹å‡»ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µç­‰æŒ‰é’®åˆ†é¡µè·å–æ•°æ®ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯æ ¹æ®æ»šåŠ¨æ¡æ»šåŠ¨æ—¶çš„è§¦åº•æˆ–è§¦é¡¶äº‹ä»¶æ¥è§¦å‘æ•°æ®è·å–çš„é€»è¾‘ï¼Œä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®çš„é€»è¾‘è¿˜æ˜¯å¤§åŒå°å¼‚çš„ï¼Œéƒ½æ˜¯ä¸€é¡µä¸€é¡µè¯»å–çš„ã€‚</p>
</li>
</ul>
<h2 id="å¼€å‘åŸç”Ÿæ¨¡å—">å¼€å‘åŸç”Ÿæ¨¡å—</h2>
<p>Node.js å…è®¸å¼€å‘è€…ä½¿ç”¨ Cã€C++ ç­‰è¯­è¨€å¼€å‘åŸç”Ÿæ¨¡å—ã€‚å¹¶ä¸”éµå¾ªæ­¤æ–¹æ¡ˆå¼€å‘å‡ºçš„åŸç”Ÿæ¨¡å—å¯ä»¥åƒæ™®é€šçš„ Node.js æ¨¡å—ä¸€æ ·é€šè¿‡ require() å‡½æ•°åŠ è½½ï¼Œå¹¶ä½¿ç”¨ JavaScript è®¿é—®æ¨¡å—æä¾›çš„ APIã€‚</p>
<p>Node.js å…·å¤‡åŸç”Ÿæ¨¡å—çš„èƒ½åŠ›è¿˜æœ‰ä»¥ä¸‹åŸå› ï¼š</p>
<ul>
<li>æ€§èƒ½æå‡ï¼š JavaScript æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œç›¸å¯¹äºç³»ç»Ÿçº§è¯­è¨€æ¥è¯´æ€§èƒ½ä¸Šè¿˜æ˜¯ç•¥æœ‰ä¸è¶³ã€‚</li>
<li>èŠ‚çº¦æˆæœ¬ï¼šæœ‰å¾ˆå¤šç°æˆçš„ C/C++ é¡¹ç›®ï¼Œåœ¨ Node.js é¡¹ç›®ä¸­ç›´æ¥å¤ç”¨è¿™äº›é¡¹ç›®å¯ä»¥èŠ‚çº¦å¾ˆå¤šå¼€å‘æˆæœ¬ã€‚</li>
<li>èƒ½åŠ›æ‹“å±•ï¼šNode.js ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œéœ€è¦ C/C++ çš„èƒ½åŠ›æ¥è¾…åŠ©å®Œæˆã€‚</li>
</ul>
<p>å¦‚ä½•åœ¨ Electron åº”ç”¨ä¸­ä½¿ç”¨åŸç”Ÿæ¨¡å—ï¼Ÿ</p>
<h3 id="æ­å»ºå¼€å‘ç¯å¢ƒ">æ­å»ºå¼€å‘ç¯å¢ƒ</h3>
<p>ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ Node-API å¼€å‘åŸç”Ÿæ¨¡å—ï¼ŒNode-API æ˜¯ä¸“é—¨ç”¨äºæ„å»ºåŸç”Ÿæ¨¡å—ï¼Œå®ƒç‹¬ç«‹äºåº•å±‚ JavaScript è¿è¡Œæ—¶ï¼Œå¹¶ä½œä¸º Node.js çš„ä¸€éƒ¨åˆ†è¿›è¡Œç»´æŠ¤ã€‚</p>
<p>å®ƒæ˜¯è·¨ Node.js ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼ŒABIï¼‰ï¼Œæ—¨åœ¨å°†åŸç”Ÿæ¨¡å—ä¸åº•å±‚å®ç°éš”ç¦»å¼€ï¼Œå¹¶å…è®¸ä¸ºæŸä¸ª Node.js ç‰ˆæœ¬ç¼–è¯‘çš„æ¨¡å—åœ¨æ›´é«˜ç‰ˆæœ¬çš„ Node.js ä¸Šè¿è¡Œè€Œæ— éœ€é‡æ–°ç¼–è¯‘ã€‚</p>
<p>ä¸åŒç‰ˆæœ¬çš„ Node.js ä½¿ç”¨åŒæ ·çš„æ¥å£ä¸ºåŸç”Ÿæ¨¡å—æä¾›æœåŠ¡ï¼Œè¿™äº›æ¥å£æ˜¯ ABI åŒ–çš„ï¼Œåªè¦ ABI çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œç¼–è¯‘å¥½çš„åŸç”Ÿæ¨¡å—å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p>
<p>åŸºäº Node-API å¼€å‘åŸç”Ÿæ¨¡å—ä»å­˜åœ¨ä¸¤ç§æ–¹å¼ã€‚</p>
<p>ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ C è¯­è¨€å¼€å‘ï¼Œç”±äº Node-API å°±æ˜¯ç”¨ C è¯­è¨€å°è£…çš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•æ›´ä¸ºç›´æ¥ï¼Œç”±äº C è¯­è¨€è¿‡äºç®€å•ç›´æ¥ï¼Œè¯­è¨€ç‰¹æ€§è¾ƒå°‘ï¼Œæ‰€ä»¥å¼€å‘èµ·æ¥éå¸¸éº»çƒ¦ã€‚</p>
<p>å¦ä¸€ç§æ–¹å¼æ˜¯åŸºäº node-addon-api ä½¿ç”¨ C++ è¯­è¨€å¼€å‘ï¼Œnode-addon-api é¡¹ç›®æ˜¯å¯¹ Node-API çš„ C++ å†åŒ…è£…ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç²¾ç®€å¾ˆå¤šä»£ç ã€‚</p>
<p>å…¨å±€å®‰è£… node-gyp å·¥å…·ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºæ„å»ºå¼€å‘ã€ç¼–è¯‘åŸç”Ÿæ¨¡å—ç¯å¢ƒè€Œç”Ÿçš„è·¨å¹³å°å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install -g node-gyp  
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–°å»ºä¸€ä¸ª Node.js é¡¹ç›®ï¼Œå®‰è£… node-addon-api:</p>
<p>src ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ nativeã€‚</p>
<p>åˆå§‹åŒ– Node.js é¡¹ç›®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm init -y
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install node-addon-api
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºåŸç”Ÿæ¨¡å—é…ç½®æ–‡ä»¶ binding.gyp:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;targets&#34;: [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;cflags!&#34;: [&#34;-fno-exceptions&#34;],
</span></span><span class="line"><span class="cl">      &#34;cflags_cc!&#34;: [&#34;-fno-exceptions&#34;],
</span></span><span class="line"><span class="cl">      &#34;defines&#34;: [&#34;NAPI_DISABLE_CPP_EXCEPTIONS&#34;],
</span></span><span class="line"><span class="cl">      &#34;target_name&#34;: &#34;addon&#34;,
</span></span><span class="line"><span class="cl">      &#34;include_dirs&#34;: [&#34;&lt;!(node -p \&#34;require(&#39;node-addon-api&#39;).include_dir\&#34;)&#34;],
</span></span><span class="line"><span class="cl">      &#34;sources&#34;: [&#34;export.cc&#34;],
</span></span><span class="line"><span class="cl">      &#34;conditions&#34;: [
</span></span><span class="line"><span class="cl">        [
</span></span><span class="line"><span class="cl">          &#39;OS==&#34;mac&#34;&#39;,
</span></span><span class="line"><span class="cl">          {
</span></span><span class="line"><span class="cl">            &#34;sources&#34;: [&#34;clipboard.mm&#34;],
</span></span><span class="line"><span class="cl">            &#34;link_settings&#34;: {
</span></span><span class="line"><span class="cl">              &#34;libraries&#34;: [&#34;-framework Cocoa&#34;, &#34;-framework CoreFoundation&#34;]
</span></span><span class="line"><span class="cl">            },
</span></span><span class="line"><span class="cl">            &#34;xcode_settings&#34;: {
</span></span><span class="line"><span class="cl">              &#34;GCC_ENABLE_CPP_EXCEPTIONS&#34;: &#34;YES&#34;,
</span></span><span class="line"><span class="cl">              &#34;CLANG_ENABLE_OBJC_ARC&#34;: &#34;YES&#34;,
</span></span><span class="line"><span class="cl">              &#34;OTHER_CFLAGS&#34;: [&#34;-ObjC++&#34;, &#34;-std=c++17&#34;]
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">          }
</span></span><span class="line"><span class="cl">        ],
</span></span><span class="line"><span class="cl">        [
</span></span><span class="line"><span class="cl">          &#39;OS==&#34;win&#34;&#39;,
</span></span><span class="line"><span class="cl">          {
</span></span><span class="line"><span class="cl">            &#34;sources&#34;: [&#34;clipboard.cc&#34;],
</span></span><span class="line"><span class="cl">            &#34;libraries&#34;: [&#34;Shlwapi.lib&#34;, &#34;Shcore.lib&#34;],
</span></span><span class="line"><span class="cl">            &#34;msvs_settings&#34;: {
</span></span><span class="line"><span class="cl">              &#34;VCCLCompilerTool&#34;: {
</span></span><span class="line"><span class="cl">                &#34;AdditionalOptions&#34;: [&#34;/std:c++17&#34;]
</span></span><span class="line"><span class="cl">              }
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">          }
</span></span><span class="line"><span class="cl">        ]
</span></span><span class="line"><span class="cl">      ]
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>include_dirs é…ç½® node-addon-api é¡¹ç›®æä¾›çš„ C++ å¤´æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚</li>
<li>definesã€cflags_cc!ã€ cflags!èµ·åˆ°ç¦ç”¨ C++ å¼‚å¸¸çš„ä½œç”¨ï¼ˆæ³¨æ„ï¼Œå¦‚æœé€‰æ‹©ç¦ç”¨ C++ å¼‚å¸¸ï¼Œé‚£ä¹ˆ node-addon-api æ¡†æ¶å°†ä¸å†ä¸ºå¼€å‘è€…å¤„ç†å¼‚å¸¸ï¼Œéœ€è¦è‡ªå·±æ£€æŸ¥å¼‚å¸¸ï¼‰ã€‚</li>
<li>sources æŒ‡å‘è¿™ä¸ªåŸç”Ÿæ¨¡å—çš„å…¥å£æ–‡ä»¶ã€‚</li>
<li>target_name ä¸ºåŸç”Ÿæ¨¡å—çš„åç§°ã€‚</li>
</ul>
<h3 id="è¯»å–å‰ªåˆ‡æ¿æ–‡ä»¶è·¯å¾„">è¯»å–å‰ªåˆ‡æ¿æ–‡ä»¶è·¯å¾„</h3>
<p>Electron å…¬å¼€çš„å‰ªåˆ‡æ¿ API æ˜¯æ— æ³•è¯»å–å‰ªåˆ‡æ¿å†…å¤šä¸ªæ–‡ä»¶çš„è·¯å¾„çš„ï¼Œå¼€å‘ä¸€ä¸ªåŸç”Ÿæ¨¡å—æ¥è¡¥å…¨ Electron åœ¨è¿™æ–¹é¢çš„ä¸è¶³ã€‚</p>
<p>åˆ›å»ºåŸç”Ÿæ¨¡å—çš„å…¥å£æ–‡ä»¶ï¼š</p>
<p>src/native/export.cc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#include &lt;napi.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;tuple&gt;
</span></span><span class="line"><span class="cl">#include &#34;clipboard.h&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Napi::Array ReadFilePathsJs(const Napi::CallbackInfo &amp;info)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    auto env = info.Env();
</span></span><span class="line"><span class="cl">    const auto file_paths = ReadFilePaths();
</span></span><span class="line"><span class="cl">    auto result = Napi::Array::New(env, file_paths.size());
</span></span><span class="line"><span class="cl">    for (size_t i = 0; i != file_paths.size(); ++i)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        result.Set(i, file_paths[i]);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return result;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Napi::Object Init(Napi::Env env, Napi::Object exports)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    exports.Set(&#34;readFilePaths&#34;, Napi::Function::New(env, ReadFilePathsJs));
</span></span><span class="line"><span class="cl">    return exports;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NODE_API_MODULE(NODE_GYP_MODULE_NAME, Init);
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>NODE_API_MODULE å®šä¹‰æ­¤åŸç”Ÿæ¨¡å—çš„å…¥å£å‡½æ•°ï¼Œä¸€æ—¦ Node.js åŠ è½½è¯¥æ¨¡å—æ—¶ï¼Œå°†æ‰§è¡Œ Init æ–¹æ³•ï¼ŒNODE_GYP_MODULE_NAME å®å±•å¼€åä¸ºç¼–è¯‘é…ç½®æ–‡ä»¶ binding.gyp ä¸­çš„ target_nameã€‚</p>
</li>
<li>
<p>Init æ–¹æ³•æ˜¯è¿™ä¸ªæ¨¡å—çš„å…¥å£å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ JavaScript è¿è¡Œæ—¶ç¯å¢ƒå¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯æ¨¡å—çš„å¯¼å‡ºå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ module.exportsï¼‰ï¼Œç»™è¿™ä¸ªå¯¹è±¡è®¾ç½®å±æ€§ï¼Œä»¥å¯¼å‡ºæƒ³è¦æš´éœ²ç»™å¤–éƒ¨çš„å†…å®¹ï¼Œæ­¤å¤„å¯¼å‡ºäº† ReadFilePathsJs æ–¹æ³•ï¼Œå½“å¤–éƒ¨è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå°†æ‰§è¡Œ ReadFilePathsJs å‡½æ•°ã€‚å…¥å£å‡½æ•°é€€å‡ºæ—¶åº”æŠŠ exports å¯¹è±¡è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p>
</li>
<li>
<p>ReadFilePathsJs æ–¹æ³•æ‰§è¡Œæ—¶è°ƒç”¨æ–¹ä¼šä¼ å…¥ä¸€ä¸ª CallbackInfo ç±»å‹çš„å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”± Node.js ä¼ å…¥çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å« JavaScript è°ƒç”¨æ­¤æ–¹æ³•æ—¶çš„è¾“å…¥å‚æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çš„ Env æ–¹æ³•è·å– JavaScript è¿è¡Œæ—¶ç¯å¢ƒå¯¹è±¡ã€‚</p>
</li>
<li>
<p>ReadFilePathsJs æ–¹æ³•å†…ï¼Œè°ƒç”¨äº† ReadFilePaths æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ clipboard.h ä¸­å®šä¹‰ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å®¹å™¨ï¼ˆstd::vector<a href="std::string" rel="">std::string</a>ç±»å‹ï¼‰ï¼Œè¿™ä¸ªå®¹å™¨ä¸­çš„å†…å®¹å°±æ˜¯å‰ªåˆ‡æ¿å†…çš„æ–‡ä»¶è·¯å¾„ã€‚</p>
</li>
<li>
<p>æŠŠè¿™ä¸ªå®¹å™¨ä¸­çš„å†…å®¹é€ä¸€å¤åˆ¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼ˆNapi::Array ç±»å‹ï¼Œè¿™ä¸ªç±»å‹å¯ä»¥ç›´æ¥è¢« JavaScript è®¿é—®ï¼‰ï¼Œæœ€åæŠŠè¿™ä¸ªæ•°ç»„è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
</li>
</ul>
<p>å®šä¹‰ clipboard.h å¤´æ–‡ä»¶å†…å®¹:</p>
<p>src/native/clipboard.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#ifndef CLIPBOARD_H
</span></span><span class="line"><span class="cl">#define CLIPBOARD_H
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#include &lt;vector&gt;
</span></span><span class="line"><span class="cl">#include &lt;string&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">std::vector&lt;std::string&gt; ReadFilePaths();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#endif
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®šä¹‰æ–¹æ³•ï¼šReadFilePathsï¼Œåœ¨ä¸åŒå¹³å°ä¸‹è¯»å–å‰ªåˆ‡æ¿çš„å®ç°é€»è¾‘ä¸åŒï¼Œæ‰€ä»¥è¦ä¸ºè¿™ä¸ªå¤´æ–‡ä»¶å®Œæˆä¸¤ä¸ªå®ç°é€»è¾‘ã€‚clipboard.cc æ˜¯ Windows å¹³å°ä¸Šçš„å®ç°ã€‚clipboard.mm æ˜¯ Mac å¹³å°ä¸Šçš„å®ç°é€»è¾‘ã€‚</p>
<p>Windows å¹³å°ä¸Šçš„å®ç°é€»è¾‘ï¼š</p>
<p>src/native/clipboard.cc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#include &lt;Windows.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;ShlObj.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;memory&gt;
</span></span><span class="line"><span class="cl">#include &#34;clipboard.h&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// å®½å­—ç¬¦ä¸²è½¬UTF8å­—ç¬¦ä¸²
</span></span><span class="line"><span class="cl">std::string Utf16CStringToUtf8String(LPCWSTR input, UINT len)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    int target_len = WideCharToMultiByte(CP_UTF8, 0, input, len, NULL, 0, NULL, NULL);
</span></span><span class="line"><span class="cl">    std::string result(target_len, &#39;\0&#39;);
</span></span><span class="line"><span class="cl">    WideCharToMultiByte(CP_UTF8, 0, input, len, result.data(), target_len, NULL, NULL);
</span></span><span class="line"><span class="cl">    return result;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//  RAIIï¼ˆResource Acquisition Is Initializationï¼‰ç±»
</span></span><span class="line"><span class="cl">class ClipboardScope
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    bool valid;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public:
</span></span><span class="line"><span class="cl">    ClipboardScope()
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        valid = static_cast&lt;bool&gt;(OpenClipboard(NULL));
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    ~ClipboardScope()
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        CloseClipboard();
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    bool IsValid()
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        return valid;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">};
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//è¯»å–å‰ªåˆ‡æ¿å†…çš„æ–‡ä»¶è·¯å¾„
</span></span><span class="line"><span class="cl">std::vector&lt;std::string&gt; ReadFilePaths()
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    auto result = std::vector&lt;std::string&gt;();
</span></span><span class="line"><span class="cl">    ClipboardScope clipboard_scope;
</span></span><span class="line"><span class="cl">    if (!clipboard_scope.IsValid())
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        return result;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    HDROP drop_files_handle = (HDROP)GetClipboardData(CF_HDROP);
</span></span><span class="line"><span class="cl">    if (!drop_files_handle)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        return result;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    UINT file_count = DragQueryFileW(drop_files_handle, 0xFFFFFFFF, NULL, 0);
</span></span><span class="line"><span class="cl">    result.reserve(file_count);
</span></span><span class="line"><span class="cl">    for (UINT i = 0; i &lt; file_count; ++i)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">        UINT path_len = DragQueryFileW(drop_files_handle, i, NULL, 0);
</span></span><span class="line"><span class="cl">        UINT buffer_len = path_len + 1;
</span></span><span class="line"><span class="cl">        std::unique_ptr&lt;WCHAR[]&gt; buffer(new WCHAR[buffer_len]);
</span></span><span class="line"><span class="cl">        path_len = DragQueryFileW(drop_files_handle, i, buffer.get(), buffer_len);
</span></span><span class="line"><span class="cl">        result.emplace_back(Utf16CStringToUtf8String(buffer.get(), path_len));
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>OpenClipboard ä¹‹åè¦å¯¹åº”çš„å…³é—­æ“ä½œ CloseClipboardï¼ŒæŠŠè¿™ä¸¤ä¸ªæ“ä½œå°è£…åˆ°äº†ä¸€ä¸ªå¯¹è±¡ä¸­ï¼šclipboard_scopeï¼Œè¿™ä¸ªå¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œ OpenClipboard æ“ä½œï¼Œå¯¹è±¡é‡Šæ”¾æ—¶ï¼Œæ‰§è¡Œ CloseClipboard æ“ä½œï¼Œè¿™æ˜¯ä½¿ç”¨ C++ å¼€å‘å¸¸è§çš„ RAIIï¼ˆResource Acquisition Is Initializationï¼‰å¼€å‘æŠ€å·§ã€‚</p>
</li>
<li>
<p>é€šè¿‡ Windows API è·å–åˆ°çš„æ–‡ä»¶è·¯å¾„æ˜¯å®½å­—èŠ‚å­—ç¬¦ä¸²ï¼Œéœ€è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²è½¬åŒ–æˆ UTF8 æ ¼å¼çš„å­—ç¬¦ä¸²æ‰èƒ½è¢« JavaScript ä½¿ç”¨ï¼Œä¸Šè¿°ä»£ç ä¸­ Utf16CStringToUtf8String æ–¹æ³•å°±æ˜¯å®Œæˆè¿™ä¸ªä»»åŠ¡çš„ã€‚</p>
</li>
<li>
<p>å¦‚æœå‰ªåˆ‡æ¿å†…æ²¡æœ‰æ–‡ä»¶è·¯å¾„ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºå®¹å™¨ï¼Œå¦‚æœæœ‰æ–‡ä»¶è·¯å¾„ï¼Œå°±æŠŠæ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„éƒ½æ”¾ç½®åˆ°å®¹å™¨ä¸­è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
</li>
</ul>
<p>Mac å¹³å°ä¸Šçš„å®ç°é€»è¾‘ï¼š</p>
<p>src/native/clipboard.mm</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#import &lt;Foundation/Foundation.h&gt;
</span></span><span class="line"><span class="cl">#import &lt;Cocoa/Cocoa.h&gt;
</span></span><span class="line"><span class="cl">#include &#34;clipboard.h&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">std::vector&lt;std::string&gt; ReadFilePaths() {
</span></span><span class="line"><span class="cl">    NSPasteboard *pasteboard = [NSPasteboard generalPasteboard];
</span></span><span class="line"><span class="cl">    NSArray&lt;NSURL *&gt; *urls = [pasteboard readObjectsForClasses:@[NSURL.class] options:@{
</span></span><span class="line"><span class="cl">            NSPasteboardURLReadingFileURLsOnlyKey: @YES,
</span></span><span class="line"><span class="cl">    }];
</span></span><span class="line"><span class="cl">    if (!urls) {
</span></span><span class="line"><span class="cl">        return {};
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    auto result = std::vector&lt;std::string&gt;();
</span></span><span class="line"><span class="cl">    result.reserve(urls.count);
</span></span><span class="line"><span class="cl">    for (NSURL *url in urls) {
</span></span><span class="line"><span class="cl">        result.emplace_back([url.path UTF8String]);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return result;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç¼–è¯‘åŸç”Ÿæ¨¡å—">ç¼–è¯‘åŸç”Ÿæ¨¡å—</h3>
<p>å¦‚ä½•å®ç°åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘ src/native/clipboard.cc æºç ï¼Œåœ¨ Mac ç¯å¢ƒä¸‹ç¼–è¯‘ src/native/clipboard.mmï¼Ÿ</p>
<p>ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼šsrc/native/binding.gyp æœ€åä¸€ä¸ªé…ç½®èŠ‚æä¾›äº†é…ç½®èƒ½åŠ›ã€‚è¿™ä¸ªé…ç½®èŠ‚çš„ä½œç”¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸åŒæ—¶ï¼ˆ&lsquo;OS==&ldquo;mac&rdquo;&rsquo;ï¼‰ï¼ŒæŒ‡å®šä¸åŒçš„æºç æ–‡ä»¶ï¼ˆsourcesï¼‰ã€ä¾èµ–åº“ï¼ˆlibrariesï¼‰å’Œç¼–è¯‘å·¥å…·ï¼ˆmsvs_settingsã€xcode_settingsï¼‰ã€‚</p>
<p>ç°åœ¨æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤æ¥ç”Ÿæˆæ„å»ºå·¥ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node-gyp configure
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ„å»ºå¥½å·¥ç¨‹ä¹‹åï¼Œå°è¯•ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥ç¼–è¯‘è¿™ä¸ªåŸç”Ÿæ¨¡å—ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node-gyp build
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœåœ¨å‘½ä»¤è¡Œç¯å¢ƒä¸­çœ‹åˆ°å½©è‰²çš„ gyp info ok è¿™è¡Œä¿¡æ¯ï¼Œè¯´æ˜åŸç”Ÿæ¨¡å—å·²ç»ç¼–è¯‘æˆåŠŸäº†ï¼Œå®ƒè¢«æ”¾ç½®åœ¨ build/Release/addon.node è·¯å¾„ä¸‹ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_13.png" alt="" width="700" />   
<p>æ¥ä¸‹æ¥å†™ä¸€æ®µ JavaScript ä»£ç ï¼Œæµ‹è¯•ä¸€ä¸‹è¿™ä¸ªåŸç”Ÿæ¨¡å—ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//src\native\test.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="kr">native</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./build/Release/addon.node&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">paths</span> <span class="o">=</span> <span class="kr">native</span><span class="p">.</span><span class="nx">readFilePaths</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">paths</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆå¤åˆ¶å‡ ä¸ªæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œè¿™ä¸ªæµ‹è¯•è„šæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node test.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>çœ‹çœ‹ä½ å¤åˆ¶çš„æ–‡ä»¶è·¯å¾„æ˜¯ä¸æ˜¯å·²ç»æ‰“å°åˆ°æ§åˆ¶å°ä¸Šäº†å‘¢ï¼Ÿ</p>
<p>ä¸Šé¢ç¼–è¯‘å‡ºçš„åŸç”Ÿæ¨¡å—ä¸ä¸€å®šèƒ½åœ¨ Electron åº”ç”¨ä¸­æ­£å¸¸å·¥ä½œã€‚è¿™æ˜¯å› ä¸º Electron å†…ç½®çš„ Node.js çš„ç‰ˆæœ¬å¯èƒ½ä¸ä½ ç¼–è¯‘åŸç”Ÿæ¨¡å—ä½¿ç”¨çš„ Node.js çš„ç‰ˆæœ¬ä¸åŒã€‚å¦‚æœåœ¨ Electron å·¥ç¨‹å†…ä½¿ç”¨åŸç”Ÿæ¨¡å—æ—¶ï¼Œç¢°åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-v" data-lang="v"><span class="line"><span class="cl"><span class="nb">Error</span><span class="p">:</span> <span class="nc">The</span> <span class="kn">module</span> <span class="s1">&#39;/path/to/native/module.node&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">was</span> <span class="nv">compiled</span> <span class="nv">against</span> <span class="nv">a</span> <span class="nv">different</span> <span class="nc">Node</span><span class="p">.</span><span class="nv">js</span> <span class="nv">version</span> <span class="nv">using</span>
</span></span><span class="line"><span class="cl"><span class="nc">NODE_MODULE_VERSION</span> <span class="o">$</span><span class="nc">XYZ</span><span class="p">.</span> <span class="nc">This</span> <span class="nv">version</span> <span class="nv">of</span> <span class="nc">Node</span><span class="p">.</span><span class="nv">js</span> <span class="nv">requires</span>
</span></span><span class="line"><span class="cl"><span class="nc">NODE_MODULE_VERSION</span> <span class="o">$</span><span class="nc">ABC</span><span class="p">.</span> <span class="nc">Please</span> <span class="nv">try</span> <span class="nv">re</span><span class="o">-</span><span class="nv">compiling</span> <span class="k">or</span> <span class="nv">re</span><span class="o">-</span><span class="nv">installing</span>
</span></span><span class="line"><span class="cl"><span class="nv">the</span> <span class="kn">module</span> <span class="p">(</span><span class="k">for</span> <span class="nv">instance</span><span class="p">,</span> <span class="nv">using</span> <span class="sc">`npm rebuild`</span> <span class="k">or</span> <span class="sc">`npm install`</span><span class="p">).</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ™è¯´æ˜ä½ ä½¿ç”¨çš„åŸç”Ÿæ¨¡å—ä¸ Electron çš„ ABI ä¸åŒ¹é…ï¼Œæ­¤æ—¶å°±è¦é’ˆå¯¹ Electron å†…ç½®çš„ ABI æ¥ç¼–è¯‘ä½ çš„åŸç”Ÿæ¨¡å—ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ä¸ç¼–è¯‘ SQLite åŸç”Ÿæ¨¡å—æ—¶ç›¸åŒï¼Œå¦‚ä¸‹æŒ‡ä»¤æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">electron-rebuild -f -m ./src/native
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ç¼–è¯‘å‡ºçš„åŸç”Ÿæ¨¡å—å°±å¯ä»¥åœ¨ Electron å·¥ç¨‹ä¸‹æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<h2 id="åº”ç”¨å‡çº§æ–¹æ¡ˆ">åº”ç”¨å‡çº§æ–¹æ¡ˆ</h2>
<p>äº§å“åœ¨ç¬¬ä¸€æ¬¡ä¸Šçº¿åï¼Œå¼€å§‹è¿›å…¥è¿­ä»£æœŸï¼Œå¼€å‘è€…ä¼šä¸ºäº§å“å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œä¿®å¤ Bugï¼Œéšä¹‹å°±ä¼šæ¨å‡ºæ–°ç‰ˆæœ¬ï¼Œæ€ä¹ˆæŠŠæ–°ç‰ˆæœ¬çš„äº§å“åˆ†å‘ç»™ç”¨æˆ·å°±æˆä¸ºäº†ä¸€ä¸ªäº§å“ç»ç†å’Œå¼€å‘äººå‘˜éƒ½å…³æ³¨çš„é—®é¢˜ã€‚</p>
<p>å¸‚é¢ä¸Šå¸¸è§çš„äº§å“å‡çº§æ–¹å¼æœ‰ä¸¤ç§:</p>
<ul>
<li>å…¨é‡å‡çº§ï¼Œè¿™ç§å‡çº§æ–¹å¼è¦æ±‚ç”¨æˆ·é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬çš„äº§å“ï¼Œåœ¨å®‰è£…æ–°ç‰ˆæœ¬å‰ï¼Œå®‰è£…ç¨‹åºä¼šæŠŠè€ç‰ˆæœ¬çš„äº§å“å¸è½½æ‰ï¼Œä»¥è¾¾åˆ°å‡çº§çš„ç›®çš„ã€‚è¿™ç§æ–¹å¼æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯å‡çº§å¾—æ¯”è¾ƒå½»åº•ï¼Œä¸ä¼šå—è€ç‰ˆæœ¬äº§å“çš„ä»»ä½•å½±å“ã€‚å¯æ˜¯å¦‚æœå¼€å‘è€…ä»…ä»…ä¿®æ”¹äº†ä¸€ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°±è¦è®©ç”¨æˆ·é‡æ–°å®‰è£…ä¸€éäº§å“çš„è¯ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ã€‚</li>
<li>å¢é‡å‡çº§ï¼Œè¿™ç§å‡çº§æ–¹å¼åªå‡çº§å¼€å‘è€…ä¿®æ”¹è¿‡çš„å†…å®¹ï¼Œå‡çº§å†…å®¹å°‘ï¼Œè¿‡ç¨‹è¿…é€Ÿï¼Œå¦‚æœå‡çº§å†…å®¹ä¸æ¶‰åŠå…³é”®ä¸šåŠ¡çš„è¯ï¼Œè¿˜å¯ä»¥åšåˆ°ç”¨æˆ·æ— æ„Ÿå‡çº§ã€‚</li>
</ul>
<h3 id="å…¨é‡å‡çº§">å…¨é‡å‡çº§</h3>
<p>ä½¿ç”¨ electron-updater æ¨¡å—æ¥å®Œæˆå‡çº§åŠŸèƒ½ï¼Œå®‰è£…è¿™ä¸ªæ¨¡å—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install electron-updater -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»º Updater.ts å°è£… Updater ç±»:</p>
<p>src/main/Updater.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">dialog</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">autoUpdater</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron-updater&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">Updater</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">static</span> <span class="nx">check() {</span>
</span></span><span class="line"><span class="cl">    <span class="nx">autoUpdater</span><span class="p">.</span><span class="nx">checkForUpdates</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">autoUpdater</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update-downloaded&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">dialog</span><span class="p">.</span><span class="nx">showMessageBox</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;æœ‰å¯ç”¨çš„å‡çº§&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">autoUpdater</span><span class="p">.</span><span class="nx">quitAndInstall</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Updater ç±»æä¾›äº†ä¸€ä¸ªæ–¹æ³• checkï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè®© autoUpdater å¯¹è±¡æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨æ–°ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå¹¶ç›‘å¬ update-downloaded äº‹ä»¶ã€‚</p>
<p>ä¸€æ—¦ autoUpdater å‘ç°æœåŠ¡ç«¯å­˜åœ¨æ›´æ–°çš„å®‰è£…åŒ…ï¼Œåˆ™ä¼šæŠŠå®‰è£…åŒ…ä¸‹è½½åˆ°ç”¨æˆ·æœ¬åœ°ç”µè„‘å†…ï¼Œå½“æ–°ç‰ˆæœ¬å®‰è£…åŒ…ä¸‹è½½å®Œæˆåï¼Œupdate-downloaded äº‹ä»¶è¢«è§¦å‘ã€‚æ­¤æ—¶æé†’ç”¨æˆ·â€œæœ‰å¯ç”¨çš„å‡çº§â€ï¼Œç”¨æˆ·ç¡®è®¤åå°±é€€å‡ºå½“å‰åº”ç”¨å¹¶å®‰è£…æ–°çš„å®‰è£…åŒ…ã€‚</p>
<p>åœ¨å‡çº§è¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„:</p>
<ul>
<li>å‡çº§æœåŠ¡çš„åœ°å€æ˜¯åœ¨åˆ¶ä½œå®‰è£…åŒ…æ—¶ï¼Œé€šè¿‡ config.publish.url æŒ‡å®šçš„ï¼Œè¿™ä¸ªè·¯å¾„æŒ‡å‘æ–°ç‰ˆæœ¬å®‰è£…åŒ…æ‰€åœ¨çš„æœåŠ¡å™¨ç›®å½•ã€‚</li>
</ul>
<p>src/plugins/buildPlugin.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">publish</span><span class="o">:</span> <span class="p">[{</span> <span class="nx">provider</span><span class="o">:</span> <span class="s2">&#34;generic&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;http://localhost:5500/&#34;</span> <span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å½“å®Œæˆæ–°ç‰ˆæœ¬çš„å¼€å‘å·¥ä½œåï¼Œè¦æŠŠ release ç›®å½•ä¸‹çš„ [your_project_name] Setup [your_project_version].exe å’Œ latest.yml ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°ç¬¬ 1 ç‚¹ä¸­æŒ‡å®šçš„æœåŠ¡å™¨åœ°å€ä¸‹ï¼ˆè¿™æ˜¯ Windows å¹³å°ä¸‹çš„å·¥ä½œï¼‰ã€‚Mac å¹³å°ä¸‹è¦æŠŠ release ç›®å½•ä¸‹çš„ [your_project_name]-[your_project_version]-mac.zipã€[your_project_name]-[your_project_version].dmg å’Œ latest-mac.yml ä¸‰ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°æŒ‡å®šçš„æœåŠ¡å™¨åœ°å€ä¸‹ã€‚</p>
</li>
<li>
<p>äº§å“ç‰ˆæœ¬æ˜¯é€šè¿‡ package.json ä¸­çš„ version å±æ€§æŒ‡å®šçš„ï¼Œäº§å“çš„å®‰è£…åŒ…çš„ç‰ˆæœ¬ä¹Ÿæ˜¯åœ¨è¿™é‡ŒæŒ‡å®šçš„ã€‚</p>
</li>
<li>
<p>é€šè¿‡ dialog.showMessageBox æé†’ç”¨æˆ·å‡çº§ç¨‹åºå®åœ¨ç§°ä¸ä¸Šç¾è§‚ï¼Œè¿™é‡Œåº”è¯¥å‘æ¶ˆæ¯ç»™æ¸²æŸ“è¿›ç¨‹ï¼Œè®©æ¸²æŸ“è¿›ç¨‹å¼¹å‡ºä¸€ä¸ªæ›´æ¼‚äº®çš„å‡çº§æé†’çª—å£ã€‚ç”¨æˆ·åšå‡ºé€‰æ‹©åï¼Œå†ç”±æ¸²æŸ“è¿›ç¨‹å‘æ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œå†æ‰§è¡Œ autoUpdater.quitAndInstall é€»è¾‘ã€‚</p>
</li>
<li>
<p>åœ¨ app ready äº‹ä»¶å‘ç”Ÿä¹‹åå†è°ƒç”¨ Updater.check() æ–¹æ³•ï¼Œè€Œä¸”åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹è°ƒç”¨ï¼Œå› ä¸ºåœ¨å¼€å‘ç¯å¢ƒä¸‹è°ƒç”¨å®ƒæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œelectron-updateråº“ä¼šç»™å‡ºå¦‚ä¸‹é”™è¯¯æç¤ºï¼š</p>
</li>
</ul>
<p>src/main/mainEntry.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">app</span><span class="p">,</span> <span class="nx">BrowserWindow</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;electron&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">CustomScheme</span><span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./CustomScheme&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Updater</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./Updater&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span><span class="nx">CommonWindowEvent</span><span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./CommonWindowEvent&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ELECTRON_DISABLE_SECURITY_WARNINGS</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainWindow</span>: <span class="kt">BrowserWindow</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;browser-window-created&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CommonWindowEvent</span><span class="p">.</span><span class="nx">regWinEvent</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">whenReady</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">frame</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">show</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">webPreferences</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">nodeIntegration</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webSecurity</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">allowRunningInsecureContent</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">contextIsolation</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webviewTag</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">spellcheck</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">disableHtmlFullscreenWindowResize</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">nativeWindowOpen</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">openDevTools</span><span class="p">({</span><span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;undocked&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">CustomScheme</span><span class="p">.</span><span class="nx">registerScheme</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="s1">&#39;app&#34;//index.html&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Updater.check();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CommonWindowEvent</span><span class="p">.</span><span class="nx">listen</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Skip checkForUpdatesAndNotify because application is not packed
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>æœ€å¥½è®©å‡çº§æœåŠ¡åœ°å€ä¸‹å§‹ç»ˆæœ‰ä¸€ä¸ªå®‰è£…åŒ…å’Œç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼Œä¸ç„¶ checkForUpdates æ–¹æ³•ä¼šæŠ¥é”™ã€‚</p>
</li>
<li>
<p>latest.yml çš„æ–‡ä»¶å†…åŒ…å«å¦‚ä¸‹å‡ ä¸ªä¿¡æ¯ï¼šæ–°ç‰ˆæœ¬å®‰è£…æ–‡ä»¶çš„ç‰ˆæœ¬å·ã€æ–‡ä»¶åã€æ–‡ä»¶çš„ sha512 å€¼ã€æ–‡ä»¶å¤§å°ã€æ–‡ä»¶ç”Ÿæˆæ—¶é—´ã€æ‰§è¡Œæ–°ç‰ˆæœ¬å®‰è£…æ–‡ä»¶æ—¶æ˜¯å¦éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚</p>
</li>
</ul>
<p>å½“ autoUpdater.checkForUpdates() æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆè¯·æ±‚è¿™ä¸ª yml æ–‡ä»¶ï¼Œå¾—åˆ°æ–‡ä»¶é‡Œçš„å†…å®¹åï¼Œå†æ‹¿æ­¤æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·ä¸å½“å‰ç‰ˆæœ¬å·å¯¹æ¯”ï¼Œå¦‚æœæ­¤æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·æ¯”å½“å‰ç‰ˆæœ¬å·æ–°ï¼Œåˆ™ä¸‹è½½æ–°ç‰ˆæœ¬ï¼Œå¦åˆ™å°±é€€å‡ºæ›´æ–°é€»è¾‘ã€‚</p>
<p>å½“æ–°ç‰ˆæœ¬å®‰è£…åŒ…ä¸‹è½½å®Œæˆåï¼Œelectron-updater ä¼šéªŒè¯æ–‡ä»¶çš„ sha512 å€¼æ˜¯å¦åˆæ³•ï¼Œyml æ–‡ä»¶ä¸­åŒ…å«æ–°ç‰ˆæœ¬å®‰è£…åŒ…çš„ sha512 å€¼ï¼Œelectron-updater é¦–å…ˆè®¡ç®—å‡ºä¸‹è½½çš„æ–°ç‰ˆæœ¬å®‰è£…åŒ…çš„ sha512 å€¼ï¼Œç„¶åå†ä¸ yml æ–‡ä»¶ä¸­çš„ sha512 å€¼å¯¹æ¯”ï¼Œä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™éªŒè¯é€šè¿‡ï¼Œä¸ç›¸ç­‰åˆ™éªŒè¯ä¸é€šè¿‡ã€‚</p>
<p>éªŒè¯é€šè¿‡å Electron åˆ™ä½¿ç”¨ Node.js çš„ child-process æ¨¡å—å¯åŠ¨è¿™ä¸ªæ–°çš„å®‰è£…æ–‡ä»¶ï¼Œä»¥å®Œæˆåº”ç”¨ç¨‹åºå‡çº§å·¥ä½œã€‚</p>
<h3 id="å¢é‡å‡çº§">å¢é‡å‡çº§</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šä½¿ç”¨ asar æ–‡ä»¶å­˜å‚¨åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œæ‰€ä»¥å¢é‡å‡çº§åªè¦è€ƒè™‘æ›´æ–°è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p>
<p>Electron åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šé¦–å…ˆåŠ è½½ä¸»è¿›ç¨‹çš„å…¥å£æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨æ‰“åŒ… Electron åº”ç”¨æ—¶æŒ‡å®šçš„ã€‚</p>
<p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<p>src/plugins/buildPlugin.ts</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">localPkgJson</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="s2">&#34;mainEntry.js&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾è¿™ä¸ªæ–‡ä»¶ï¼ˆmainEntry.jsï¼‰æ²¡æœ‰å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½é€»è¾‘ï¼Œè€Œæ˜¯åªå®Œæˆè¿™æ ·çš„é€»è¾‘ï¼šåˆ¤æ–­ä¸€ä¸‹å½“å‰ç”¨æˆ·ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ asar æ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥åŠ è½½æ–°ç‰ˆæœ¬ asar æ–‡ä»¶ä¸­çš„ä¸šåŠ¡ä»£ç ï¼ˆå‡è®¾å« mainLogic.jsï¼‰ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±åŠ è½½å½“å‰ asar æ–‡ä»¶ä¸­çš„ä¸šåŠ¡ä»£ç  mainLogic.jsã€‚æ³¨æ„ï¼šmainEntry.js å’Œ mainLogic.js éƒ½å­˜åœ¨äº asar æ–‡ä»¶ä¸­ã€‚</p>
<p>ä½ å¯èƒ½ä¼šæ‹…å¿ƒä¸€ä¸ª asar æ–‡ä»¶ä¸­çš„ js ä»£ç æ˜¯ä¸æ˜¯å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ª asar ä¸­çš„ js ä»£ç ï¼Œè¿™æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
<p>å¦‚ä¸‹ä»£ç å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œåªè¦æŠŠ asar å½“ä½œä¸€ä¸ªç›®å½•å³å¯ï¼ŒElectron ä¼šå®Œæˆå…·ä½“çš„åŠ è½½å·¥ä½œã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainLogicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`c://yourNewVersion.asar`</span><span class="p">,</span> <span class="s2">&#34;mainLogic.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">mainLogic</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mainPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">mainLogic</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œå°±å¯ä»¥æ¯æ¬¡å‡çº§åªå‡çº§ asar æ–‡ä»¶ï¼Œè€Œä¸å¿…å‡çº§æ•´ä¸ªåº”ç”¨äº†ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_14.png" alt="" width="700" />  
<p>çº¢è‰²æ¨¡å—çš„é€»è¾‘æ˜¯ç”¨æˆ·å®Œæˆçš„ï¼Œè“è‰²æ¨¡å—çš„é€»è¾‘éƒ½æ˜¯åœ¨ mainEntry.js ä¸­å®ç°çš„ï¼Œç»¿è‰²æ¨¡å—çš„é€»è¾‘æ˜¯åœ¨ mainLogic.js æ–‡ä»¶ä¸­å®ç°çš„ã€‚</p>
<p>mainLogic.js ä¸å•å•æœ‰ç»¿è‰²æ¨¡å—æè¿°çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿˜åŒ…æ‹¬æ•´ä¸ªåº”ç”¨çš„å…¶ä»–ä¸»è¿›ç¨‹ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>åœ¨å®‰è£…ç›®å½•ä¸‹çš„ asar æ–‡ä»¶æ˜¯ä¸€ä¸ªå®Œæ•´åº”ç”¨çš„ asar æ–‡ä»¶ï¼Œå®ƒåŒ…æ‹¬ mainEntry.jsã€mainLogic.js å’Œæ¸²æŸ“è¿›ç¨‹çš„æ‰€æœ‰ä»£ç æ–‡ä»¶ã€‚</p>
<p>å‡çº§ç›®å½•ä¸‹çš„ asar æ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªå®Œæ•´åº”ç”¨çš„ asar æ–‡ä»¶ï¼Œå®ƒä¹ŸåŒ…æ‹¬ mainEntry.jsã€mainLogic.js å’Œæ¸²æŸ“è¿›ç¨‹çš„æ‰€æœ‰ä»£ç æ–‡ä»¶ï¼Œåªä¸è¿‡ mainEntry.js æ–‡ä»¶å¯¹äºå®ƒæ¥è¯´æ˜¯å¯æœ‰å¯æ— çš„ã€‚</p>
<p>å‡çº§ç›®å½•å¯ä»¥ç”±å¼€å‘è€…è‡ªå·±æŒ‡å®šï¼Œæ¨èæŠŠè¿™ä¸ªç›®å½•æŒ‡å®šä¸ºç”¨æˆ·çš„ appData ç›®å½•ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ã€‚</p>
<p>ä¸‹è½½ä¿å­˜æ—¶ï¼Œè¦æ³¨æ„ asar æ–‡ä»¶çš„å‘½åè§„åˆ™ã€‚æ¯”å¦‚ï¼šmain.2.3.6.18.asarï¼Œå…¶ä¸­ 2.3.6 æ˜¯äº§å“çš„ç‰ˆæœ¬å·ï¼ŒæŠŠè¿™ä¸ªç‰ˆæœ¬å·å«ä½œå¤§ç‰ˆæœ¬å·ï¼›18 æ˜¯ asar æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼ŒæŠŠè¿™ä¸ªç‰ˆæœ¬å·å«å°ç‰ˆæœ¬å·ã€‚</p>
<p>è¿™æ ·åšæœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„:</p>
<ul>
<li>
<p>å½“ç”¨æˆ·å¤šæ¬¡å¢é‡å‡çº§åº”ç”¨ç¨‹åºåï¼Œå‡çº§ç›®å½•ä¸‹å°±ä¼šæœ‰å¤šä¸ª asar æ–‡ä»¶ï¼Œä»¥è¿™ç§è§„åˆ™å‘½å mainEntry.js å°±å¯ä»¥æ–¹ä¾¿åœ°æ‰¾åˆ°å“ªä¸ªæ–‡ä»¶æ˜¯æœ€æ–°çš„ã€‚å‡è®¾å®‰è£…ç›®å½•ä¸‹çš„ asar æ–‡ä»¶çš„ç‰ˆæœ¬å·æ˜¯ 0ï¼Œé‚£ä¹ˆå‡çº§ç›®å½•ä¸‹çš„ asar æ–‡ä»¶çš„ç‰ˆæœ¬å·åº”è¯¥ä»ç‰ˆæœ¬å· 1 å¼€å§‹ã€‚</p>
</li>
<li>
<p>åº”å¯¹ç”¨æˆ·è‡ªå·±é‡æ–°å®‰è£…äº†ä¸€ä¸ªè€æ—§çš„å®‰è£…åŒ…çš„æƒ…å†µï¼Œå½“å‡çº§ç›®å½•ä¸‹æœ‰ main.2.3.7.1.asar æ–‡ä»¶ã€ä¹Ÿæœ‰ main.2.3.6.1.asar æ–‡ä»¶æ—¶ï¼Œä½†å½“å‰ç”¨æˆ·å®‰è£…çš„äº§å“çš„ç‰ˆæœ¬å·æ˜¯ 2.3.6 æ—¶ï¼Œä¸åº”è¯¥åŠ è½½è¿™ä¸ª main.2.3.7.1.asarï¼Œè€Œåº”è¯¥åŠ è½½ main.2.3.6.1.asar.</p>
</li>
</ul>
<p>å‡è®¾è¦è€ƒè™‘ç‰ˆæœ¬é™çº§ä»¥åº”å¯¹ç‰ˆæœ¬å‘å¸ƒåæ‰å‘ç°äº†é‡å¤§é—®é¢˜çš„åœºæ™¯ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç»™ä½ çš„å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæŒ‡ä»¤ï¼Œè¿«ä½¿ä½ çš„å®¢æˆ·ç«¯åˆ é™¤æŒ‡å®šç‰ˆæœ¬çš„ asar æ–‡ä»¶ï¼Œç„¶åæç¤ºç”¨æˆ·é‡å¯åº”ç”¨å³å¯ã€‚</p>
<p>ç”¨æˆ·å¯åŠ¨åº”ç”¨åï¼Œå‘ç°æœåŠ¡ç«¯æœ‰æ–°çš„ asar æ–‡ä»¶ï¼Œä¸‹è½½æˆåŠŸåï¼Œé©¬ä¸Šåˆè¦æ±‚ç”¨æˆ·é‡å¯ï¼Œå¦‚æœä½ æ‹…å¿ƒè¿™ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œé‚£ä½ å¯ä»¥æŠŠæ£€æŸ¥å¹¶ä¸‹è½½æ–°ç‰ˆæœ¬ asar çš„é€»è¾‘æ”¾åœ¨ä¸»çª—å£æ˜¾ç¤ºä¹‹å‰ï¼Œåªæœ‰åœ¨æœåŠ¡ç«¯æ²¡æœ‰æ–° asar æ–‡ä»¶æˆ–æœåŠ¡ç«¯æ— æ³•è®¿é—®æ—¶æ‰ä¼šæ˜¾ç¤ºä¸»çª—å£ã€‚</p>
<p>è¿™æ ·é‡å¯åº”ç”¨çš„é€»è¾‘ä¹Ÿä¸éœ€è¦ç”¨æˆ·ç¡®è®¤äº†ï¼Œå³ä½¿å®¢æˆ·ç«¯åœ¨æ²¡æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸­ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
<p>ä½†è¿™æ ·åšä¼šå¢åŠ åº”ç”¨é¦–å±åŠ è½½çš„æ—¶é—´ï¼Œä¸è¿‡å¼€å‘è€…è¿˜å¯ä»¥åŠ ä¸€ä¸ª splash window ä»¥æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<p>asar æ–‡ä»¶ä¸ä¼šå¤ªå¤§ï¼Œä¹Ÿå°±å‡ å…†ï¼Œå¸¦ç»™ç”¨æˆ·çš„è´Ÿæ‹…æ›´å°ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚</p>
<h2 id="è°ƒè¯•çº¿ä¸Šåº”ç”¨">è°ƒè¯•çº¿ä¸Šåº”ç”¨</h2>
<p>ï¼ˆï¼šè¯·è½¬ç§»åˆ°å…¬å¸æä¾›çš„ windows ç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•ï¼Œæ¯•ç«ŸæŠŠç”µè„‘ç©åäº†ä¸ç”¨è‡ªæè…°åŒ…ã€‚</p>
<ul>
<li>æŒ‰é»˜è®¤é…ç½®ç”Ÿæˆçš„ Electron åº”ç”¨ä¸å…·å¤‡æºç ä¿æŠ¤èƒ½åŠ›ï¼Œå…ˆè§£æçº¿ä¸Š Electron åº”ç”¨çš„ä¸šåŠ¡ä»£ç ã€‚</li>
<li>è§£æå‡ºçš„ä¸šåŠ¡ä»£ç ï¼Œä¸€èˆ¬éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œåˆ†æå¦‚ä½•è°ƒè¯•çº¿ä¸Šåº”ç”¨çš„ä¸šåŠ¡ä»£ç ã€‚</li>
<li>åˆ†æ Electron åº”ç”¨çš„å´©æºƒæŠ¥å‘Šï¼Œåº”å¯¹ä¸€äº›éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚</li>
</ul>
<h3 id="ä¸šåŠ¡ä»£ç è§£æ">ä¸šåŠ¡ä»£ç è§£æ</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œelectron-builder ä¼šæŠŠ HTMLã€CSS å’Œ JavaScript ä»£ç ä»¥åŠç›¸å…³çš„èµ„æºæ‰“åŒ…æˆ asar æ–‡ä»¶åµŒå…¥åˆ°å®‰è£…åŒ…ä¸­ï¼ˆå°±æ˜¯å®‰è£…ç›®å½•ä¸‹çš„ app.asar æ–‡ä»¶ï¼‰ï¼Œå†åˆ†å‘ç»™ç”¨æˆ·ã€‚</p>
<p>asar æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜æ¡£æ ¼å¼ï¼Œå®ƒå¯ä»¥æŠŠå¤§æ‰¹çš„æ–‡ä»¶ä»¥ä¸€ç§æ— æŸã€æ— å‹ç¼©çš„æ–¹å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶æä¾›éšæœºè®¿é—®æ”¯æŒã€‚</p>
<p>å…¨å±€å®‰è£… asar å·¥å…·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install asar -g
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…å¥½å·¥å…·åï¼Œæ‰“å¼€åº”ç”¨çš„å®‰è£…ç›®å½•ï¼Œåœ¨ resources å­ç›®å½•ä¸‹æ‰¾åˆ° app.asar æ–‡ä»¶ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤åˆ—å‡ºè¯¥æ–‡ä»¶å†…éƒ¨åŒ…å«çš„æ–‡ä»¶ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">asar list app.asar
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæƒ³çœ‹ app.asar åŒ…ä¸­çš„æŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŠŠè¯¥æ–‡ä»¶é‡Šæ”¾å‡ºæ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">asar ef app.asar entry.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ · entry.js å°±ä¼šå‡ºç°åœ¨ app.asar åŒçº§ç›®å½•ä¸‹äº†ï¼Œå¦‚æœé‡Šæ”¾æ–‡ä»¶å¤±è´¥ï¼Œæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">internal/fs/utils.js:307
</span></span><span class="line"><span class="cl">throw err;
</span></span><span class="line"><span class="cl">Error: EPERM: operation not permitted, open &#39;entry.js&#39;
</span></span><span class="line"><span class="cl">90m    at Object.openSync (fs.js:476:3)39m
</span></span><span class="line"><span class="cl">90m    at Object.writeFileSync (fs.js:1467:35)39m
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯èƒ½æ˜¯å› ä¸ºä½ çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œapp.asar æ–‡ä»¶è¢«å ç”¨äº†å¯¼è‡´çš„ï¼Œé€€å‡ºåº”ç”¨ç¨‹åºå†æ¬¡å°è¯•ï¼Œå¦‚æœè¿˜æ˜¯æ— æ³•é‡Šæ”¾ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥è€ƒè™‘æŠŠ app.asar æ‹·è´åˆ°å¦ä¸€ä¸ªç›®å½•ä¸‹å†é‡Šæ”¾ã€‚</p>
<p>å¦‚æœå¸Œæœ›ä¸€æ¬¡æ€§æŠŠ app.asar å†…çš„æ–‡ä»¶å…¨éƒ¨é‡Šæ”¾å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">asar e app.asar
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç”Ÿäº§ç¯å¢ƒè°ƒè¯•">ç”Ÿäº§ç¯å¢ƒè°ƒè¯•</h3>
<p>æŠŠ asar æ–‡ä»¶ä¸­çš„ä¸šåŠ¡ä»£ç è§£æå‡ºæ¥ä¹‹åï¼Œè¿™äº›ä¸šåŠ¡ä»£ç éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œè¦æƒ³é€šè¿‡è¿™äº›ä»£ç æ–‡ä»¶åˆ†æçº¿ä¸Šåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘æ˜¯éå¸¸å›°éš¾çš„ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯èƒ½æƒ³åŠæ³•è°ƒè¯•è¿™äº›ä¸šåŠ¡ä»£ç æ‰è¡Œã€‚</p>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªçº¿ä¸Š Electron åº”ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">D:<span class="se">\\</span>yourApp<span class="se">\\</span>yourProductName.exe --inspect<span class="o">=</span><span class="m">7676</span> --remote-debugging-port<span class="o">=</span><span class="m">7878</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå‘½ä»¤åœ¨å¯åŠ¨ Electron åº”ç”¨ç¨‹åºæ—¶ï¼Œä¸ºç›®æ ‡ç¨‹åºæŒ‡å®šäº†ä¸¤ä¸ªç«¯å£å·ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡&ndash;inspect æŒ‡ä»¤æŒ‡å®šçš„ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡&ndash;remote-debugging-port æŒ‡ä»¤æŒ‡å®šçš„ï¼Œæ¥ä¸‹æ¥è¦æ ¹æ®è¿™ä¸¤ä¸ªç«¯å£å·è·å–è°ƒè¯•åœ°å€ã€‚</p>
<p>æ‰“å¼€è°·æ­Œæµè§ˆå™¨ï¼Œè®¿é—®å¦‚ä¸‹ä¸¤ä¸ªåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">http://127.0.0.1:7676/json
</span></span><span class="line"><span class="cl">http://127.0.0.1:7878/json
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªåœ°å€å‡ä¼šå“åº” JSON å­—ç¬¦ä¸²ï¼Œå“åº”ç»“æœæ˜¯ä¸€ä¸ªå¯¹åº”ç€ä¸»è¿›ç¨‹çš„è°ƒè¯•ä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">&#34;description&#34;: &#34;node.js instance&#34;,
</span></span><span class="line"><span class="cl">&#34;devtoolsFrontendUrl&#34;: &#34;devtools://devtools/bundled/js_app.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:7676/85ac5529-d1a5-49b3-8655-f71c7c198b71&#34;,
</span></span><span class="line"><span class="cl">&#34;devtoolsFrontendUrlCompat&#34;: &#34;devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:7676/85ac5529-d1a5-49b3-8655-f71c7c198b71&#34;,
</span></span><span class="line"><span class="cl">&#34;faviconUrl&#34;: &#34;https://nodejs.org/static/images/favicons/favicon.ico&#34;,
</span></span><span class="line"><span class="cl">&#34;id&#34;: &#34;85ac5529-d1a5-49b3-8655-f71c7c198b71&#34;,
</span></span><span class="line"><span class="cl">&#34;title&#34;: &#34;Node.js[25204]&#34;,
</span></span><span class="line"><span class="cl">&#34;type&#34;: &#34;node&#34;,
</span></span><span class="line"><span class="cl">&#34;url&#34;: &#34;file://&#34;,
</span></span><span class="line"><span class="cl">&#34;webSocketDebuggerUrl&#34;: &#34;ws://127.0.0.1:7676/85ac5529-d1a5-49b3-8655-f71c7c198b71&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦ä¸€ä¸ªå¯¹åº”ç€æ¸²æŸ“è¿›ç¨‹çš„è°ƒè¯•ä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">&#34;description&#34;: &#34;&#34;,
</span></span><span class="line"><span class="cl">&#34;devtoolsFrontendUrl&#34;: &#34;/devtools/inspector.html?ws=127.0.0.1:7878/devtools/page/AFCF98D56EE8462C3D8E52FA99C02F91&#34;,
</span></span><span class="line"><span class="cl">&#34;id&#34;: &#34;AFCF98D56EE8462C3D8E52FA99C02F91&#34;,
</span></span><span class="line"><span class="cl">&#34;title&#34;: &#34;Vite App&#34;,
</span></span><span class="line"><span class="cl">&#34;type&#34;: &#34;page&#34;,
</span></span><span class="line"><span class="cl">&#34;url&#34;: &#34;app://./index.html&#34;,
</span></span><span class="line"><span class="cl">&#34;webSocketDebuggerUrl&#34;: &#34;ws://127.0.0.1:7878/devtools/page/AFCF98D56EE8462C3D8E52FA99C02F91&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªå“åº”ä¸­æœ€é‡è¦çš„ä¿¡æ¯å°±æ˜¯ devtoolsFrontendUrlï¼Œå¾—åˆ°æ­¤ä¿¡æ¯åï¼Œè¦æŠŠå®ƒä»¬è½¬æ¢ä¸ºå¦‚ä¸‹çš„æ ¼å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">devtools://devtools/bundled/js_app.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:7676/e9c9b139-a606-4703-be3f-f4ffc496a6aa
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">devtools://devtools/bundled/inspector.html?ws=127.0.0.1:7878/devtools/page/33DFD3D347C1B575DC6361CC61ABAEDE
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè½¬æ¢è¿‡ç¨‹æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œå¦‚æœä½ å«Œéº»çƒ¦ä¹Ÿå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæ›¿æ¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">devtoolsFrontendUrl.replace(/^\/devtools/, &#34;devtools://devtools/bundled&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠŠè½¬æ¢åçš„åœ°å€æ”¾å…¥è°·æ­Œæµè§ˆå™¨ä¸­ï¼Œå°†å¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºç»“æœï¼Œå¯ä»¥è¯•ç€åœ¨å¯¹åº”çš„æºæ–‡ä»¶ä¸­ä¸‹ä¸€ä¸ªæ–­ç‚¹è¯•è¯•çœ‹ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_16.png" alt="" width="700" />   
<p>å¦‚æœç›®æ ‡åº”ç”¨çš„æºç æ˜¯å‹ç¼©è¿‡çš„ï¼Œå¯ä»¥å°è¯•ç‚¹å‡»è°ƒè¯•å™¨å³ä¸‹è§’çš„ {} æŒ‰é’®ç¾åŒ–ä»£ç ï¼ŒæŸ¥çœ‹ç¾åŒ–åçš„ä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥æ›´æ–¹ä¾¿åœ°ä¸‹æ–­ç‚¹è°ƒè¯•äº†ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_17.png" alt="" width="700" />   
<p>é€šè¿‡è¿™ç§æ–¹æ³•åªèƒ½è°ƒè¯•å¸‚é¢ä¸Šä¸€éƒ¨åˆ†åŸºäº Electron å¼€å‘çš„åº”ç”¨ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åŸºäº Electron å¼€å‘çš„åº”ç”¨éƒ½èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•è°ƒè¯•ã€‚</p>
<h3 id="åˆ†æå´©æºƒæŠ¥å‘Š">åˆ†æå´©æºƒæŠ¥å‘Š</h3>
<p>åˆ†æè°ƒè¯•ä¸šåŠ¡ä»£ç ä¸»è¦ç›®çš„æ˜¯è¿½è¸ªä¸šåŠ¡ä»£ç çš„é—®é¢˜ï¼Œä½†æœ‰äº›é—®é¢˜æ˜¯ä¸ä¼šç»™æˆ‘ä»¬è¿½è¸ªçš„æœºä¼šçš„ï¼Œæ¯”å¦‚é‚£äº›å¶å‘çš„ã€ä¸€æ—¦å‡ºç°åº”ç”¨ç¨‹åºå°±ç«‹å³ Crash çš„é—®é¢˜ã€‚è¦è§£å†³è¿™äº›é—®é¢˜å°±è¦æŒæ¡åˆ†æ Electron åº”ç”¨å´©æºƒæŠ¥å‘Šçš„çŸ¥è¯†ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ä½ çš„åº”ç”¨ç¨‹åºå´©æºƒæ—¶ï¼Œè‡ªåŠ¨ä¿å­˜å´©æºƒæŠ¥å‘Šæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±è¦åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¦‚ä¸‹ä»£ç æ”¶é›†å´©æºƒæŠ¥å‘Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import { crashReporter } from &#34;electron&#34;;
</span></span><span class="line"><span class="cl">crashReporter.start({ submitURL: &#34;&#34;, uploadToServer: false });
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™æ®µä»£ç ï¼Œå½“åº”ç”¨ç¨‹åºå´©æºƒæ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª.dmp æ‰©å±•åç»“å°¾çš„æ–‡ä»¶ï¼ˆå­˜æ”¾äº C://Users/[yourOsUserName]/AppData/Roaming/[yourAppName]/Crashpadï¼‰ã€‚</p>
<p>é¦–å…ˆéœ€è¦å®‰è£… WinDbg è°ƒè¯•å·¥å…·ï¼Œå¦‚æœä½ åœ¨å®‰è£… Windows 10 SDK æ—¶å‹¾é€‰äº† Debugging Tools For Windowsï¼Œé‚£ä¹ˆ WinDbg å·²ç»åœ¨å¦‚ä¸‹ç›®å½•å†…äº†ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼š</p>
<p>C://Program Files (x86)/Windows Kits/10/Debuggers/x86</p>
<p>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å¦‚ä¸‹åœ°å€ä¸‹è½½å®‰è£…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…å®Œæˆåï¼Œé€šè¿‡èœå• File-&gt;Symbol File Path æ‰“å¼€ç¬¦å·è·¯å¾„è®¾ç½®çª—å£ï¼Œè¾“å…¥å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SRV*d:\code\symbols\*https://msdl.microsoft.com/download/symbols;SRV*d:\code\symbols\*https://symbols.electronjs.org
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ®µé…ç½®ä¸­æœ‰ä¸‰ä¸ªå…³é”®ä¿¡æ¯ï¼Œä¾æ¬¡æ˜¯ç¬¦å·æ–‡ä»¶çš„ç¼“å­˜è·¯å¾„ã€Windows æ“ä½œç³»ç»Ÿå…³é”® dll çš„ç¬¦å·æœåŠ¡å™¨å’Œ Electron çš„ç¬¦å·æœåŠ¡å™¨ã€‚</p>
<p>è®¾ç½®å®Œç¬¦å·æœåŠ¡å™¨ä¹‹åï¼Œé€šè¿‡èœå• File-&gt;Open Crash Dump æ‰“å¼€åˆšåˆšç”Ÿæˆçš„å´©æºƒæŠ¥å‘Šï¼Œæ¥ç€å°±ç­‰å¾… WinDbg åŠ è½½å¯¹åº”çš„ç¬¦å·ï¼ˆWinDbg ä¼šé€šè¿‡ Electron ç¬¦å·æœåŠ¡å™¨ä¸‹è½½ä¸å´©æºƒæŠ¥å‘Šå¯¹åº”çš„ Electron ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åœ¨ç¼“å­˜ç›®å½•ä¸­ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ï¼‰ã€‚</p>
<p>æ¥ç€å†åœ¨å‘½ä»¤çª—å£çš„åº•éƒ¨è¾“å…¥ !analyze -v æŒ‡ä»¤å¼€å§‹åˆ†æå´©æºƒæŠ¥å‘Šã€‚</p>
<p>åŠ è½½å®Œæˆå WinDbg ä¼šåœ¨çª—å£ä¸­æ˜¾ç¤ºå´©æºƒæŠ¥å‘Šå†…éƒ¨çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">EXCEPTION_RECORD:  (.exr -1)
</span></span><span class="line"><span class="cl">ExceptionAddress: 00007ff725996fac (electron!node::AsyncResource::CallbackScope::~CallbackScope+0x000000000013227c)
</span></span><span class="line"><span class="cl">ExceptionCode: c0000005 (Access violation)
</span></span><span class="line"><span class="cl">ExceptionFlags: 00000000
</span></span><span class="line"><span class="cl">NumberParameters: 2
</span></span><span class="line"><span class="cl">Parameter[0]: 0000000000000001
</span></span><span class="line"><span class="cl">Parameter[1]: 0000000000000000
</span></span><span class="line"><span class="cl">Attempt to write to address 0000000000000000
</span></span><span class="line"><span class="cl">PROCESS_NAME:  electron.exe
</span></span><span class="line"><span class="cl">WRITE_ADDRESS:  0000000000000000
</span></span><span class="line"><span class="cl">ERROR_CODE: (NTSTATUS) 0xc0000005 - 0x%p            0x%p                    %s
</span></span><span class="line"><span class="cl">EXCEPTION_CODE_STR:  c0000005
</span></span><span class="line"><span class="cl">EXCEPTION_PARAMETER1:  0000000000000001
</span></span><span class="line"><span class="cl">EXCEPTION_PARAMETER2:  0000000000000000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">STACK_TEXT:
</span></span><span class="line"><span class="cl">00000053`0abf82f0 00007ff7`275a0513 : 00001c69`00000000 00000053`0abf84d8 00008d04`5e11c7b4 00001c69`00000000 : electron!node::AsyncResource::CallbackScope::~CallbackScope+0x13227c
</span></span><span class="line"><span class="cl">00000053`0abf84a0 00007ff7`275a0121 : 00008d04`5e11c7a4 00000053`0abf8690 00007ff7`2b7e55c0 0000452c`0087b1bb : electron!v8::Object::SlowGetInternalField+0x7f3
</span></span><span class="line"><span class="cl">00000053`0abf84d0 00007ff7`26cacd53 : 00000000`00000000 00007ff7`26c1f112 00000000`00000000 00000000`06b96722 : electron!v8::Object::SlowGetInternalField+0x401
</span></span><span class="line"><span class="cl">00000053`0abfcfe0 00007ff7`26652c61 : 00000000`00000000 00001c69`08042229 00001c69`c0cdb000 00001c69`08282125 : electron!v8::V8::ToLocalEmpty+0x2193
</span></span><span class="line"><span class="cl">00000053`0abfd010 00007ff7`27720c24 : 00000000`00000000 00000000`00000000 00000053`0abfd068 00000000`00000000 : electron!v8::Value::ToString+0x2eef1
</span></span><span class="line"><span class="cl">00000053`0abfd050 00007ff7`251fa720 : 00000000`00000000 00000000`00000000 00000000`00000000 00001c69`a5e82115 : electron!v8::internal::TickSample::Init+0x11a24
</span></span><span class="line"><span class="cl">00000053`0abfd0d0 00007ff7`25ae571c : 00000000`00000000 00000053`0abfd218 00001c69`a5e80000 00000000`00000002 : electron!v8::Isolate::CreateParams::~CreateParams+0xce60
</span></span><span class="line"><span class="cl">00000053`0abfd130 00001c69`000c6308 : 00000000`0d72ce44 00001c69`08942dd9 00000000`06b96722 00001c69`08582e0d : electron!v8_inspector::protocol::Binary::operator=+0x6f12c
</span></span><span class="line"><span class="cl">00000053`0abfd188 00000000`0d72ce44 : 00001c69`08942dd9 00000000`06b96722 00001c69`08582e0d 00000000`0d72ce44 : 0x00001c69`000c6308
</span></span><span class="line"><span class="cl">00000053`0abfd190 00001c69`08942dd9 : 00000000`06b96722 00001c69`08582e0d 00000000`0d72ce44 00001c69`0946344d : 0xd72ce44
</span></span><span class="line"><span class="cl">00000053`0abfd198 00000000`06b96722 : 00001c69`08582e0d 00000000`0d72ce44 00001c69`0946344d 00001c69`088c2349 : 0x00001c69`08942dd9
</span></span><span class="line"><span class="cl">00000053`0abfd1a0 00001c69`08582e0d : 00000000`0d72ce44 00001c69`0946344d 00001c69`088c2349 00001c69`08582e0d : 0x6b96722
</span></span><span class="line"><span class="cl">00000053`0abfd1a8 00000000`0d72ce44 : 00001c69`0946344d 00001c69`088c2349 00001c69`08582e0d 00001c69`083d6e61 : 0x00001c69`08582e0d
</span></span><span class="line"><span class="cl">00000053`0abfd1b0 00001c69`0946344d : 00001c69`088c2349 00001c69`08582e0d 00001c69`083d6e61 00001c69`08584a49 : 0xd72ce44
</span></span><span class="line"><span class="cl">00000053`0abfd1b8 00001c69`088c2349 : 00001c69`08582e0d 00001c69`083d6e61 00001c69`08584a49 00000000`0000069c : 0x00001c69`0946344d
</span></span><span class="line"><span class="cl">00000053`0abfd1c0 00001c69`08582e0d : 00001c69`083d6e61 00001c69`08584a49 00000000`0000069c 00000000`0000645c : 0x00001c69`088c2349
</span></span><span class="line"><span class="cl">00000053`0abfd1c8 00001c69`083d6e61 : 00001c69`08584a49 00000000`0000069c 00000000`0000645c 00001c69`08942dd9 : 0x00001c69`08582e0d
</span></span><span class="line"><span class="cl">00000053`0abfd1d0 00001c69`08584a49 : 00000000`0000069c 00000000`0000645c 00001c69`08942dd9 00000000`000000e8 : 0x00001c69`083d6e61
</span></span><span class="line"><span class="cl">00000053`0abfd1d8 00000000`0000069c : 00000000`0000645c 00001c69`08942dd9 00000000`000000e8 00001c69`08605fed : 0x00001c69`08584a49
</span></span><span class="line"><span class="cl">00000053`0abfd1e0 00000000`0000645c : 00001c69`08942dd9 00000000`000000e8 00001c69`08605fed 00000000`00000000 : 0x69c
</span></span><span class="line"><span class="cl">00000053`0abfd1e8 00001c69`08942dd9 : 00000000`000000e8 00001c69`08605fed 00000000`00000000 00001c69`08942de9 : 0x645c
</span></span><span class="line"><span class="cl">00000053`0abfd1f0 00000000`000000e8 : 00001c69`08605fed 00000000`00000000 00001c69`08942de9 00001c69`088c2349 : 0x00001c69`08942dd9
</span></span><span class="line"><span class="cl">00000053`0abfd1f8 00001c69`08605fed : 00000000`00000000 00001c69`08942de9 00001c69`088c2349 00000053`0abfd2c8 : 0xe8
</span></span><span class="line"><span class="cl">00000053`0abfd200 00000000`00000000 : 00001c69`08942de9 00001c69`088c2349 00000053`0abfd2c8 00007ff7`25a7ed0f : 0x00001c69`08605fed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SYMBOL_NAME:  electron!node::AsyncResource::CallbackScope::~CallbackScope+13227c
</span></span><span class="line"><span class="cl">MODULE_NAME: electron
</span></span><span class="line"><span class="cl">IMAGE_NAME:  electron.exe
</span></span><span class="line"><span class="cl">STACK_COMMAND:  ~0s ; .ecxr ; kb
</span></span><span class="line"><span class="cl">FAILURE_BUCKET_ID:  NULL_POINTER_WRITE_c0000005_electron.exe!node::AsyncResource::CallbackScope::_CallbackScope
</span></span><span class="line"><span class="cl">OSPLATFORM_TYPE:  x64
</span></span><span class="line"><span class="cl">OSNAME:  Windows 10
</span></span><span class="line"><span class="cl">FAILURE_ID_HASH:  {3f18c3a4-c6fc-f39e-d02b-f38f7b21394d}
</span></span><span class="line"><span class="cl">Followup:     MachineOwner
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢è¿™æ®µé”™è¯¯ä¿¡æ¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ EXCEPTION_RECORD èŠ‚ï¼Œå…¶ä¸­ ExceptionAddress æ˜¯å´©æºƒäº§ç”Ÿæ—¶çš„ä»£ç æ‰§è¡Œåœ°å€ã€‚</p>
<p>è¿™é‡Œé¢çš„ä¿¡æ¯ä¸ºï¼šé”™è¯¯å‘ç”Ÿåœ¨ä¸€ä¸ªå¼‚æ­¥å›è°ƒæ–¹æ³•å†…ï¼ˆelectron!node::AsyncResource::CallbackScopeï¼‰ï¼ŒExceptionCode æ˜¯ Windows API ä¸­ GetLastError è·å–åˆ°çš„é”™è¯¯ç ï¼ˆc0000005 Access violationï¼Œè®¿é—®è¢«ç¦æ­¢ï¼‰ã€‚</p>
<p>Windows å®šä¹‰äº†å¾ˆå¤šé”™è¯¯ç ï¼Œå¦‚æœä½ åœ¨è°ƒè¯•å´©æºƒæŠ¥å‘Šæ—¶ï¼Œé‡åˆ°äº†ä¸ä¸€æ ·çš„é”™è¯¯ç ï¼Œå¯ä»¥åœ¨è¿™ä¸ªé¡µé¢æŸ¥è¯¢é”™è¯¯ç çš„å…·ä½“å«ä¹‰ï¼šdocs.microsoft.com/en-us/windoâ€¦ ã€‚</p>
<p>æ¥ä¸‹æ¥è¿˜æœ‰ä¸€è¡Œé”™è¯¯ï¼šAttempt to write to address 0000000000000000ï¼Œè¯´æ˜ç¨‹åºè¯•å›¾åœ¨æŸä¸ªå†…å­˜åœ°å€å†™å…¥ä¿¡æ¯æ—¶å‡ºé”™ã€‚</p>
<p>å¦ä¸€éƒ¨åˆ†æ˜¯ STACK_TEXT èŠ‚ï¼Œè¿™ä¸ªèŠ‚æ˜¾ç¤ºçš„æ˜¯å †æ ˆä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å´©æºƒå‰ C++ ä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æ›´æ˜ç¡®çš„é”™è¯¯ç°åœºï¼Œå…¶ä¸­æœ‰ 7 è¡Œæ˜¯ä¸ V8 å¼•æ“æ‰§è¡Œæœ‰å…³çš„ä¿¡æ¯ï¼Œè¯´æ˜ä»£ç å‘ç”Ÿåœ¨ JavaScript è„šæœ¬æ‰§è¡ŒæœŸé—´ã€‚</p>
<p>ä½¿ç”¨ WinDbg åˆ†æå´©æºƒæŠ¥å‘Šè®¾ç½®æ¯”è¾ƒçƒ¦çï¼Œä¸ºæ­¤ç¤¾åŒºå†…æœ‰äººä¸“é—¨å¼€å‘äº†ä¸€ä¸ªå´©æºƒæŠ¥å‘Šåˆ†æå·¥å…·ï¼šelectron-minidump ã€‚</p>
<p>è¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨å¸®å¼€å‘è€…ä¸‹è½½ç¬¦å·æ–‡ä»¶ï¼Œæ‰§è¡Œåˆ†ææŒ‡ä»¤ã€‚</p>
<h2 id="å…¶å®ƒ">å…¶å®ƒ</h2>
<h3 id="åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•">åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•</h3>
<p>ä½¿ç”¨ electron-builder æ‰“åŒ…åº”ç”¨æ—¶è®¾ç½®äº†ä¸å…è®¸ç”¨æˆ·ä¿®æ”¹åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºä¼šå®‰è£…åœ¨ç”¨æˆ·çš„å¦‚ä¸‹ç›®å½•ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">64 ä½åº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•ï¼šC:\Program Files\\[yourAppName]
</span></span><span class="line"><span class="cl">32 ä½åº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•ï¼šC:\Program Files (x86)\\[yourAppName]
</span></span></code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨ç¨‹åºå®‰è£…ç›®å½•ä¸‹çš„æ–‡ä»¶åŠå…¶åŠŸç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">åº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•
</span></span><span class="line"><span class="cl">â”œâ”€ localesï¼ˆElectronçš„å¤šå›½è¯­è¨€æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ en-GB.pakï¼ˆè‹±å›½è‹±è¯­ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ en-US.pakï¼ˆç¾å›½è‹±è¯­ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ zh-CN.pakï¼ˆç®€ä½“ä¸­æ–‡ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ zh-TW.pakï¼ˆç¹ä½“ä¸­æ–‡ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ .....ï¼ˆå…¶ä»–å›½å®¶è¯­è¨€æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥åˆ é™¤ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ resourcesï¼ˆåº”ç”¨ç¨‹åºèµ„æºåŠç¼–è¯‘åçš„æºç ï¼‰
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€ app.asarï¼ˆç¼–è¯‘åçš„æºç å‹ç¼©æ–‡æ¡£ï¼‰
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€ app.asar.unpackedï¼ˆç¼–è¯‘åçš„æºç æœªå‹ç¼©æ–‡æ¡£ï¼‰
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€ appï¼ˆå¦‚æœæ²¡æœ‰app.asaræˆ–app.asar.unpackedï¼Œåˆ™ç¼–è¯‘åæºç æ–‡æ¡£åœ¨æ­¤ç›®å½•ä¸‹ï¼‰
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€ app-update.ymlï¼ˆåº”ç”¨ç¨‹åºå‡çº§ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â”‚  â”œâ”€ .....ï¼ˆé€šè¿‡electron-builderé…ç½®çš„å…¶ä»–çš„é¢å¤–èµ„æºï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ swiftshaderï¼ˆå›¾å½¢æ¸²æŸ“å¼•æ“ç›¸å…³åº“ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ yourApp.exeï¼ˆåº”ç”¨ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯electron.exeä¿®æ”¹å›¾æ ‡å’Œæ–‡ä»¶ååå¾—æ¥çš„ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ UnInstall yourApp.exeï¼ˆå¸è½½åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â””â”€ ......ï¼ˆå…¶ä»–Electronåº”ç”¨ç¨‹åºä½¿ç”¨çš„äºŒè¿›åˆ¶èµ„æºï¼‰
</span></span></code></pre></td></tr></table>
</div>
</div><p>Electron åº”ç”¨åœ¨ Mac æ“ä½œç³»ç»Ÿä¸Šå®‰è£…ä¹‹åï¼Œä¼šä»¥ app åº”ç”¨çš„å½¢å¼å‡ºç°åœ¨ç”¨æˆ·çš„åº”ç”¨ç¨‹åºç›®å½•ä¸‹ï¼Œå³å‡»èœå•çš„æ˜¾ç¤ºåŒ…å†…å®¹æ¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„ç›®å½•ç»“æ„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">åº”ç”¨ç¨‹åº.app
</span></span><span class="line"><span class="cl">â”œâ”€ Contentsï¼ˆæ ¹ç›®å½•ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ _CodeSignatureï¼ˆå­˜æ”¾åº”ç”¨ç¨‹åºçš„ç­¾åä¿¡æ¯ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ Frameworksï¼ˆå­˜æ”¾Electronç›¸å…³çš„äºŒè¿›åˆ¶èµ„æºï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ Info.plistï¼ˆåº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«åº”ç”¨ç¨‹åºåç§°ã€idã€å›¾æ ‡ä»¥åŠåº•å±‚æ¥å£æƒé™çš„ä¿¡æ¯ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”œâ”€ Resourcesï¼ˆåº”ç”¨ç¨‹åºèµ„æºåŠç¼–è¯‘åçš„æºç ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚ â”œâ”€ app-update.ymlï¼ˆåº”ç”¨ç¨‹åºå‡çº§ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚ â”œâ”€ app.asarï¼ˆç¼–è¯‘åçš„æºç å‹ç¼©æ–‡æ¡£ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚ â”œâ”€ app.asar.unpackedï¼ˆç¼–è¯‘åçš„æºç æœªå‹ç¼©æ–‡æ¡£ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚ â”œâ”€ appï¼ˆå¦‚æœæ²¡æœ‰app.asaræˆ–app.asar.unpackedæ–‡ä»¶ï¼Œåˆ™ç¼–è¯‘åæºç æ–‡æ¡£åœ¨æ­¤ç›®å½•ä¸‹ï¼‰
</span></span><span class="line"><span class="cl">â”‚ â”‚ â”‚ â”œâ”€ ...ï¼ˆElectronå†…ç½®çš„å¤šå›½è¯­è¨€æ–‡ä»¶ï¼‰
</span></span><span class="line"><span class="cl">â””â”€â””â”€â””â”€ ...ï¼ˆé€šè¿‡electron-builderé…ç½®çš„å…¶ä»–çš„é¢å¤–èµ„æºï¼‰
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åº”ç”¨ç¨‹åºç¼“å­˜ç›®å½•">åº”ç”¨ç¨‹åºç¼“å­˜ç›®å½•</h3>
<p>ç”¨æˆ·ç¬¬ä¸€æ¬¡å¯åŠ¨ Electron åº”ç”¨åï¼ŒElectron ä¼šåœ¨å¦‚ä¸‹ç›®å½•åˆ›å»ºç›¸åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œè¯¥ç›®å½•çš„æ–‡ä»¶ç»“æ„åŠåŠŸèƒ½è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p>C://Users/[yourOsUserName]/AppData/Roaming/[yourAppName]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">â”œâ”€ IndexedDBï¼ˆElectronåº”ç”¨æ¸²æŸ“è¿›ç¨‹IndexedDBæ•°æ®å­˜æ”¾ç›®å½•ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ Local Storageï¼ˆElectronåº”ç”¨æ¸²æŸ“è¿›ç¨‹Local Storageæ•°æ®å­˜æ”¾ç›®å½•ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ Session Storageï¼ˆElectronåº”ç”¨æ¸²æŸ“è¿›ç¨‹Session Storageæ•°æ®å­˜æ”¾ç›®å½•ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ Crashpadï¼ˆElectronåº”ç”¨å´©æºƒæ—¥å¿—æ•°æ®å­˜æ”¾ç›®å½•ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ Code Cacheï¼ˆElectronåº”ç”¨æ¸²æŸ“è¿›ç¨‹æºç æ–‡ä»¶ç¼“å­˜ç›®å½•ï¼Œwasmçš„ç¼“å­˜ä¹Ÿä¼šå­˜åœ¨æ­¤å¤„ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ Partitionsï¼ˆå¦‚æœä½ çš„åº”ç”¨ä¸­é€‚åº”äº†è‡ªå®šä¹‰åè®®ï¼Œæˆ–æ ¹æ®å­—ç¬¦ä¸²äº§ç”Ÿäº†sessionï¼Œæ­¤ç›®å½•å°†æœ‰ç›¸åº”çš„å†…å®¹ï¼‰
</span></span><span class="line"><span class="cl">â”œâ”€ GPUCacheï¼ˆElectronåº”ç”¨æ¸²æŸ“è¿›ç¨‹GPUè¿è¡Œè¿‡ç¨‹äº§ç”Ÿçš„ç¼“å­˜æ•°æ®ï¼‰
</span></span><span class="line"><span class="cl">â””â”€ ......ï¼ˆå…¶ä»–Electronæ¸²æŸ“è¿›ç¨‹ç¼“å­˜æ–‡ä»¶ï¼‰
</span></span></code></pre></td></tr></table>
</div>
</div><p>Mac æ“ä½œç³»ç»Ÿä¸‹çš„ç¼“å­˜ç›®å½•ä¸ºï¼š</p>
<p>MacintoshHD/ç”¨æˆ·/[yourOsUserName]/èµ„æºåº“/ApplicationSupport/[yourAppName]</p>
<p>è¯¥ç›®å½•ä¸‹çš„å†…å®¹ä¸å­ç›®å½•ç»“æ„è·Ÿ Windows æ“ä½œç³»ç»Ÿç±»ä¼¼ã€‚</p>
<p>è™½ç„¶ä»¥ä¸Šç›®å½•å†…çš„æ–‡ä»¶éƒ½æ˜¯åŠ å¯†å­˜å‚¨çš„ï¼Œä½†åªè¦æŠŠè¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªä¼ªé€ çš„ Electron ç¨‹åºè¯»å–åˆ°è¿™äº›ç¼“å­˜æ–‡ä»¶å†…çš„æ•°æ®ã€‚</p>
<p>å®¢æˆ·ç«¯æ•°æ®åº“æ–‡ä»¶ä¹Ÿæ˜¯å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„ã€‚</p>
<p>Electron æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„ API æ¥è·å–æ­¤è·¯å¾„ï¼Œæ­¤æ–¹æ³•æ‰§è¡Œæ—¶ä¼šåˆ¤æ–­å½“å‰åº”ç”¨æ­£è¿è¡Œåœ¨ä»€ä¹ˆæ“ä½œç³»ç»Ÿä¸Šï¼Œç„¶åæ ¹æ®æ“ä½œç³»ç»Ÿçš„åç§°è¿”å›å…·ä½“çš„è·¯å¾„åœ°å€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">getPath</span><span class="p">(</span><span class="s2">&#34;userData&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="çª—å£é’‰åœ¨æ¡Œé¢ä¸Š">çª—å£é’‰åœ¨æ¡Œé¢ä¸Š</h3>
<p>ä½¿ç”¨ electget åº“ï¼Œå®‰è£…å¹¶åœ¨ä¸»è¿›ç¨‹ä»£ç ä¸­å¼•å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// import electget from &#34;electget&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">electget</span><span class="p">.</span><span class="nx">preventFromAeroPeek</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">electget</span><span class="p">.</span><span class="nx">preventFromShowDesktop</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">electget</span><span class="p">.</span><span class="nx">moveToBottom</span><span class="p">(</span><span class="nx">win</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶çª—å£å°±å¯ä»¥â€œé’‰â€åœ¨æ¡Œé¢ä¸Šäº†ã€‚</p>
<p>ä¸ºäº†æ›´å®Œç¾åœ°æ»¡è¶³éœ€æ±‚ï¼Œæœ€å¥½ç›‘æ§ä¸€ä¸‹çª—å£èšç„¦äº‹ä»¶ï¼Œå½“ç”¨æˆ·èšç„¦çª—å£æ—¶ï¼ŒæŠŠçª—å£ç§»è‡³æœ€åº•å±‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;browser-window-focus&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">win</span>: <span class="kt">BrowserWindow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">win</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="nx">mainWindow</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">electget</span><span class="p">.</span><span class="nx">moveToBottom</span><span class="p">(</span><span class="nx">mainWindow</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·åšå¯ä»¥é¿å…åœ¨ç”¨æˆ·ä¸çª—å£äº¤äº’åï¼Œè¢«é’‰ä½çš„çª—å£æµ®åˆ°å…¶ä»–çª—å£ä¹‹ä¸Šã€‚</p>
<h3 id="æ–‡ä»¶é‡æ–°ä¸Šä¼ ">æ–‡ä»¶é‡æ–°ä¸Šä¼ </h3>
<p>å¼€å‘è€…åœ¨ä¸Šä¼ æ–‡ä»¶ä¹‹å‰ï¼ŒæŠŠæ–‡ä»¶è·¯å¾„è®°å½•ä¸‹æ¥ï¼Œé‡æ–°ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œç›´æ¥ç”¨æ–‡ä»¶è·¯å¾„æ„é€ ä¸€ä¸ª File å¯¹è±¡ï¼Œç„¶åå†ä¸Šä¼ åˆ°æœåŠ¡ç«¯ã€‚</p>
<p>ä½¿ç”¨æ–‡ä»¶è·¯å¾„æ„é€  File å¯¹è±¡çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">extname</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">promises</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">File</span><span class="p">([</span><span class="nx">Uint8Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)],</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filePath</span><span class="p">),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">type</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">ext2type</span><span class="p">[</span><span class="nx">extname</span><span class="p">],</span> <span class="c1">//mimetypeç±»ä¼¼&#34;image/png&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹æ³•è¦æŠŠæ•´ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½è¯»å‡ºæ¥æ”¾åˆ° buffer é‡Œï¼Œå°æ–‡ä»¶è¿˜å¥½ï¼Œé‡åˆ°å¤§æ–‡ä»¶å°±æå…¶æ¶ˆè€—ç”¨æˆ·çš„å†…å­˜äº†ï¼Œè€Œä¸” V8 å¹¶ä¸ä¼šåŠæ—¶é‡Šæ”¾è¿™å—å†…å­˜ã€‚</p>
<p>æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ä¸€å—ä¸€å—è¯»æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå†é™„åŠ åˆ° POST è¯·æ±‚å†…ã€‚</p>
<p>æœ‰ä¸€ä¸ªå¼€æºåº“ â€”â€” form-dataï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–è¿™æ–¹é¢çš„å·¥ä½œã€‚</p>
<p>æŠŠ form-data å¼•å…¥å·¥ç¨‹å†…åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ„é€ ä¸Šä¼ è¡¨å•ï¼Œç”¨è¿™ç§æ–¹æ³•ä¸Šä¼ æ–‡ä»¶å°±æ˜¯åˆ†ç‰‡ä¸Šä¼ çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s2">&#34;form-data&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">form</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;yourFile&#34;</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s2">&#34;/your/file/path.7z&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="s2">&#34;http://yourFileService.com/upload&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¦å¼€å‘å–æ¶ˆä¸Šä¼ ã€æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ è¿›åº¦ç­‰åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">body</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">chunk</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;end&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">resString</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">resObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">resString</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">eventer</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&#34;setXhrAbort&#34;</span><span class="p">,</span> <span class="nx">abort</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">resolve</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;socket&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">req</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;drain&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">percent</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">((</span><span class="nx">req</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">bytesWritten</span> <span class="o">/</span> <span class="nx">file</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// æ­¤å¤„æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ è¿›åº¦çš„é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">abort</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">req</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è°ƒç”¨æ­¤æ–¹æ³•ç»“æŸæ–‡ä»¶ä¸Šä¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ğŸ¤ª ä»Šå¤©ä¸å­¦ä¹ ï¼Œæ˜å¤©å˜åƒåœ¾ã€‚</p>
<img src="https://oweqian.oss-cn-hangzhou.aliyuncs.com/electron/img_15.png" alt="" width="700" /></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2023-03-16&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/3cdcd1134458a3aee56c0ebb827558b9e495b21f" target="_blank" title="commit by OweQian(1510106069@qq.com) 3cdcd1134458a3aee56c0ebb827558b9e495b21f: feat: update">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>3cdcd11</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/electron/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E7%AC%AC%E4%B8%80%E6%8A%80%E8%83%BD/">ç¬¬ä¸€æŠ€èƒ½</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/books/" class="prev" rel="prev" title="ğŸ“– ä¸€äº›è¯»è¿‡çš„ä¹¦éšæ‰‹è®°"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>ğŸ“– ä¸€äº›è¯»è¿‡çš„ä¹¦éšæ‰‹è®°</a>
            <a href="/draw/" class="next" rel="next" title="âœ æ²¹ç”»æ£’ç”»æˆé•¿ä¹‹æ—…">âœ æ²¹ç”»æ£’ç”»æˆé•¿ä¹‹æ—…<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.109.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">OweQian</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":50},"comment":{"giscus":{"category":"General","categoryId":"DIC_kwDOIjhAhM4CTN5c","darkTheme":"dark","emitMetadata":"0","inputPosition":"top","lang":"zh-CN","lazyLoading":false,"lightTheme":"dark","mapping":"pathname","reactionsEnabled":"1","repo":"OweQian/oweqian.github.io","repoId":"R_kgDOIjhAhA"}},"search":{"algoliaAppID":null,"algoliaIndex":null,"algoliaSearchKey":null,"highlightTag":"em","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-GT3XCV7DP0', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-GT3XCV7DP0" async></script></body>
</html>
